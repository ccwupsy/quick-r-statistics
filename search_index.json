[["index.html", "Quick R for Statistics 前言", " Quick R for Statistics Chia-Ching Wu 2022-05-16 前言 R語言是免費的軟體，是進行統計分析很好的工具。 本教學網站是從做中學的快速入門版。 "],["datainput.html", "Chapter 1 資料的讀入與整理 1.1 讀入資料 1.2 資料檢視 1.3 分數的轉換和計算 1.4 儲存資料", " Chapter 1 資料的讀入與整理 本單元介紹如何以R語言讀入資料、整理資料、並做初步分析。 1.1 讀入資料 1.1.1 下載範例資料 本單元使用的範例資料為一虛擬的課程成績檔。請下載至本地端。 1.1.2 設定工作目錄 將R的工作目錄設定至存放檔案的目錄下。語法為setwd(“檔案所在地的絕對路徑”)，記得資料夾要用\\來分隔，例如setwd(“D:\\DIR1\\DIR2\\DIR3”)。設定好之後，可以用getwd()來檢視是否成功。 setwd(&quot;D:\\\\dropbox\\\\Working\\\\教師社群&quot;) getwd() ## [1] &quot;D:/Dropbox/Working/教師社群&quot; 1.1.3 讀入檔案 以xlsx套件的read.xlsx()函數來讀入excel檔，此函數有賴java。 library(xlsx) gData &lt;- read.xlsx(&quot;成績.xlsx&quot;, 1, encoding = &quot;UTF-8&quot;, stringsAsFactors=FALSE) head(gData) ## 學號 性別 組別 出席 影片團評 影片老師評分 期中考 期末考 ## 1 102368014 M 9 8.5 24.05 8.5 32 28 ## 2 102368018 M 10 9.5 24.26 8.5 66 59 ## 3 102368024 F 9 8 24.05 8.5 69 68 ## 4 102368027 F 9 8 24.05 8.5 68 83.5 ## 5 102368030 F 11 0 18.92 7 39 30 ## 6 100368033 M 4 12 20 8 58 79 也可以用readxl套件的read_xlsx()函數來讀入excel檔，此函數不需java。請注意以不同函數讀入資料時，資料的格式會稍有不同，後續在叫出資料時需注意。 library(readxl) gData &lt;- read_xlsx(&quot;成績.xlsx&quot;) 1.2 資料檢視 資料中，有兩位學生已退選，不納入成績計算，可先刪除不要的資料（即選擇要的資料）。 gData &lt;- gData[gData$期末考 != &quot;.&quot;, ] 1.2.1 檢視資料類型 可在RStudio右方的Environment中雙擊變項名稱來檢視變項，變項為dataframe的型式。 或使用str(變項名稱)來檢視dataframe下的每個變項類型。 str(gData) ## &#39;data.frame&#39;: 57 obs. of 8 variables: ## $ 學號 : chr &quot;102368014&quot; &quot;102368018&quot; &quot;102368024&quot; &quot;102368027&quot; ... ## $ 性別 : chr &quot;M&quot; &quot;M&quot; &quot;F&quot; &quot;F&quot; ... ## $ 組別 : num 9 10 9 9 11 4 4 4 6 6 ... ## $ 出席 : chr &quot;8.5&quot; &quot;9.5&quot; &quot;8&quot; &quot;8&quot; ... ## $ 影片團評 : chr &quot;24.05&quot; &quot;24.26&quot; &quot;24.05&quot; &quot;24.05&quot; ... ## $ 影片老師評分: chr &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; ... ## $ 期中考 : chr &quot;32&quot; &quot;66&quot; &quot;69&quot; &quot;68&quot; ... ## $ 期末考 : chr &quot;28&quot; &quot;59&quot; &quot;68&quot; &quot;83.5&quot; ... 1.2.2 資料類型的轉換 將資料中，出席至期末考的類型從文字轉為數字。 以期中考為例，可用as.numeric()來做轉換。 gData$期中考 &lt;- as.numeric(gData$期中考) str(gData) ## &#39;data.frame&#39;: 57 obs. of 8 variables: ## $ 學號 : chr &quot;102368014&quot; &quot;102368018&quot; &quot;102368024&quot; &quot;102368027&quot; ... ## $ 性別 : chr &quot;M&quot; &quot;M&quot; &quot;F&quot; &quot;F&quot; ... ## $ 組別 : num 9 10 9 9 11 4 4 4 6 6 ... ## $ 出席 : chr &quot;8.5&quot; &quot;9.5&quot; &quot;8&quot; &quot;8&quot; ... ## $ 影片團評 : chr &quot;24.05&quot; &quot;24.26&quot; &quot;24.05&quot; &quot;24.05&quot; ... ## $ 影片老師評分: chr &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; ... ## $ 期中考 : num 32 66 69 68 39 58 67 55 40 54 ... ## $ 期末考 : chr &quot;28&quot; &quot;59&quot; &quot;68&quot; &quot;83.5&quot; ... 若要一次轉換多個變項，可用sapply。 gData[c(4:8)] &lt;- sapply(gData[c(4:8)], as.numeric) str(gData) ## &#39;data.frame&#39;: 57 obs. of 8 variables: ## $ 學號 : chr &quot;102368014&quot; &quot;102368018&quot; &quot;102368024&quot; &quot;102368027&quot; ... ## $ 性別 : chr &quot;M&quot; &quot;M&quot; &quot;F&quot; &quot;F&quot; ... ## $ 組別 : num 9 10 9 9 11 4 4 4 6 6 ... ## $ 出席 : num 8.5 9.5 8 8 0 12 12 5 12 12 ... ## $ 影片團評 : num 24.1 24.3 24.1 24.1 18.9 ... ## $ 影片老師評分: num 8.5 8.5 8.5 8.5 7 8 8 8 8 8 ... ## $ 期中考 : num 32 66 69 68 39 58 67 55 40 54 ... ## $ 期末考 : num 28 59 68 83.5 30 79 78 56.5 49.5 60.5 ... 1.2.3 檢視各組人數 可用table()來檢視男女人數和各組人數。 table(gData$性別) gTable1 &lt;- as.data.frame(table(gData$性別)) gTable2 &lt;- as.data.frame(table(gData$組別)) gTable1 ## ## F M ## 30 27 ## Var1 Freq ## 1 F 30 ## 2 M 27 檢視各組中的男女人數。 table(gData$性別, gData$組別) as.data.frame(rbind(table(gData$性別, gData$組別))) ## ## 1 2 3 4 5 6 7 8 9 10 11 12 ## F 1 4 5 4 2 2 3 1 2 2 3 1 ## M 3 2 2 2 3 3 1 4 1 3 1 2 ## 1 2 3 4 5 6 7 8 9 10 11 12 ## F 1 4 5 4 2 2 3 1 2 2 3 1 ## M 3 2 2 2 3 3 1 4 1 3 1 2 1.3 分數的轉換和計算 因影片的評分分別為滿分30分（團評）和滿分10分（老師評分），須轉換為百分制並加以平均。 1.3.1 換為百分制 將影片團評和老師評分轉換為百分制。 gData$影片團評新 &lt;- gData$影片團評 / 30 * 100 gData$影片老師評分新 &lt;- gData$影片老師評分 / 10 * 100 head(gData) ## 學號 性別 組別 出席 影片團評 影片老師評分 期中考 期末考 影片團評新 ## 1 102368014 M 9 8.5 24.05 8.5 32 28.0 80.16667 ## 2 102368018 M 10 9.5 24.26 8.5 66 59.0 80.86667 ## 3 102368024 F 9 8.0 24.05 8.5 69 68.0 80.16667 ## 4 102368027 F 9 8.0 24.05 8.5 68 83.5 80.16667 ## 5 102368030 F 11 0.0 18.92 7.0 39 30.0 63.06667 ## 6 100368033 M 4 12.0 20.00 8.0 58 79.0 66.66667 ## 影片老師評分新 ## 1 85 ## 2 85 ## 3 85 ## 4 85 ## 5 70 ## 6 80 1.3.2 將兩變項平均 直接相加除以2或用rowMeans()來做都可以。 gData$影片 &lt;- (gData$影片團評新 + gData$影片老師評分新)/2 gData$影片 &lt;- rowMeans(gData[,c(&quot;影片團評新&quot;, &quot;影片老師評分新&quot;)], na.rm=TRUE) head(gData) ## 學號 性別 組別 出席 影片團評 影片老師評分 期中考 期末考 影片團評新 ## 1 102368014 M 9 8.5 24.05 8.5 32 28.0 80.16667 ## 2 102368018 M 10 9.5 24.26 8.5 66 59.0 80.86667 ## 3 102368024 F 9 8.0 24.05 8.5 69 68.0 80.16667 ## 4 102368027 F 9 8.0 24.05 8.5 68 83.5 80.16667 ## 5 102368030 F 11 0.0 18.92 7.0 39 30.0 63.06667 ## 6 100368033 M 4 12.0 20.00 8.0 58 79.0 66.66667 ## 影片老師評分新 影片 ## 1 85 82.58333 ## 2 85 82.93333 ## 3 85 82.58333 ## 4 85 82.58333 ## 5 70 66.53333 ## 6 80 73.33333 1.3.3 抽取部份資料加以計算 抽取出最後要分析的變項，使資料更簡潔。抽取資料的兩種方法為：(1) 資料框名稱[列,行]；(2)subset(變項名稱, 行的條件, select=c(列的名稱))。 gData1 &lt;- gData[,-c(5,6,9,10)] gData1 &lt;- subset(gData, select = c(&quot;學號&quot;, &quot;性別&quot;, &quot;組別&quot;, &quot;出席&quot;, &quot;影片&quot;, &quot;期中考&quot;, &quot;期末考&quot;)) head(gData1) ## 學號 性別 組別 出席 影片 期中考 期末考 ## 1 102368014 M 9 8.5 82.58333 32 28.0 ## 2 102368018 M 10 9.5 82.93333 66 59.0 ## 3 102368024 F 9 8.0 82.58333 69 68.0 ## 4 102368027 F 9 8.0 82.58333 68 83.5 ## 5 102368030 F 11 0.0 66.53333 39 30.0 ## 6 100368033 M 4 12.0 73.33333 58 79.0 假設總成績為期中考+期末考+影片的平均，再加上出席分數，則可以下列方式計算。 gData1$總成績 &lt;- (gData1$期中考 + gData1$期末考 + gData1$影片)/3 + gData1$出席 head(gData1) ## 學號 性別 組別 出席 影片 期中考 期末考 總成績 ## 1 102368014 M 9 8.5 82.58333 32 28.0 56.02778 ## 2 102368018 M 10 9.5 82.93333 66 59.0 78.81111 ## 3 102368024 F 9 8.0 82.58333 69 68.0 81.19444 ## 4 102368027 F 9 8.0 82.58333 68 83.5 86.02778 ## 5 102368030 F 11 0.0 66.53333 39 30.0 45.17778 ## 6 100368033 M 4 12.0 73.33333 58 79.0 82.11111 1.3.4 資料數值的檢視與取代 檢視總成績資料，將大於100和小於60者挑選出來，並以新成績取代。 1.3.4.1 檢視資料的最大最小值 可用max()和min()來檢視總成績的最大最小值。 max(gData1$總成績) min(gData1$總成績) ## [1] 102.4889 ## [1] 45.17778 1.3.4.2 找出符合條件的資料 以which()找出大於100和小於60的資料位置，並叫出來看。 gData1[which(gData1$總成績 &lt; 60),] ## 學號 性別 組別 出席 影片 期中考 期末考 總成績 ## 1 102368014 M 9 8.5 82.58333 32 28 56.02778 ## 5 102368030 F 11 0.0 66.53333 39 30 45.17778 ## 48 103368042 F 4 8.0 73.33333 45 0 47.44444 ## 51 103368047 M 12 5.0 77.11667 52 35 59.70556 ## 58 103365306 F 11 12.0 66.53333 29 47 59.51111 gData1[which(gData1$總成績 &gt; 100),] ## 學號 性別 組別 出席 影片 期中考 期末考 總成績 ## 43 103368037 M 5 12 82.46667 89 100 102.4889 1.3.4.3 取代資料 將總成績大於100者以100取代，總成績不滿60但接近60者以60取代。 gData1[which(gData1$總成績 &gt; 100),&#39;總成績&#39;] &lt;- 100 gData1[which(gData1$總成績 &lt; 60 &amp; gData1$總成績 &gt; 59), &#39;總成績&#39;] &lt;- 60 1.3.4.4 確認執行結果 用which檢視還有哪些學生總成績小於60或大於100。 gData1[which(gData1$總成績 &lt; 60),] ## 學號 性別 組別 出席 影片 期中考 期末考 總成績 ## 1 102368014 M 9 8.5 82.58333 32 28 56.02778 ## 5 102368030 F 11 0.0 66.53333 39 30 45.17778 ## 48 103368042 F 4 8.0 73.33333 45 0 47.44444 gData1[which(gData1$總成績 &gt; 100),] ## [1] 學號 性別 組別 出席 影片 期中考 期末考 總成績 ## &lt;0 rows&gt; (or 0-length row.names) 檢視原來59分的兩位學生的成績。 gData1[which(gData1$學號 == &quot;103368047&quot; | gData1$學號 == &quot;103365306&quot;),] ## 學號 性別 組別 出席 影片 期中考 期末考 總成績 ## 51 103368047 M 12 5 77.11667 52 35 60 ## 58 103365306 F 11 12 66.53333 29 47 60 1.4 儲存資料 可將dataframe儲存成RData、txt、dat、csv、excel等不同類型的檔案。 1.4.1 儲存為RData檔 以save()函數來將gData1存成gData1.RData檔。 save(gData1, file = &quot;gData1.RData&quot;) 1.4.2 儲存為csv檔 以R內建的write.csv()函數儲存為csv檔。 write.csv(gData1, &quot;gData1.csv&quot;) 1.4.3 儲存為excel檔 可用xlsx套件的write.xlsx()函數將資料存為excel檔，或用writexl套件的write_xlsx()函數來儲存。前者有賴java的運作，後者則不需java。 library(xlsx) write.xlsx(gData1, file=&quot;gData1.xlsx&quot;) library(writexl) write_xlsx(gData1, &quot;gData1.xlsx&quot;) "],["descriptivestats.html", "Chapter 2 描述統計與作圖 2.1 讀入檔案 2.2 描述統計 2.3 資料作圖和相關", " Chapter 2 描述統計與作圖 本單元介紹如何以R語言讀入資料並做初步分析，包含描述統計、作圖。 2.1 讀入檔案 以xlsx套件的read.xlsx()函數或readxl套件的read_xlsx()函數來讀入上個單元中所存出的gData1.xlsx檔。 library(readxl) gData1 &lt;- read_xlsx(&quot;gData1.xlsx&quot;) head(gData1) ## # A tibble: 6 × 8 ## 學號 性別 組別 出席 影片 期中考 期末考 總成績 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 102368014 M 9 8.5 82.6 32 28 56.0 ## 2 102368018 M 10 9.5 82.9 66 59 78.8 ## 3 102368024 F 9 8 82.6 69 68 81.2 ## 4 102368027 F 9 8 82.6 68 83.5 86.0 ## 5 102368030 F 11 0 66.5 39 30 45.2 ## 6 100368033 M 4 12 73.3 58 79 82.1 2.2 描述統計 計算單一變項、多個變項的描述統計量。 2.2.1 計算單一變項的平均數、變異數和標準差 可用mean()、var()和sd()來檢視總成績的平均數、變異數和標準差。 mean(gData1$總成績) ## [1] 74.33021 var(gData1$總成績) ## [1] 126.1945 sd(gData1$總成績) ## [1] 11.23363 可用pastecs套件中的stat.desc()函數來檢視總成績的描述統計量。 library(pastecs) stat.desc(gData1$總成績, basic=TRUE, desc=TRUE, norm=TRUE, p=0.95) ## nbr.val nbr.null nbr.na min max ## 5.700000e+01 0.000000e+00 0.000000e+00 4.517778e+01 1.000000e+02 ## range sum median mean SE.mean ## 5.482222e+01 4.236822e+03 7.615556e+01 7.433021e+01 1.487931e+00 ## CI.mean.0.95 var std.dev coef.var skewness ## 2.980684e+00 1.261945e+02 1.123363e+01 1.511314e-01 -1.319156e-01 ## skew.2SE kurtosis kurt.2SE normtest.W normtest.p ## -2.085114e-01 5.845899e-03 4.690725e-03 9.834611e-01 6.243284e-01 2.2.2 計算多個變項的描述統計量 若要同時計算多項成績的描述統計，需使用第三方套件，例如pastecs套件的stat.desc()函數。 stat.desc(gData1, basic=TRUE, desc=TRUE, norm=TRUE, p=0.95) ## 學號 性別 組別 出席 影片 期中考 ## nbr.val NA NA 57.000000000 5.700000e+01 5.700000e+01 57.0000000 ## nbr.null NA NA 0.000000000 1.000000e+00 0.000000e+00 0.0000000 ## nbr.na NA NA 0.000000000 0.000000e+00 0.000000e+00 0.0000000 ## min NA NA 1.000000000 0.000000e+00 6.653333e+01 29.0000000 ## max NA NA 12.000000000 1.200000e+01 8.433333e+01 89.0000000 ## range NA NA 11.000000000 1.200000e+01 1.780000e+01 60.0000000 ## sum NA NA 341.000000000 5.900000e+02 4.424583e+03 3132.0000000 ## median NA NA 6.000000000 1.100000e+01 7.691667e+01 55.0000000 ## mean NA NA 5.982456140 1.035088e+01 7.762427e+01 54.9473684 ## SE.mean NA NA 0.443196430 3.060493e-01 7.378552e-01 1.7633169 ## CI.mean NA NA 0.887829134 6.130904e-01 1.478102e+00 3.5323481 ## var NA NA 11.196115288 5.338972e+00 3.103253e+01 177.2293233 ## std.dev NA NA 3.346059666 2.310622e+00 5.570685e+00 13.3127504 ## coef.var NA NA 0.559312026 2.232295e-01 7.176473e-02 0.2422819 ## skewness NA NA 0.234149681 -2.123849e+00 -4.829443e-01 0.2879258 ## skew.2SE NA NA 0.370107150 -3.357048e+00 -7.633627e-01 0.4551080 ## kurtosis NA NA -1.217954593 5.573908e+00 -9.842022e-01 -0.2269468 ## kurt.2SE NA NA -0.977281597 4.472480e+00 -7.897197e-01 -0.1821012 ## normtest.W NA NA 0.939578114 7.297347e-01 8.923611e-01 0.9706089 ## normtest.p NA NA 0.006802493 6.467050e-09 1.042615e-04 0.1791033 ## 期末考 總成績 ## nbr.val 57.00000000 5.700000e+01 ## nbr.null 1.00000000 0.000000e+00 ## nbr.na 0.00000000 0.000000e+00 ## min 0.00000000 4.517778e+01 ## max 104.00000000 1.000000e+02 ## range 104.00000000 5.482222e+01 ## sum 3389.00000000 4.236822e+03 ## median 57.00000000 7.615556e+01 ## mean 59.45614035 7.433021e+01 ## SE.mean 2.41277279 1.487931e+00 ## CI.mean 4.83336470 2.980684e+00 ## var 331.82393484 1.261945e+02 ## std.dev 18.21603510 1.123363e+01 ## coef.var 0.30637769 1.511314e-01 ## skewness -0.08459996 -1.319156e-01 ## skew.2SE -0.13372236 -2.085114e-01 ## kurtosis 1.06201488 5.845899e-03 ## kurt.2SE 0.85215623 4.690725e-03 ## normtest.W 0.97173381 9.834611e-01 ## normtest.p 0.20188192 6.243284e-01 也可以用psych套件的describe()函數。參數type設定為2是由於偏態和峰度的計算方式有三種，type=2的值與SPSS相同。 library(psych) summaryTable &lt;- describe(gData1[,4:8], type=2) summaryTable ## vars n mean sd median trimmed mad min max range skew ## 出席 1 57 10.35 2.31 11.00 10.79 1.48 0.00 12.00 12.00 -2.24 ## 影片 2 57 77.62 5.57 76.92 78.02 8.23 66.53 84.33 17.80 -0.51 ## 期中考 3 57 54.95 13.31 55.00 54.47 14.83 29.00 89.00 60.00 0.30 ## 期末考 4 57 59.46 18.22 57.00 59.27 16.31 0.00 104.00 104.00 -0.09 ## 總成績 5 57 74.33 11.23 76.16 74.31 12.14 45.18 100.00 54.82 -0.14 ## kurtosis se ## 出席 6.55 0.31 ## 影片 -0.88 0.74 ## 期中考 -0.03 1.76 ## 期末考 1.43 2.41 ## 總成績 0.24 1.49 也可以用vtable套件的st()函數來做，會有較美觀的表格。 library(vtable) # library(kableExtra) #在RStudio不需要 st(gData1[,c(4:8)]) Table 2.1: Summary Statistics Variable N Mean Std. Dev. Min Pctl. 25 Pctl. 75 Max 出席 57 10.351 2.311 0 9.5 12 12 影片 57 77.624 5.571 66.533 73.333 82.583 84.333 期中考 57 54.947 13.313 29 44 64 89 期末考 57 59.456 18.216 0 49.5 70.5 104 總成績 57 74.33 11.234 45.178 66.567 81.194 100 2.2.3 分組計算單一變項的描述性統計量 若要分組計算單一變項（如總成績）的描述性統計量，可用aggregate()函數。 aggregate(gData1$總成績, by=list(gender=gData1$性別),mean) ## gender x ## 1 F 73.43611 ## 2 M 75.32366 aggregate(gData1$總成績, by=list(gender=gData1$性別),sd) ## gender x ## 1 F 11.80451 ## 2 M 10.69725 也可以用第三方套件pastecs的stat.desc()函數來做。 by(gData1$總成績, gData1$性別, stat.desc, basic = FALSE, norm = TRUE) ## gData1$性別: F ## median mean SE.mean CI.mean.0.95 var std.dev ## 74.37222222 73.43611111 2.15519916 4.40787720 139.34650223 11.80451194 ## coef.var skewness skew.2SE kurtosis kurt.2SE normtest.W ## 0.16074533 -0.35283642 -0.41326154 -0.10010120 -0.06010311 0.96695587 ## normtest.p ## 0.45958396 ## ------------------------------------------------------------ ## gData1$性別: M ## median mean SE.mean CI.mean.0.95 var std.dev ## 77.4555556 75.3236626 2.0586874 4.2316925 114.4312289 10.6972533 ## coef.var skewness skew.2SE kurtosis kurt.2SE normtest.W ## 0.1420172 0.2638189 0.2945380 -0.4395158 -0.2519967 0.9706505 ## normtest.p ## 0.6190810 2.2.4 分組計算多個變項的描述性統計量 若要分組計算多個變項的描述性統計量，可用aggregate()函數，或使用psych套件中的describeBy()。 aggregate(gData1[,4:8],by=list(gender=gData1$性別),mean) ## gender 出席 影片 期中考 期末考 總成績 ## 1 F 10.28333 76.92611 53.13333 59.35000 73.43611 ## 2 M 10.42593 78.40000 56.96296 59.57407 75.32366 aggregate(gData[,4:8],by=list(gender=gData$性別),summary) #較不建議 describeBy(gData1[,4:5], list(gender=gData1$性別),type=2) ## ## Descriptive statistics by group ## gender: F ## vars n mean sd median trimmed mad min max range skew kurtosis ## 出席 1 30 10.28 2.59 11.00 10.81 1.48 0.00 12.00 12.0 -2.58 8.21 ## 影片 2 30 76.93 6.11 76.74 77.30 8.66 66.53 84.33 17.8 -0.29 -1.24 ## se ## 出席 0.47 ## 影片 1.12 ## ------------------------------------------------------------ ## gender: M ## vars n mean sd median trimmed mad min max range skew kurtosis ## 出席 1 27 10.43 2.01 11.00 10.72 1.48 5.00 12.00 7.0 -1.39 1.13 ## 影片 2 27 78.40 4.90 77.12 78.78 7.09 66.53 84.33 17.8 -0.77 -0.17 ## se ## 出席 0.39 ## 影片 0.94 要漂亮一點的表格可以用vTable套件。 library(vtable) st(gData1[,c(4:8)]) Table 2.2: Summary Statistics Variable N Mean Std. Dev. Min Pctl. 25 Pctl. 75 Max 出席 57 10.351 2.311 0 9.5 12 12 影片 57 77.624 5.571 66.533 73.333 82.583 84.333 期中考 57 54.947 13.313 29 44 64 89 期末考 57 59.456 18.216 0 49.5 70.5 104 總成績 57 74.33 11.234 45.178 66.567 81.194 100 st(gData1, group=&#39;性別&#39;) Table 2.3: Summary Statistics 性別 F M Variable N Mean SD N Mean SD 組別 30 5.8 3.316 27 6.185 3.431 出席 30 10.283 2.585 27 10.426 2.008 影片 30 76.926 6.11 27 78.4 4.9 期中考 30 53.133 12.822 27 56.963 13.797 期末考 30 59.35 19.297 27 59.574 17.301 總成績 30 73.436 11.805 27 75.324 10.697 2.3 資料作圖和相關 初步畫直方圖、箱型圖和散布圖，並計算變項之間的相關。 2.3.1 直方圖 以hist()來繪製直方圖。 hist(gData1$總成績) 2.3.2 箱型圖 以boxplot()來繪製箱型圖。 boxplot(gData1$總成績, ylab=&quot;分&quot;) 分組畫箱型圖。 boxplot(gData1$總成績~gData1$性別, xlab=&quot;性別&quot;, ylab=&quot;分&quot;) 2.3.3 散佈圖 以plot()繪製兩變項或多個變項的散佈圖。 plot(gData1$出席, gData1$總成績, xlab=&quot;出席&quot;, ylab=&quot;總成績&quot;) gData2 &lt;- subset(gData1, select = c(出席, 期中考, 期末考, 總成績)) plot(gData2) 2.3.4 計算相關與繪圖 2.3.4.1 計算相關 以cor()計算兩變項的相關，或以cor.test()得到相關和檢定值。 cor(gData1$出席, gData1$總成績) ## [1] 0.5360227 cor.test(gData1$出席, gData1$總成績) ## ## Pearson&#39;s product-moment correlation ## ## data: gData1$出席 and gData1$總成績 ## t = 4.7089, df = 55, p-value = 1.73e-05 ## alternative hypothesis: true correlation is not equal to 0 ## 95 percent confidence interval: ## 0.3201738 0.6989657 ## sample estimates: ## cor ## 0.5360227 cor()可計算多個變項的相關，若要得到檢定結果，可用Hmisc()的rcorr()函數。 cor(gData2) ## 出席 期中考 期末考 總成績 ## 出席 1.0000000 0.2220785 0.3760520 0.5360227 ## 期中考 0.2220785 1.0000000 0.6211838 0.8319727 ## 期末考 0.3760520 0.6211838 1.0000000 0.8983073 ## 總成績 0.5360227 0.8319727 0.8983073 1.0000000 library(Hmisc) rcorr(data.matrix(gData2)) ## 出席 期中考 期末考 總成績 ## 出席 1.00 0.22 0.38 0.54 ## 期中考 0.22 1.00 0.62 0.83 ## 期末考 0.38 0.62 1.00 0.90 ## 總成績 0.54 0.83 0.90 1.00 ## ## n= 57 ## ## ## P ## 出席 期中考 期末考 總成績 ## 出席 0.0969 0.0039 0.0000 ## 期中考 0.0969 0.0000 0.0000 ## 期末考 0.0039 0.0000 0.0000 ## 總成績 0.0000 0.0000 0.0000 2.3.4.2 多個變項的相關矩陣圖 若要將多個變項的相關視覺化，可使用corrplot套件的corrplot()函數。 library(corrplot) corrplot(cor(gData2), method=&#39;number&#39;,type = &quot;upper&quot;) corrplot(cor(gData2), method=&#39;color&#39;, type=&quot;upper&quot;) "],["hypotesting.html", "Chapter 3 假設檢定 3.1 讀入檔案 3.2 常態檢定 3.3 獨立樣本t檢定 3.4 相依樣本t檢定", " Chapter 3 假設檢定 以R語言讀入資料並做假設檢定，包含常態檢定、獨立與相依t檢定。 3.1 讀入檔案 以xlsx套件的read.xlsx()函數或readxl套件的read_xlsx()函數來讀入上個單元中所存出的gData1.xlsx檔。 library(readxl) gData1 &lt;- read_xlsx(&quot;gData1.xlsx&quot;) head(gData1) ## # A tibble: 6 × 8 ## 學號 性別 組別 出席 影片 期中考 期末考 總成績 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 102368014 M 9 8.5 82.6 32 28 56.0 ## 2 102368018 M 10 9.5 82.9 66 59 78.8 ## 3 102368024 F 9 8 82.6 69 68 81.2 ## 4 102368027 F 9 8 82.6 68 83.5 86.0 ## 5 102368030 F 11 0 66.5 39 30 45.2 ## 6 100368033 M 4 12 73.3 58 79 82.1 3.2 常態檢定 以qqnorm()和qqline()來看常態Q-Q圖。 qqnorm(gData1$總成績) qqline(gData1$總成績) 以shapiro.test()做常態檢定。 shapiro.test(gData1$總成績) ## ## Shapiro-Wilk normality test ## ## data: gData1$總成績 ## W = 0.98346, p-value = 0.6243 3.3 獨立樣本t檢定 先將性別轉為factor。 gData1$性別 &lt;- factor(gData1$性別) 以leveneTest()做變異數同質性檢定。 library(car) leveneTest(gData1$總成績 ~ gData1$性別, center=&quot;mean&quot;) ## Levene&#39;s Test for Homogeneity of Variance (center = &quot;mean&quot;) ## Df F value Pr(&gt;F) ## group 1 0.2112 0.6476 ## 55 以獨立樣本t檢定比較男女在總成績上是否有差異。 t.test(gData1$總成績 ~ gData1$性別, var.equal=TRUE) ## ## Two Sample t-test ## ## data: gData1$總成績 by gData1$性別 ## t = -0.62999, df = 55, p-value = 0.5313 ## alternative hypothesis: true difference in means between group F and group M is not equal to 0 ## 95 percent confidence interval: ## -7.892010 4.116907 ## sample estimates: ## mean in group F mean in group M ## 73.43611 75.32366 3.4 相依樣本t檢定 以t.test()做相依樣本t檢定，比較期中考和期末考是否有差異。 t.test(gData1$期中考, gData1$期末考, pair=TRUE) ## ## Paired t-test ## ## data: gData1$期中考 and gData1$期末考 ## t = -2.3616, df = 56, p-value = 0.0217 ## alternative hypothesis: true mean difference is not equal to 0 ## 95 percent confidence interval: ## -8.3334024 -0.6841415 ## sample estimates: ## mean difference ## -4.508772 t.test()預設為雙尾檢定，若要做單尾檢定，可加入alternative的參數，可設定為”greater” 或 “less”。 t.test(gData1$期中考, gData1$期末考, alternative=&#39;less&#39;, pair=TRUE) ## ## Paired t-test ## ## data: gData1$期中考 and gData1$期末考 ## t = -2.3616, df = 56, p-value = 0.01085 ## alternative hypothesis: true mean difference is less than 0 ## 95 percent confidence interval: ## -Inf -1.315556 ## sample estimates: ## mean difference ## -4.508772 "],["within1way.html", "Chapter 4 相依樣本單因子變異數分析 4.1 資料準備 4.2 描述統計 4.3 變異數分析", " Chapter 4 相依樣本單因子變異數分析 以R語言讀入資料並做相依樣本單因子變異數分析。 4.1 資料準備 4.1.1 讀入檔案 以xlsx套件的read.xlsx()函數或readxl套件的read_xlsx()函數來讀入上個單元中所存出的gData1.xlsx檔。 library(readxl) gData1 &lt;- read_xlsx(&quot;gData1.xlsx&quot;) head(gData1) ## # A tibble: 6 × 8 ## 學號 性別 組別 出席 影片 期中考 期末考 總成績 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 102368014 M 9 8.5 82.6 32 28 56.0 ## 2 102368018 M 10 9.5 82.9 66 59 78.8 ## 3 102368024 F 9 8 82.6 69 68 81.2 ## 4 102368027 F 9 8 82.6 68 83.5 86.0 ## 5 102368030 F 11 0 66.5 39 30 45.2 ## 6 100368033 M 4 12 73.3 58 79 82.1 4.1.2 準備可供變異數分析的資料 新增一假設的期初考成績，以做為變異數分析之用。 library(tibble) gData1 &lt;- add_column(gData1, 期初考=gData1$出席*8, .after = 5) head(gData1) ## # A tibble: 6 × 9 ## 學號 性別 組別 出席 影片 期初考 期中考 期末考 總成績 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 102368014 M 9 8.5 82.6 68 32 28 56.0 ## 2 102368018 M 10 9.5 82.9 76 66 59 78.8 ## 3 102368024 F 9 8 82.6 64 69 68 81.2 ## 4 102368027 F 9 8 82.6 64 68 83.5 86.0 ## 5 102368030 F 11 0 66.5 0 39 30 45.2 ## 6 100368033 M 4 12 73.3 96 58 79 82.1 選擇期初考、期中考和期末考進來分析，並加入編號（亦可使用學號，這邊方便起見加入編號來做）。 gData3 &lt;- subset(gData1, select = c(期初考, 期中考, 期末考)) gData3 &lt;- add_column(gData3, id = c(1:nrow(gData3)), .after = 0) head(gData3) ## # A tibble: 6 × 4 ## id 期初考 期中考 期末考 ## &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 1 68 32 28 ## 2 2 76 66 59 ## 3 3 64 69 68 ## 4 4 64 68 83.5 ## 5 5 0 39 30 ## 6 6 96 58 79 用reshape2套件的melt()函數，將期初、期中、期末考合併為一行。 library(reshape2) gData3m &lt;- melt(gData3, id = c(&quot;id&quot;), measured = c(&quot;期初考&quot;, &quot;期中考&quot;, &quot;期末考&quot;)) head(gData3m) ## id variable value ## 1 1 期初考 68 ## 2 2 期初考 76 ## 3 3 期初考 64 ## 4 4 期初考 64 ## 5 5 期初考 0 ## 6 6 期初考 96 更改column的名稱。 names(gData3m) &lt;- c(&#39;編號&#39;, &#39;考試&#39;, &#39;成績&#39;) head(gData3m) ## 編號 考試 成績 ## 1 1 期初考 68 ## 2 2 期初考 76 ## 3 3 期初考 64 ## 4 4 期初考 64 ## 5 5 期初考 0 ## 6 6 期初考 96 以上資料格式即為變異數分析所需的格式。 在執行相依樣本單因子變異數分析時，要注意的是，資料必須如此例這般，不同組的資料以「接續」的方式排列。若拿到的資料是一般相依樣本的資料輸入方式（即不同組在不同的columns），需先進行資料的處理，將wide data轉為long data，再做相依樣本單因子變異數分析。 4.2 描述統計 檢視三次考試的平均數和標準差。 library(vtable) st(gData3m, group=&#39;考試&#39;) Table 4.1: Summary Statistics 考試 期初考 期中考 期末考 Variable N Mean SD N Mean SD N Mean SD 編號 57 29 16.598 57 29 16.598 57 29 16.598 成績 57 82.807 18.485 57 54.947 13.313 57 59.456 18.216 以boxplot來看作圖。 boxplot(成績~考試, data=gData3m) 以ggpubr套件的ggline函數來作圖，畫平均數和標準差。 library(ggpubr) ggline(gData3m,x=&quot;考試&quot;,y=&quot;成績&quot;,add=c(&quot;mean_sd&quot;)) 4.3 變異數分析 先將編號的格式改為factor。 gData3m$編號 &lt;- factor(gData3m$編號) head(gData3m) ## 編號 考試 成績 ## 1 1 期初考 68 ## 2 2 期初考 76 ## 3 3 期初考 64 ## 4 4 期初考 64 ## 5 5 期初考 0 ## 6 6 期初考 96 4.3.1 球型檢定與變異數分析 用rstatix package中的anova_test()來做變異數分析，將結果儲存為res。並以res來看檢驗的結果。 因本資料違反球型檢定，需要看sphericity correction的表。Sphericity Corrections以Greenhouse-Geisser (GG)和Huynh-Feldt (HF) epsilon values來做校正。校正後的值 p[GG] 和 p[HF] 皆小於.001，表示不同考試成績有顯著差異。 library(rstatix) res &lt;- anova_test(data = gData3m, dv = 成績, wid = 編號, within = 考試) res ## ANOVA Table (type III tests) ## ## $ANOVA ## Effect DFn DFd F p p&lt;.05 ges ## 1 考試 2 112 73.704 3.74e-21 * 0.349 ## ## $`Mauchly&#39;s Test for Sphericity` ## Effect W p p&lt;.05 ## 1 考試 0.84 0.008 * ## ## $`Sphericity Corrections` ## Effect GGe DF[GG] p[GG] p[GG]&lt;.05 HFe DF[HF] p[HF] ## 1 考試 0.862 1.72, 96.57 1.4e-18 * 0.887 1.77, 99.36 4.8e-19 ## p[HF]&lt;.05 ## 1 * 最後，用get_anova_table()來看校正後的結果。校正的結果顯示，F(1.72, 96.57) = 73.704, p &lt; .001。三次考試的成績顯著不同。 get_anova_table(res) ## ANOVA Table (type III tests) ## ## Effect DFn DFd F p p&lt;.05 ges ## 1 考試 1.72 96.57 73.704 1.4e-18 * 0.349 4.3.2 多重比較 可用pairwise_t_test()來做兩兩比較，看差異來自於哪裡。結果顯示期中和期末考沒有差異，其餘兩兩比較都有差異。 pairwise_t_test(gData3m, 成績 ~ 考試, paired = TRUE, p.adjust.method = &quot;bonferroni&quot;) ## # A tibble: 3 × 10 ## .y. group1 group2 n1 n2 statistic df p p.adj p.adj.signif ## * &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 成績 期初考 期中考 57 57 10.4 56 1.11e-14 3.33e-14 **** ## 2 成績 期初考 期末考 57 57 8.60 56 8.06e-12 2.42e-11 **** ## 3 成績 期中考 期末考 57 57 -2.36 56 2.2 e- 2 6.5 e- 2 ns 4.3.3 若未違反球型檢定 若是球型檢定沒有違反，也可以用aov()來做變異數分析。在aov()中，以y~factor(x)+Error(factor(Subj)/factor(x))來執行變異數分析。 ANOVAData &lt;- aov(成績~factor(考試)+Error(factor(編號)/factor(考試)), data=gData3m) 以model.tables()來看各組的邊緣平均數(marginal mean)和總平均數(ground mean)。總平均數為65.74，期初、期中和期末考的平均數分別為82.81、54.95與59.46。 model.tables(ANOVAData,type=&quot;means&quot;) ## Tables of means ## Grand mean ## ## 65.73684 ## ## factor(考試) ## factor(考試) ## 期初考 期中考 期末考 ## 82.81 54.95 59.46 以summary()來看ANOVA table。可得到F(2,112)=73.7，p&lt;.001，表示三次考試的成績有顯著差異。 summary(ANOVAData,type=&quot;means&quot;) ## ## Error: factor(編號) ## Df Sum Sq Mean Sq F value Pr(&gt;F) ## Residuals 56 28272 504.9 ## ## Error: factor(編號):factor(考試) ## Df Sum Sq Mean Sq F value Pr(&gt;F) ## factor(考試) 2 25493 12747 73.7 &lt;2e-16 *** ## Residuals 112 19370 173 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 "],["between1way.html", "Chapter 5 獨立樣本單因子變異數分析 5.1 資料準備 5.2 描述統計 5.3 獨立樣本變異數分析", " Chapter 5 獨立樣本單因子變異數分析 以R語言讀入資料並做獨立樣本單因子變異數分析。 5.1 資料準備 5.1.1 讀入檔案 接續前一單元，以gData3m變數來做分析，或以xlsx套件的read.xlsx()函數或readxl套件的read_xlsx()函數來讀入gData3m.xlsx檔。 library(readxl) gData3m &lt;- read_xlsx(&quot;gData3m.xlsx&quot;) head(gData3m) ## # A tibble: 6 × 3 ## 編號 考試 成績 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 1 期初考 68 ## 2 2 期初考 76 ## 3 3 期初考 64 ## 4 4 期初考 64 ## 5 5 期初考 0 ## 6 6 期初考 96 5.1.2 準備可供變異數分析的資料 將考試修改為班別的資料。 cData &lt;- gData3m names(cData)[2] &lt;- &#39;班別&#39; 將期初、期中、期末考改為A班、B班、C班，並將編號改為1~171，共171名受試者（不改也不影響分析，但還是改一下，符合一般情境）。 library(plyr) ## ## Attaching package: &#39;plyr&#39; ## The following objects are masked from &#39;package:rstatix&#39;: ## ## desc, mutate ## The following object is masked from &#39;package:ggpubr&#39;: ## ## mutate ## The following objects are masked from &#39;package:Hmisc&#39;: ## ## is.discrete, summarize cData$班別 &lt;- revalue(cData$班別, c(&quot;期初考&quot;=&quot;A&quot;, &quot;期中考&quot;=&quot;B&quot;, &quot;期末考&quot;=&quot;C&quot;)) cData$編號 &lt;- c(1:171) head(cData) ## # A tibble: 6 × 3 ## 編號 班別 成績 ## &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 1 A 68 ## 2 2 A 76 ## 3 3 A 64 ## 4 4 A 64 ## 5 5 A 0 ## 6 6 A 96 5.2 描述統計 參考前一單元。 5.3 獨立樣本變異數分析 確認班別是factor。若不是的話轉為factor。 cData$班別 &lt;- factor(cData$班別) str(cData) ## tibble [171 × 3] (S3: tbl_df/tbl/data.frame) ## $ 編號: int [1:171] 1 2 3 4 5 6 7 8 9 10 ... ## $ 班別: Factor w/ 3 levels &quot;A&quot;,&quot;B&quot;,&quot;C&quot;: 1 1 1 1 1 1 1 1 1 1 ... ## $ 成績: num [1:171] 68 76 64 64 0 96 96 40 96 96 ... 5.3.1 變異數同質性檢定 先以leveneTest()函數進行變異數同質性檢定。由結果可知資料並未違反變異數同質假設（F(2,168)=1.46, p=0.23）。 library(car) leveneTest(成績~班別, data=cData, center=mean) ## Levene&#39;s Test for Homogeneity of Variance (center = mean) ## Df F value Pr(&gt;F) ## group 2 1.4619 0.2347 ## 168 5.3.2 變異數分析 因變異數同質，可用anova()來做變異數分析。結果顯示三個班級的考試成績有差異，F(2,168)=44.95, p&lt;.001。 anova(lm(成績 ~ 班別, data = cData)) ## Analysis of Variance Table ## ## Response: 成績 ## Df Sum Sq Mean Sq F value Pr(&gt;F) ## 班別 2 25493 12746.6 44.949 2.314e-16 *** ## Residuals 168 47642 283.6 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 也可以用aov()來做。結果同上。 anova1 &lt;- aov(成績~factor(班別),data=cData) model.tables(anova1, type=&quot;means&quot;) ## Tables of means ## Grand mean ## ## 65.73684 ## ## factor(班別) ## factor(班別) ## A B C ## 82.81 54.95 59.46 summary(anova1) ## Df Sum Sq Mean Sq F value Pr(&gt;F) ## factor(班別) 2 25493 12747 44.95 2.31e-16 *** ## Residuals 168 47642 284 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 5.3.3 事後比較 可用TukeyHSD()來做事後比較。結果顯示A班和B班、A班和C班的成績有差異，B班和C班則無。 TukeyHSD(anova1) ## Tukey multiple comparisons of means ## 95% family-wise confidence level ## ## Fit: aov(formula = 成績 ~ factor(班別), data = cData) ## ## $`factor(班別)` ## diff lwr upr p adj ## B-A -27.859649 -35.318779 -20.40052 0.0000000 ## C-A -23.350877 -30.810007 -15.89175 0.0000000 ## C-B 4.508772 -2.950358 11.96790 0.3281624 或做pairwise t test。結果同上。 library(rstatix) pairwise_t_test(cData, 成績~班別, paired = FALSE, p.adjust.method = &quot;bonferroni&quot;) ## # A tibble: 3 × 9 ## .y. group1 group2 n1 n2 p p.signif p.adj p.adj.signif ## * &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 成績 A B 57 57 1.32e-15 **** 3.95e-15 **** ## 2 成績 A C 57 57 6.12e-12 **** 1.84e-11 **** ## 3 成績 B C 57 57 1.55e- 1 ns 4.64e- 1 ns 5.3.4 變異數不同質時 若變異數不同質，可用oneway.test()函數，將var.equal設為FALSE來做ANOVA。 oneway.test(成績~班別, data=cData, var.equal=FALSE) ## ## One-way analysis of means (not assuming equal variances) ## ## data: 成績 and 班別 ## F = 43.952, num df = 2.00, denom df = 109.09, p-value = 1e-14 可用games_howell_test來做事後比較。games_howell_test()假設變異數不同質。 library(rstatix) games_howell_test(cData, 成績 ~ 班別, conf.level = 0.95, detailed = FALSE) ## # A tibble: 3 × 8 ## .y. group1 group2 estimate conf.low conf.high p.adj p.adj.signif ## * &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 成績 A B -27.9 -35.0 -20.7 4.72e-14 **** ## 2 成績 A C -23.4 -31.5 -15.2 1.66e- 9 **** ## 3 成績 B C 4.51 -2.60 11.6 2.91e- 1 ns "],["mixed2way.html", "Chapter 6 混合樣本二因子變異數分析 6.1 資料準備 6.2 描述統計 6.3 變異數分析", " Chapter 6 混合樣本二因子變異數分析 以R語言讀入資料並做混合樣本二因子變異數分析。 6.1 資料準備 6.1.1 讀入檔案 以xlsx套件的read.xlsx()函數或readxl套件的read_xlsx()函數來讀入上個單元中所存出的gData1.xlsx檔。 library(readxl) gData1 &lt;- read_xlsx(&quot;gData1.xlsx&quot;) gData1 &lt;- as.data.frame(gData1) head(gData1) ## 學號 性別 組別 出席 影片 期中考 期末考 總成績 ## 1 102368014 M 9 8.5 82.58333 32 28.0 56.02778 ## 2 102368018 M 10 9.5 82.93333 66 59.0 78.81111 ## 3 102368024 F 9 8.0 82.58333 69 68.0 81.19444 ## 4 102368027 F 9 8.0 82.58333 68 83.5 86.02778 ## 5 102368030 F 11 0.0 66.53333 39 30.0 45.17778 ## 6 100368033 M 4 12.0 73.33333 58 79.0 82.11111 6.1.2 準備可供變異數分析的資料 新增一假設的期初考成績，以做為變異數分析之用。 library(tibble) gData1 &lt;- add_column(gData1, 期初考=gData1$出席*8, .after = 5) head(gData1) ## 學號 性別 組別 出席 影片 期初考 期中考 期末考 總成績 ## 1 102368014 M 9 8.5 82.58333 68 32 28.0 56.02778 ## 2 102368018 M 10 9.5 82.93333 76 66 59.0 78.81111 ## 3 102368024 F 9 8.0 82.58333 64 69 68.0 81.19444 ## 4 102368027 F 9 8.0 82.58333 64 68 83.5 86.02778 ## 5 102368030 F 11 0.0 66.53333 0 39 30.0 45.17778 ## 6 100368033 M 4 12.0 73.33333 96 58 79.0 82.11111 加入編號（亦可使用學號，這邊方便起見加入編號來做），並選擇性別、期初考、期中考和期末考進來分析。 gData2 &lt;- add_column(gData1, 編號 = c(1:nrow(gData1)), .after = 0) gData2WA &lt;- subset(gData2, select = c(&quot;編號&quot;, &quot;性別&quot;, &quot;期初考&quot;, &quot;期中考&quot;, &quot;期末考&quot;)) head(gData2WA) ## 編號 性別 期初考 期中考 期末考 ## 1 1 M 68 32 28.0 ## 2 2 M 76 66 59.0 ## 3 3 F 64 69 68.0 ## 4 4 F 64 68 83.5 ## 5 5 F 0 39 30.0 ## 6 6 M 96 58 79.0 移除gData2WA的三位女生的資料，使資料為等格。並將資料中男生的期初和期中考分數略加修改，改為有交互作用的資料。 gData2WAmi &lt;- gData2WA[-c(5, 47, 56), ] gData2WAmi[which(gData2WAmi$性別==&#39;M&#39;), c(&#39;期初考&#39;)] &lt;- gData2WAmi[which(gData2WAmi$性別==&#39;M&#39;), c(&#39;期初考&#39;)]-22 gData2WAmi[which(gData2WAmi$性別==&#39;M&#39;), c(&#39;期中考&#39;)] &lt;- gData2WAmi[which(gData2WAmi$性別==&#39;M&#39;), c(&#39;期中考&#39;)]-18 head(gData2WAmi) ## 編號 性別 期初考 期中考 期末考 ## 1 1 M 46 14 28.0 ## 2 2 M 54 48 59.0 ## 3 3 F 64 69 68.0 ## 4 4 F 64 68 83.5 ## 6 6 M 74 40 79.0 ## 7 7 F 96 67 78.0 將三次考試的資料合併為一行，並重新命名資料的欄位名稱。 library(reshape) ## ## Attaching package: &#39;reshape&#39; ## The following objects are masked from &#39;package:plyr&#39;: ## ## rename, round_any ## The following objects are masked from &#39;package:reshape2&#39;: ## ## colsplit, melt, recast gData2WAmim &lt;- melt(gData2WAmi, id = c(&quot;編號&quot;, &quot;性別&quot;), measured = c(&quot;期初考&quot;, &quot;期中考&quot;, &quot;期末考&quot;)) names(gData2WAmim)[3:4] &lt;- c(&#39;考試類型&#39;, &#39;成績&#39;) head(gData2WAmim) ## 編號 性別 考試類型 成績 ## 1 1 M 期初考 46 ## 2 2 M 期初考 54 ## 3 3 F 期初考 64 ## 4 4 F 期初考 64 ## 5 6 M 期初考 74 ## 6 7 F 期初考 96 以上資料格式即為變異數分析所需的格式。 在執行混合因子變異數分析時，要注意的是，資料必須如此例這般，不同受試者內組別的資料以「接續」的方式排列。若拿到的資料是一般的資料輸入方式（即不同受試者內的組別在不同的columns），需先進行資料的處理，將wide data轉為long data，再做混合因子變異數分析。 6.2 描述統計 檢視不同性別在三次考試的平均數和標準差。 library(rstatix) get_summary_stats(group_by(gData2WAmim, 性別, 考試類型), 成績, type = &quot;mean_sd&quot;) ## # A tibble: 6 × 6 ## 性別 考試類型 variable n mean sd ## &lt;chr&gt; &lt;fct&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 F 期初考 成績 27 85.5 13.6 ## 2 F 期中考 成績 27 54.9 12.2 ## 3 F 期末考 成績 27 63.1 15.0 ## 4 M 期初考 成績 27 61.4 16.1 ## 5 M 期中考 成績 27 39.0 13.8 ## 6 M 期末考 成績 27 59.6 17.3 也可以用psych套件的describeBy()函數。 library(psych) with(gData2WAmim, describeBy(成績,list(性別, 考試類型))) ## ## Descriptive statistics by group ## : F ## : 期初考 ## vars n mean sd median trimmed mad min max range skew kurtosis se ## X1 1 27 85.48 13.64 88 87.48 11.86 40 96 56 -1.54 2.27 2.62 ## ------------------------------------------------------------ ## : M ## : 期初考 ## vars n mean sd median trimmed mad min max range skew kurtosis se ## X1 1 27 61.41 16.07 66 63.74 11.86 18 74 56 -1.24 0.45 3.09 ## ------------------------------------------------------------ ## : F ## : 期中考 ## vars n mean sd median trimmed mad min max range skew kurtosis se ## X1 1 27 54.85 12.15 55 54.61 14.83 35 85 50 0.23 -0.48 2.34 ## ------------------------------------------------------------ ## : M ## : 期中考 ## vars n mean sd median trimmed mad min max range skew kurtosis se ## X1 1 27 38.96 13.8 40 38.26 8.9 14 71 57 0.3 -0.27 2.66 ## ------------------------------------------------------------ ## : F ## : 期末考 ## vars n mean sd median trimmed mad min max range skew kurtosis se ## X1 1 27 63.09 15.04 58.5 61.91 14.08 43 104 61 0.81 -0.01 2.9 ## ------------------------------------------------------------ ## : M ## : 期末考 ## vars n mean sd median trimmed mad min max range skew kurtosis se ## X1 1 27 59.57 17.3 59 58.76 14.83 28 100 72 0.47 -0.32 3.33 以ggpubr套件的ggline函數來作圖，畫平均數和標準差。 library(ggpubr) ggline(gData2WAmim,x=&quot;考試類型&quot;,y=&quot;成績&quot;,color=&quot;性別&quot;, add=c(&quot;mean_sd&quot;), size=1) 6.3 變異數分析 先將編號和性別的格式改為factor。 gData2WAmim$編號 &lt;- factor(gData2WAmim$編號) gData2WAmim$性別 &lt;- factor(gData2WAmim$性別) str(gData2WAmim) ## &#39;data.frame&#39;: 162 obs. of 4 variables: ## $ 編號 : Factor w/ 54 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 2 3 4 5 6 7 8 9 10 ... ## $ 性別 : Factor w/ 2 levels &quot;F&quot;,&quot;M&quot;: 2 2 1 1 2 1 1 1 2 2 ... ## $ 考試類型: Factor w/ 3 levels &quot;期初考&quot;,&quot;期中考&quot;,..: 1 1 1 1 1 1 1 1 1 1 ... ## $ 成績 : num 46 54 64 64 74 96 40 96 74 66 ... 用levene_test()做變異數同質性檢定。預設值是center=median，如有需要可改為center=mean。分析結果可知，無論是何種考試類型，成績在不同性別上都不違反變異數同質性假設。 levene_test(group_by(gData2WAmim, 考試類型), 成績 ~ 性別) ## # A tibble: 3 × 5 ## 考試類型 df1 df2 statistic p ## &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 期初考 1 52 0.239 0.627 ## 2 期中考 1 52 0.156 0.695 ## 3 期末考 1 52 0.273 0.604 用rstatix package中的anova_test()來做球型檢定和變異數分析，將結果儲存為res.aov。並以res.aov來看檢驗的結果。 因本資料違反球型假設，需要看sphericity correction的表。Sphericity Corrections以Greenhouse-Geisser (GG)和Huynh-Feldt (HF) epsilon values來做校正。校正後的值 p[GG] 和 p[HF] 皆小於.001，表示不同考試類型的成績有顯著差異，且存在性別與考試類型的交互作用。 library(rstatix) res.aov &lt;- anova_test(data = gData2WAmim, dv = 成績, wid = 編號, between = 性別, within = 考試類型) res.aov ## ANOVA Table (type II tests) ## ## $ANOVA ## Effect DFn DFd F p p&lt;.05 ges ## 1 性別 1 52 22.604 1.62e-05 * 0.200 ## 2 考試類型 2 104 68.691 9.66e-20 * 0.359 ## 3 性別:考試類型 2 104 10.420 7.51e-05 * 0.078 ## ## $`Mauchly&#39;s Test for Sphericity` ## Effect W p p&lt;.05 ## 1 考試類型 0.817 0.006 * ## 2 性別:考試類型 0.817 0.006 * ## ## $`Sphericity Corrections` ## Effect GGe DF[GG] p[GG] p[GG]&lt;.05 HFe DF[HF] p[HF] ## 1 考試類型 0.846 1.69, 87.94 4.53e-17 * 0.871 1.74, 90.57 1.65e-17 ## 2 性別:考試類型 0.846 1.69, 87.94 2.11e-04 * 0.871 1.74, 90.57 1.78e-04 ## p[HF]&lt;.05 ## 1 * ## 2 * 最後，用get_anova_table()來看校正後的結果。校正的結果顯示，性別主效果顯著，F(1, 52) = 22.6, p &lt; .001；考試類型主效果顯著，F(1.69, 87.94) = 68.7, p &lt; .001；兩變項的交互作用顯著，F(1.69, 87.94) = 10.4, p &lt; .001。 get_anova_table(res.aov) ## ANOVA Table (type II tests) ## ## Effect DFn DFd F p p&lt;.05 ges ## 1 性別 1.00 52.00 22.604 1.62e-05 * 0.200 ## 2 考試類型 1.69 87.94 68.691 4.53e-17 * 0.359 ## 3 性別:考試類型 1.69 87.94 10.420 2.11e-04 * 0.078 6.3.1 事後比較 交互作用顯著時的單純主要效果檢驗 因交互作用顯著，故需分析單純主要效果。先依考試類型來分組，看性別的主要效果。可知男女在期初考和期考成績有差異，在期末考則無。adjust_pvalue()會考慮alpha值膨脹的問題，在控制三個檢定的alpha值不超過.05來計算p value。 anova1 &lt;- anova_test(group_by(gData2WAmim, 考試類型), dv=成績, wid=編號, between=性別) adjust_pvalue(get_anova_table(anova1), method=&quot;bonferroni&quot;) ## # A tibble: 3 × 9 ## 考試類型 Effect DFn DFd F p `p&lt;.05` ges p.adj ## &lt;fct&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 期初考 性別 1 52 35.2 0.000000243 &quot;*&quot; 0.404 0.000000729 ## 2 期中考 性別 1 52 20.2 0.0000398 &quot;*&quot; 0.279 0.000119 ## 3 期末考 性別 1 52 0.636 0.429 &quot;&quot; 0.012 1 依性別來分組，看考試類型的主要效果。可知考試類型在男女上皆有差異。 anova2 &lt;- anova_test(group_by(gData2WAmim, 性別), dv=成績, wid=編號, within=考試類型) adjust_pvalue(get_anova_table(anova2), method = &quot;bonferroni&quot;) ## # A tibble: 2 × 9 ## 性別 Effect DFn DFd F p `p&lt;.05` ges p.adj ## &lt;fct&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 F 考試類型 2 52 43.6 7.63e-12 * 0.482 1.53e-11 ## 2 M 考試類型 2 52 34.4 3.03e-10 * 0.301 6.06e-10 進一步以兩兩比較去看兩個主效果的差異在哪裡。結果顯示，女生無論是期初vs.期中、期初vs.期末、期vs.期末都有差異；男生則只有期初vs.期中、期中vs.期末有差異。 pairwise_t_test(group_by(gData2WAmim,性別), 成績 ~ 考試類型, paired = TRUE, p.adjust.method = &quot;bonferroni&quot;) ## # A tibble: 6 × 11 ## 性別 .y. group1 group2 n1 n2 statistic df p p.adj ## * &lt;fct&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 F 成績 期初考 期中考 27 27 8.73 26 0.00000000334 1 e-8 ## 2 F 成績 期初考 期末考 27 27 5.72 26 0.00000506 1.52e-5 ## 3 F 成績 期中考 期末考 27 27 -3.13 26 0.004 1.3 e-2 ## 4 M 成績 期初考 期中考 27 27 6.67 26 0.000000447 1.34e-6 ## 5 M 成績 期初考 期末考 27 27 0.557 26 0.582 1 e+0 ## 6 M 成績 期中考 期末考 27 27 -9.27 26 0.000000001 3 e-9 ## # … with 1 more variable: p.adj.signif &lt;chr&gt; 6.3.2 交互作用未顯著時的事後比較 若交互作用未顯著，看主效果的事後比較。因性別只有兩個levels，不需進行事後比較。因此看考試類型的兩兩比較，結果顯示，三種考試的成績兩兩之間都有差異。 pairwise_t_test(gData2WAmim, 成績~考試類型, paired = TRUE, p.adjust.method = &quot;bonferroni&quot;) ## # A tibble: 3 × 10 ## .y. group1 group2 n1 n2 statistic df p p.adj p.adj.signif ## * &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 成績 期初考 期中考 54 54 10.7 53 6.73e-15 2.02e-14 **** ## 2 成績 期初考 期末考 54 54 4.18 53 1.1 e- 4 3.3 e- 4 *** ## 3 成績 期中考 期末考 54 54 -7.56 53 5.6 e-10 1.68e- 9 **** "],["multireg.html", "Chapter 7 多元迴歸 7.1 資料的準備與檢視 7.2 迴歸分析 7.3 迴歸假設的檢驗 7.4 逐步迴歸 7.5 類別變項的迴歸", " Chapter 7 多元迴歸 以R語言內建的mtcars做多元迴歸。 7.1 資料的準備與檢視 7.1.1 讀入檔案 讀入mtcars檔案。mtcars是R內建的dataset，為1974年美國的Motor Trend雜誌對32種車款在11項設計與表現所做的整理，包含油耗量（mpg）、氣缸數（cyl）、排氣量（disp）、馬力（hp）、車體重量（wt）、加速時間（qsec）等。 data(mtcars) head(mtcars, 10) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Mazda RX4 21.0 6 160.0 110 3.90 2.620 16.46 0 1 4 4 ## Mazda RX4 Wag 21.0 6 160.0 110 3.90 2.875 17.02 0 1 4 4 ## Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1 ## Hornet 4 Drive 21.4 6 258.0 110 3.08 3.215 19.44 1 0 3 1 ## Hornet Sportabout 18.7 8 360.0 175 3.15 3.440 17.02 0 0 3 2 ## Valiant 18.1 6 225.0 105 2.76 3.460 20.22 1 0 3 1 ## Duster 360 14.3 8 360.0 245 3.21 3.570 15.84 0 0 3 4 ## Merc 240D 24.4 4 146.7 62 3.69 3.190 20.00 1 0 4 2 ## Merc 230 22.8 4 140.8 95 3.92 3.150 22.90 1 0 4 2 ## Merc 280 19.2 6 167.6 123 3.92 3.440 18.30 1 0 4 4 7.1.2 檢視相關 先用plot()看各變項的關鍵性。 plot(mtcars[1:7]) 計算各變項的相關。 library(Hmisc) rcorr(data.matrix(mtcars[1:7])) ## mpg cyl disp hp drat wt qsec ## mpg 1.00 -0.85 -0.85 -0.78 0.68 -0.87 0.42 ## cyl -0.85 1.00 0.90 0.83 -0.70 0.78 -0.59 ## disp -0.85 0.90 1.00 0.79 -0.71 0.89 -0.43 ## hp -0.78 0.83 0.79 1.00 -0.45 0.66 -0.71 ## drat 0.68 -0.70 -0.71 -0.45 1.00 -0.71 0.09 ## wt -0.87 0.78 0.89 0.66 -0.71 1.00 -0.17 ## qsec 0.42 -0.59 -0.43 -0.71 0.09 -0.17 1.00 ## ## n= 32 ## ## ## P ## mpg cyl disp hp drat wt qsec ## mpg 0.0000 0.0000 0.0000 0.0000 0.0000 0.0171 ## cyl 0.0000 0.0000 0.0000 0.0000 0.0000 0.0004 ## disp 0.0000 0.0000 0.0000 0.0000 0.0000 0.0131 ## hp 0.0000 0.0000 0.0000 0.0100 0.0000 0.0000 ## drat 0.0000 0.0000 0.0000 0.0100 0.0000 0.6196 ## wt 0.0000 0.0000 0.0000 0.0000 0.0000 0.3389 ## qsec 0.0171 0.0004 0.0131 0.0000 0.6196 0.3389 7.2 迴歸分析 7.2.1 簡單迴歸 以lm()檢驗是否可以用車體重量（wt）預測油耗量（mpg）。結果顯示R-square = 0.75，F(1,30) = 91.38，p&lt;.001，F檢定顯著，模型有良好解釋力。迴歸式為 mpg = -5.3445*wt + 37.2851。 model.mpg.wt &lt;- lm(mpg ~ wt, data = mtcars) summary(model.mpg.wt) ## ## Call: ## lm(formula = mpg ~ wt, data = mtcars) ## ## Residuals: ## Min 1Q Median 3Q Max ## -4.5432 -2.3647 -0.1252 1.4096 6.8727 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 37.2851 1.8776 19.858 &lt; 2e-16 *** ## wt -5.3445 0.5591 -9.559 1.29e-10 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 3.046 on 30 degrees of freedom ## Multiple R-squared: 0.7528, Adjusted R-squared: 0.7446 ## F-statistic: 91.38 on 1 and 30 DF, p-value: 1.294e-10 以package visreg的visreg()函數來畫迴歸線。 library(visreg) visreg(model.mpg.wt) 7.2.2 多元迴歸 以車體重量（wt）、馬力（hp）和排氣量（disp）來預測油耗量（mpg）。相關分析顯示三個預測項與油耗量皆為負相關。 以lm()來做迴歸分析，迴歸分析結果顯示，R-square = 0.8268，F(3,28) = 44.57, p &lt; .01。disp沒有顯著。 model.mpg.whd &lt;- update(model.mpg.wt, .~. + hp + disp, data=mtcars) model.mpg.whd &lt;- lm(mpg ~ wt + hp + disp, data = mtcars) summary(model.mpg.whd) ## ## Call: ## lm(formula = mpg ~ wt + hp + disp, data = mtcars) ## ## Residuals: ## Min 1Q Median 3Q Max ## -3.891 -1.640 -0.172 1.061 5.861 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 37.105505 2.110815 17.579 &lt; 2e-16 *** ## wt -3.800891 1.066191 -3.565 0.00133 ** ## hp -0.031157 0.011436 -2.724 0.01097 * ## disp -0.000937 0.010350 -0.091 0.92851 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.639 on 28 degrees of freedom ## Multiple R-squared: 0.8268, Adjusted R-squared: 0.8083 ## F-statistic: 44.57 on 3 and 28 DF, p-value: 8.65e-11 若想進一步看淨相關和半淨相關，可用pcor()做淨相關(partial correlation)、用spcor()做半淨相關(semi-partial correlation)。淨相關結果顯示，三變項皆顯著相關，all ps &lt; .05。 library(ppcor) round(pcor(mtcars[c(1,6,4,3)])$estimate, 03) #partial ## mpg wt hp disp ## mpg 1.000 -0.559 -0.458 -0.017 ## wt -0.559 1.000 -0.370 0.651 ## hp -0.458 -0.370 1.000 0.521 ## disp -0.017 0.651 0.521 1.000 round(pcor(mtcars[c(1,6,4,3)])$p.value, 03) ## mpg wt hp disp ## mpg 0.000 0.001 0.011 0.929 ## wt 0.001 0.000 0.044 0.000 ## hp 0.011 0.044 0.000 0.003 ## disp 0.929 0.000 0.003 0.000 半淨相關結果顯示，僅wt顯著相關。 round(spcor(mtcars[c(1,6,4,3)])$estimate, 03) #semi-partial ## mpg wt hp disp ## mpg 1.000 -0.280 -0.214 -0.007 ## wt -0.254 1.000 -0.150 0.323 ## hp -0.277 -0.214 1.000 0.328 ## disp -0.006 0.317 0.226 1.000 round(spcor(mtcars[c(1,6,4,3)])$p.value, 03) ## mpg wt hp disp ## mpg 0.000 0.133 0.256 0.970 ## wt 0.176 0.000 0.429 0.081 ## hp 0.139 0.256 0.000 0.076 ## disp 0.974 0.088 0.230 0.000 看各變項對mpg的關係。 visreg(model.mpg.whd) 以predict()來做預測。 predict(model.mpg.whd, new = data.frame(wt = 5, hp = 250, disp = 300, am = &quot;Manual&quot;), interval = &quot;confidence&quot;, level = .95 ) ## fit lwr upr ## 1 10.03081 6.335154 13.72647 7.2.3 迴歸模型的比較 以ANOVA()來比較兩個迴歸模型。結果顯示三預測項的模型顯著優於一預測項模型。F(2, 83.33) = 5.98, p&lt;.001。 anova(model.mpg.wt, model.mpg.whd) ## Analysis of Variance Table ## ## Model 1: mpg ~ wt ## Model 2: mpg ~ wt + hp + disp ## Res.Df RSS Df Sum of Sq F Pr(&gt;F) ## 1 30 278.32 ## 2 28 194.99 2 83.331 5.983 0.006863 ** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 用AIC()來看兩個模型的AIC(Akaike information criterion)。結果顯示相較於一個預測項時，以三個預測項來預測mpg時，AIC有下降。 AIC(model.mpg.wt) ## [1] 166.0294 AIC(model.mpg.whd) ## [1] 158.643 7.3 迴歸假設的檢驗 檢驗資料是否符合迴歸分析的假設。 7.3.1 極端數值的影響 standardize resuduals和studentize residuals。 library(olsrr) ols_plot_resid_stand(model.mpg.whd) ols_plot_resid_stud(model.mpg.whd) 極端數值移除後對迴歸式的影響。 ols_plot_dfbetas(model.mpg.whd) ols_plot_dffits(model.mpg.whd) 以Cook’s distance看極端數值對整個模型的影響。 ols_plot_cooksd_bar(model.mpg.whd) ols_plot_cooksd_chart(model.mpg.whd) 看residual和leverage。 library(olsrr) ols_plot_resid_lev(model.mpg.whd) 7.3.2 Homoscedasticity診斷 看residual和fit。 ols_plot_resid_stud_fit(model.mpg.whd) 7.3.3 共線性multicollinearity的檢驗 看vif和tolerance。最大的VIF大於10要注意、平均的VIF大於1可能有偏誤；tolerance小於0.1要注意、tolerance小於0.2可能有問題。 library(car) vif(model.mpg.whd) ## wt hp disp ## 4.844618 2.736633 7.324517 1/vif(model.mpg.whd) ## wt hp disp ## 0.2064146 0.3654126 0.1365278 7.3.4 誤差常態的檢定 residuals常態分配的檢定。 shapiro.test(residuals(model.mpg.whd)) ## ## Shapiro-Wilk normality test ## ## data: residuals(model.mpg.whd) ## W = 0.92734, p-value = 0.03305 7.3.5 自相關檢驗 用Durbin-Watson test看是否有autocorrelation。 library(car) dwt(model.mpg.whd) ## lag Autocorrelation D-W Statistic p-value ## 1 0.2926117 1.367284 0.03 ## Alternative hypothesis: rho != 0 durbinWatsonTest(model.mpg.whd) ## lag Autocorrelation D-W Statistic p-value ## 1 0.2926117 1.367284 0.04 ## Alternative hypothesis: rho != 0 7.3.6 綜合檢驗 可用內建的plot()功能一次看上述檢驗。若加which=1:6可看更多。 plot(model.mpg.whd) 也可以將圖表放在一起看。 par(mfrow=c(2,2)) plot(model.mpg.whd) par(mfrow=c(1,1)) 或以performance這個package來看迴歸的假設。 library(performance) library(see) library(patchwork) check_model(model.mpg.whd) 計算各統計量並儲存。 mtcars$residuals &lt;- resid(model.mpg.whd) mtcars$standardized.residuals &lt;- rstandard(model.mpg.whd) mtcars$studentized.residuals &lt;- rstudent(model.mpg.whd) mtcars$cooks.distance &lt;- cooks.distance(model.mpg.whd) mtcars$leverage &lt;- hatvalues(model.mpg.whd) mtcars &lt;- cbind(mtcars, dfbetas(model.mpg.whd)) names(mtcars)[12:15] &lt;- c(&#39;db_intercept&#39;, &#39;db_wt&#39;, &#39;db_hp&#39;, &#39;db_disp&#39;) mtcars$dffit &lt;- dffits(model.mpg.whd) mtcars$fitted &lt;- fitted(model.mpg.whd) 7.4 逐步迴歸 7.4.1 前向法 用lm()做逐步回歸。以下為前向法。 mtcars2 &lt;- mtcars[c(1,6,4,3)] nullM &lt;- lm(mpg ~ 1, data = mtcars2) fullM &lt;- lm(mpg ~ ., data = mtcars2) forM &lt;- step(nullM, scope=list(lower=nullM, upper=fullM), direction=&quot;forward&quot;) ## Start: AIC=115.94 ## mpg ~ 1 ## ## Df Sum of Sq RSS AIC ## + wt 1 847.73 278.32 73.217 ## + disp 1 808.89 317.16 77.397 ## + hp 1 678.37 447.67 88.427 ## &lt;none&gt; 1126.05 115.943 ## ## Step: AIC=73.22 ## mpg ~ wt ## ## Df Sum of Sq RSS AIC ## + hp 1 83.274 195.05 63.840 ## + disp 1 31.639 246.68 71.356 ## &lt;none&gt; 278.32 73.217 ## ## Step: AIC=63.84 ## mpg ~ wt + hp ## ## Df Sum of Sq RSS AIC ## &lt;none&gt; 195.05 63.840 ## + disp 1 0.05708 194.99 65.831 summary(forM) ## ## Call: ## lm(formula = mpg ~ wt + hp, data = mtcars2) ## ## Residuals: ## Min 1Q Median 3Q Max ## -3.941 -1.600 -0.182 1.050 5.854 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 37.22727 1.59879 23.285 &lt; 2e-16 *** ## wt -3.87783 0.63273 -6.129 1.12e-06 *** ## hp -0.03177 0.00903 -3.519 0.00145 ** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.593 on 29 degrees of freedom ## Multiple R-squared: 0.8268, Adjusted R-squared: 0.8148 ## F-statistic: 69.21 on 2 and 29 DF, p-value: 9.109e-12 7.4.2 後向法 backward method。 fullM &lt;- lm(mpg ~ ., data = mtcars2) # backM &lt;- step(fullM, scope=list(upper=fullM), direction=&#39;backward&#39;) # 完整寫法 backM &lt;- step(fullM, direction=&#39;backward&#39;) ## Start: AIC=65.83 ## mpg ~ wt + hp + disp ## ## Df Sum of Sq RSS AIC ## - disp 1 0.057 195.05 63.840 ## &lt;none&gt; 194.99 65.831 ## - hp 1 51.692 246.68 71.356 ## - wt 1 88.503 283.49 75.806 ## ## Step: AIC=63.84 ## mpg ~ wt + hp ## ## Df Sum of Sq RSS AIC ## &lt;none&gt; 195.05 63.840 ## - hp 1 83.274 278.32 73.217 ## - wt 1 252.627 447.67 88.427 summary(backM) ## ## Call: ## lm(formula = mpg ~ wt + hp, data = mtcars2) ## ## Residuals: ## Min 1Q Median 3Q Max ## -3.941 -1.600 -0.182 1.050 5.854 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 37.22727 1.59879 23.285 &lt; 2e-16 *** ## wt -3.87783 0.63273 -6.129 1.12e-06 *** ## hp -0.03177 0.00903 -3.519 0.00145 ** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.593 on 29 degrees of freedom ## Multiple R-squared: 0.8268, Adjusted R-squared: 0.8148 ## F-statistic: 69.21 on 2 and 29 DF, p-value: 9.109e-12 7.4.3 逐步法 Stepwise method。 7.4.3.1 從full model開始 fullM &lt;- lm(mpg ~ ., data = mtcars2) # stepM1 &lt;- step(fullM, scope = list(upper=fullM), direction=&quot;both&quot;) # 完整寫法 stepM1 &lt;- step(fullM, direction=&quot;both&quot;) ## Start: AIC=65.83 ## mpg ~ wt + hp + disp ## ## Df Sum of Sq RSS AIC ## - disp 1 0.057 195.05 63.840 ## &lt;none&gt; 194.99 65.831 ## - hp 1 51.692 246.68 71.356 ## - wt 1 88.503 283.49 75.806 ## ## Step: AIC=63.84 ## mpg ~ wt + hp ## ## Df Sum of Sq RSS AIC ## &lt;none&gt; 195.05 63.840 ## + disp 1 0.057 194.99 65.831 ## - hp 1 83.274 278.32 73.217 ## - wt 1 252.627 447.67 88.427 7.4.3.2 從null model開始 結果可能會與從full model開始不同。 nullM &lt;- lm(mpg ~ 1, data = mtcars2) stepM2 &lt;- step(nullM, scope = list(upper=fullM), direction=&quot;both&quot;) ## Start: AIC=115.94 ## mpg ~ 1 ## ## Df Sum of Sq RSS AIC ## + wt 1 847.73 278.32 73.217 ## + disp 1 808.89 317.16 77.397 ## + hp 1 678.37 447.67 88.427 ## &lt;none&gt; 1126.05 115.943 ## ## Step: AIC=73.22 ## mpg ~ wt ## ## Df Sum of Sq RSS AIC ## + hp 1 83.27 195.05 63.840 ## + disp 1 31.64 246.68 71.356 ## &lt;none&gt; 278.32 73.217 ## - wt 1 847.73 1126.05 115.943 ## ## Step: AIC=63.84 ## mpg ~ wt + hp ## ## Df Sum of Sq RSS AIC ## &lt;none&gt; 195.05 63.840 ## + disp 1 0.057 194.99 65.831 ## - hp 1 83.274 278.32 73.217 ## - wt 1 252.627 447.67 88.427 summary(stepM1) ## ## Call: ## lm(formula = mpg ~ wt + hp, data = mtcars2) ## ## Residuals: ## Min 1Q Median 3Q Max ## -3.941 -1.600 -0.182 1.050 5.854 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 37.22727 1.59879 23.285 &lt; 2e-16 *** ## wt -3.87783 0.63273 -6.129 1.12e-06 *** ## hp -0.03177 0.00903 -3.519 0.00145 ** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.593 on 29 degrees of freedom ## Multiple R-squared: 0.8268, Adjusted R-squared: 0.8148 ## F-statistic: 69.21 on 2 and 29 DF, p-value: 9.109e-12 summary(stepM2) ## ## Call: ## lm(formula = mpg ~ wt + hp, data = mtcars2) ## ## Residuals: ## Min 1Q Median 3Q Max ## -3.941 -1.600 -0.182 1.050 5.854 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 37.22727 1.59879 23.285 &lt; 2e-16 *** ## wt -3.87783 0.63273 -6.129 1.12e-06 *** ## hp -0.03177 0.00903 -3.519 0.00145 ** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.593 on 29 degrees of freedom ## Multiple R-squared: 0.8268, Adjusted R-squared: 0.8148 ## F-statistic: 69.21 on 2 and 29 DF, p-value: 9.109e-12 7.4.3.3 另一種作法 可用stepAIC()來做逐步回歸。沒指定scope時會用backward；指定scope時會用both。可用direction來指定forward、backward或both。 library(MASS) summary(stepAIC(model.mpg.whd)) #沒指定scope時會用backward ## Start: AIC=65.83 ## mpg ~ wt + hp + disp ## ## Df Sum of Sq RSS AIC ## - disp 1 0.057 195.05 63.840 ## &lt;none&gt; 194.99 65.831 ## - hp 1 51.692 246.68 71.356 ## - wt 1 88.503 283.49 75.806 ## ## Step: AIC=63.84 ## mpg ~ wt + hp ## ## Df Sum of Sq RSS AIC ## &lt;none&gt; 195.05 63.840 ## - hp 1 83.274 278.32 73.217 ## - wt 1 252.627 447.67 88.427 ## ## Call: ## lm(formula = mpg ~ wt + hp, data = mtcars) ## ## Residuals: ## Min 1Q Median 3Q Max ## -3.941 -1.600 -0.182 1.050 5.854 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 37.22727 1.59879 23.285 &lt; 2e-16 *** ## wt -3.87783 0.63273 -6.129 1.12e-06 *** ## hp -0.03177 0.00903 -3.519 0.00145 ** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.593 on 29 degrees of freedom ## Multiple R-squared: 0.8268, Adjusted R-squared: 0.8148 ## F-statistic: 69.21 on 2 and 29 DF, p-value: 9.109e-12 summary(stepAIC(model.mpg.whd, scope = list(upper = ~wt+hp+disp, lower = ~1))) #指定scope時會用both ## Start: AIC=65.83 ## mpg ~ wt + hp + disp ## ## Df Sum of Sq RSS AIC ## - disp 1 0.057 195.05 63.840 ## &lt;none&gt; 194.99 65.831 ## - hp 1 51.692 246.68 71.356 ## - wt 1 88.503 283.49 75.806 ## ## Step: AIC=63.84 ## mpg ~ wt + hp ## ## Df Sum of Sq RSS AIC ## &lt;none&gt; 195.05 63.840 ## + disp 1 0.057 194.99 65.831 ## - hp 1 83.274 278.32 73.217 ## - wt 1 252.627 447.67 88.427 ## ## Call: ## lm(formula = mpg ~ wt + hp, data = mtcars) ## ## Residuals: ## Min 1Q Median 3Q Max ## -3.941 -1.600 -0.182 1.050 5.854 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 37.22727 1.59879 23.285 &lt; 2e-16 *** ## wt -3.87783 0.63273 -6.129 1.12e-06 *** ## hp -0.03177 0.00903 -3.519 0.00145 ** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.593 on 29 degrees of freedom ## Multiple R-squared: 0.8268, Adjusted R-squared: 0.8148 ## F-statistic: 69.21 on 2 and 29 DF, p-value: 9.109e-12 7.5 類別變項的迴歸 若只有兩個levels，可直接做迴歸。若有多個levels，可以dummy coding的方式來做。 mtcars$cyl&lt;-factor(mtcars$cyl) contrasts(mtcars$cyl)&lt;-contr.treatment(3, base = 1) #generate contrasts mtcars$cyl ## [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4 ## attr(,&quot;contrasts&quot;) ## 2 3 ## 4 0 0 ## 6 1 0 ## 8 0 1 ## Levels: 4 6 8 model.mpg.cyl &lt;- lm(mpg ~ cyl, data = mtcars) summary(model.mpg.cyl) ## ## Call: ## lm(formula = mpg ~ cyl, data = mtcars) ## ## Residuals: ## Min 1Q Median 3Q Max ## -5.2636 -1.8357 0.0286 1.3893 7.2364 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 26.6636 0.9718 27.437 &lt; 2e-16 *** ## cyl2 -6.9208 1.5583 -4.441 0.000119 *** ## cyl3 -11.5636 1.2986 -8.905 8.57e-10 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 3.223 on 29 degrees of freedom ## Multiple R-squared: 0.7325, Adjusted R-squared: 0.714 ## F-statistic: 39.7 on 2 and 29 DF, p-value: 4.979e-09 "],["moderation.html", "Chapter 8 調節效果分析 8.1 讀入資料並畫圖檢視 8.2 調節變項為類別變項 8.3 調節變項為連續變項", " Chapter 8 調節效果分析 本單元介紹如何以R語言做調節效果分析。 8.1 讀入資料並畫圖檢視 以JASP提供的moderation.csv為例，以R做分析。 此資料測量觀察到的寵物鸚鵡與其主人的親近度（closeness）、主人表現出的情感行為量（affection）與鸚鵡的性別。 設定工作目錄。 讀入資料。 cData &lt;- read.table(&quot;moderation.csv&quot;, header=TRUE, sep=&quot;,&quot;) affection closeness gender_dummy gender 7 2 0 Male 6 1 0 Male 12 0 0 Male 14 1 0 Male 17 3 0 Male 19 2 0 Male 畫情感行為量與親近度的散佈圖，並依據不同的鸚鵡性別上色。 library(ggplot2) qplot(affection, closeness, colour = gender, data = cData) 8.2 調節變項為類別變項 以下檢驗是否鸚鵡的性別可以調節主人表現出的情感對他們和鸚鵡之間的親密度。欲測試的想法為：主人表現出的情感對他們和鸚鵡之間的親密度有正向的效果；但對於雄性或雌性鸚鵡，這種效果可能會有所不同。意即，情感對親近的影響是由鸚鵡的性別調節的。 8.2.1 模型檢驗 將情感中心化後，以pequod套件中的lmres()函數做迴歸分析。此函數可直接以type=nested來看兩階段的迴歸模型，一為沒有交互作用項的，一為有交互作用項的，並檢驗加入交互作用項的模型是否顯著。 library(pequod) m1 &lt;- lmres(closeness~affection*gender, centered=c(&quot;affection&quot;), data=cData) summary(m1, type=&quot;nested&quot;) ## **Models** ## ## Model 1: closeness ~ affection + genderMale ## &lt;environment: 0x000001be5ee38398&gt; ## ## Model 2: closeness ~ affection + genderMale + affection.XX.genderMale ## &lt;environment: 0x000001be5ee38398&gt; ## ## ## **Statistics** ## ## R R^2 Adj. R^2 Diff.R^2 F df1 df2 p.value ## Model 1 0.88 0.77 0.76 0.77 160.04 2.00 97 &lt; 2.2e-16 *** ## Model 2: 0.93 0.86 0.86 0.09 197.52 3.00 96 &lt; 2.2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## ## **F change** ## ## Res.Df RSS Df Sum of Sq F Pr(&gt;F) ## 1 97 177 ## 2 96 106 1 71 64.1 2.7e-12 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## ## **Coefficients** ## ## Estimate StdErr t.value beta p.value ## -- Model 1 -- ## ## (Intercept) 6.29135 0.19168 32.82144 &lt; 2.2e-16 *** ## affection 0.26269 0.02963 8.86462 0.4367 &lt; 2.2e-16 *** ## genderMale -4.46269 0.27189 -16.41354 -0.8085 &lt; 2.2e-16 *** ## ## ## -- Model 2 -- ## ## (Intercept) 6.36873 0.14950 42.60126 &lt; 2.2e-16 *** ## affection 0.41746 0.03009 13.87403 0.6939 &lt; 2.2e-16 *** ## genderMale -4.42985 0.21165 -20.93042 -0.8026 &lt; 2.2e-16 *** ## affection.XX.genderMale -0.37521 0.04685 -8.00877 -0.3996 &lt; 2.2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 由上面結果可知兩模型皆顯著，但加入交互作用的模型比未加入的模型可以多解釋9%的變異量，此增加的解釋量達到顯著，\\(\\Delta\\)R^2 = .09, F(1,96) = 64.1, p &lt; .001。迴歸式為closeness = 6.37 + 0.42 affection - 4.43 genderM - 0.38 affection\\(\\times\\)genderM。 8.2.2 Simple slope分析 交互作用顯著，表示有調節效果。接著可做Simple slope分析，看鸚鵡的性別為雄性/雌性與情感在正/負一個標準差時的親密程度預測值。 Sim_m1 &lt;- simpleSlope(m1, pred=&quot;affection&quot;, mod1=&quot;genderMale&quot;, coded=&quot;genderMale&quot;) summary(Sim_m1) ## ## ** Estimated points of closeness ** ## ## Low affection (-1 SD) High affection (+1 SD) ## Low genderMale ( 0 ) 4.4440 8.2935 ## High genderMale ( 1 ) 1.7441 2.1337 ## ## ## ## ** Simple Slopes analysis ( df= 96 ) ** ## ## simple slope standard error t-value p.value ## Low genderMale ( 0 ) 0.4175 0.0301 13.87 &lt;2e-16 *** ## High genderMale ( 1 ) 0.0422 0.0359 1.18 0.24 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## ## ## ** Bauer &amp; Curran 95% CI ** ## ## lower CI upper CI ## genderMale 0.9366 1.3778 對上述Simple Slope作圖。 PlotSlope(Sim_m1) 8.3 調節變項為連續變項 8.3.1 模型檢驗 資料與上面相同，但將情感作為調節變項、鸚鵡的性別做為預測項。迴歸式相同，故迴歸分析結果同上。 library(pequod) m2 &lt;- lmres(closeness~gender*affection, centered=c(&quot;affection&quot;), data=cData) summary(m2, type=&quot;nested&quot;) ## **Models** ## ## Model 1: closeness ~ genderMale + affection ## &lt;environment: 0x000001be56d65680&gt; ## ## Model 2: closeness ~ genderMale + affection + genderMale.XX.affection ## &lt;environment: 0x000001be56d65680&gt; ## ## ## **Statistics** ## ## R R^2 Adj. R^2 Diff.R^2 F df1 df2 p.value ## Model 1 0.88 0.77 0.76 0.77 160.04 2.00 97 &lt; 2.2e-16 *** ## Model 2: 0.93 0.86 0.86 0.09 197.52 3.00 96 &lt; 2.2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## ## **F change** ## ## Res.Df RSS Df Sum of Sq F Pr(&gt;F) ## 1 97 177 ## 2 96 106 1 71 64.1 2.7e-12 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## ## **Coefficients** ## ## Estimate StdErr t.value beta p.value ## -- Model 1 -- ## ## (Intercept) 6.29135 0.19168 32.82144 &lt; 2.2e-16 *** ## genderMale -4.46269 0.27189 -16.41354 -0.8085 &lt; 2.2e-16 *** ## affection 0.26269 0.02963 8.86462 0.4367 &lt; 2.2e-16 *** ## ## ## -- Model 2 -- ## ## (Intercept) 6.36873 0.14950 42.60126 &lt; 2.2e-16 *** ## genderMale -4.42985 0.21165 -20.93042 -0.8026 &lt; 2.2e-16 *** ## affection 0.41746 0.03009 13.87403 0.6939 &lt; 2.2e-16 *** ## genderMale.XX.affection -0.37521 0.04685 -8.00877 -0.3996 &lt; 2.2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 8.3.2 Simple slope分析 因交互作用顯著，有調節效果，故同樣做simple slope分析。 Sim_m2 &lt;- simpleSlope(m1, pred=&quot;genderMale&quot;, mod1=&quot;affection&quot;, coded=&quot;genderMale&quot;) summary(Sim_m2) ## ## ** Estimated points of closeness ** ## ## Low genderMale ( 0 ) High genderMale ( 1 ) ## Low affection (-1 SD) 4.4440 1.7441 ## High affection (+1 SD) 8.2935 2.1337 ## ## ## ## ** Simple Slopes analysis ( df= 96 ) ** ## ## simple slope standard error t-value p.value ## Low affection (-1 SD) -2.700 0.305 -8.84 &lt;2e-16 *** ## High affection (+1 SD) -6.160 0.300 -20.57 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## ## ## ** Bauer &amp; Curran 95% CI ** ## ## lower CI upper CI ## affection -15.864 -9.2647 Simple slope分析結果圖。 PlotSlope(Sim_m2) 8.3.3 以Johnson-Neyman technique 若要以Johnson-Neyman (JN) technique進一步探究調節效果，需要用R內建的lm()函數來做迴歸。 為了和上面結果相呼應，先產生一個dummy variable: genderD，將男生設為1、女生為0。這邊直接將原dataframe中的gender_dummy以1去減即可。 cData$genderD &lt;- 1 - cData$gender_dummy 若資料中沒有gender_dummy變項，也可以用plyr套件中的revalue()函數將Male轉為1、Female轉為0，再用as.numeric()函數將之轉為數值。 library(plyr) cData$D &lt;- as.numeric(revalue(cData$gender, c(&quot;Male&quot;=1, &#39;Female&#39;=0))) 將情感(affection)中心化，產生一新的變項affectionC。 cData$affectionC &lt;- c(scale(cData$affection, center=TRUE, scale=FALSE)) 以affectionC和genderD來預測closeness。 res0 &lt;- lm(closeness ~ affectionC + genderD, data=cData) summary(res0) ## ## Call: ## lm(formula = closeness ~ affectionC + genderD, data = cData) ## ## Residuals: ## Min 1Q Median 3Q Max ## -3.3733 -0.8598 0.2029 0.8282 3.0625 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 6.29135 0.19168 32.821 &lt; 2e-16 *** ## affectionC 0.26269 0.02963 8.865 3.78e-14 *** ## genderD -4.46269 0.27189 -16.414 &lt; 2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 1.351 on 97 degrees of freedom ## Multiple R-squared: 0.7674, Adjusted R-squared: 0.7626 ## F-statistic: 160 on 2 and 97 DF, p-value: &lt; 2.2e-16 上述迴歸式加入affectionC*genderD來預測closeness。 res1 &lt;- lm(closeness ~ affectionC + genderD + affectionC*genderD, data=cData) summary(res1) ## ## Call: ## lm(formula = closeness ~ affectionC + genderD + affectionC * ## genderD, data = cData) ## ## Residuals: ## Min 1Q Median 3Q Max ## -2.18730 -0.74369 -0.06341 0.68137 2.89720 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 6.36873 0.14950 42.601 &lt; 2e-16 *** ## affectionC 0.41746 0.03009 13.874 &lt; 2e-16 *** ## genderD -4.42985 0.21165 -20.930 &lt; 2e-16 *** ## affectionC:genderD -0.37521 0.04685 -8.009 2.72e-12 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 1.052 on 96 degrees of freedom ## Multiple R-squared: 0.8606, Adjusted R-squared: 0.8562 ## F-statistic: 197.5 on 3 and 96 DF, p-value: &lt; 2.2e-16 以anova()比較兩模型。結果同上，有交互作用項的模型有顯著提高解釋力。 anova(res0, res1) ## Analysis of Variance Table ## ## Model 1: closeness ~ affectionC + genderD ## Model 2: closeness ~ affectionC + genderD + affectionC * genderD ## Res.Df RSS Df Sum of Sq F Pr(&gt;F) ## 1 97 177.14 ## 2 96 106.19 1 70.948 64.14 2.722e-12 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 用processR來做分析。processR目前無法用在最新版的R 4.2.0版，會讓整個R當掉。但R 4.2.0之前的版本沒有問題。 尤其processR在R 4.2.0會有問題，下面的程式碼請自行執行，不再demo。 用modelSummary()來整理迴歸的結果表。 library(processR) modelsSummary(res1) 用modelSummary2()來看不同affection(-1SD、0、+1SD)和gender(0、1)組合的closeness。 modSummary2(res1, rangemode=1) 用modSummary3()來看conditional effect。結果顯示，當affectionC為0時，slope為-4.43；affectionC為+1 SD時，slope為-2.70；affectionC為-1 SD時，slope為-6.16。 modSummary3(res1, X=&#39;genderD&#39;, W=&#39;affectionC&#39;, rangemode=1) 8.3.3.1 以rockchalk套件分析 以rockchalk套件的plotSlopes()來畫上述conditional effect的圖。 library(rockchalk) ps &lt;- plotSlopes(res1, plotx=&quot;genderD&quot;, modx=&quot;affectionC&quot;, modxVals=&quot;std.dev&quot;) Johnson-Neyman (JN) technique: 檢驗各affectC下的conditional effect，其slope是否顯著。 ts &lt;- testSlopes(ps) ## Values of affectionC OUTSIDE this interval: ## lo hi ## -15.931548 -9.238178 ## cause the slope of (b1 + b2*affectionC)genderD to be statistically significant plot(ts) 8.3.3.2 以interacions套件分析 interactions套件也提供很好的視覺化圖表功能，可用來看conditional effect與Johnson-Neyman分析。 畫conditional effect的圖，含資料點。 library(interactions) interact_plot(res1, pred = genderD, modx = affectionC, plot.points = TRUE) 畫conditional effect的圖，含信賴區間。 interact_plot(res1, pred = genderD, modx = affectionC, interval = TRUE) 做Johnson-Neyman分析。 sim_slopes(res1, pred = genderD, modx = affectionC, jnplot = TRUE) ## JOHNSON-NEYMAN INTERVAL ## ## When affectionC is OUTSIDE the interval [-15.93, -9.24], the slope of ## genderD is p &lt; .05. ## ## Note: The range of observed values of affectionC is [-10.12, 13.88] ## SIMPLE SLOPES ANALYSIS ## ## Slope of genderD when affectionC = -4.61066e+00 (- 1 SD): ## ## Est. S.E. t val. p ## ------- ------ -------- ------ ## -2.70 0.31 -8.84 0.00 ## ## Slope of genderD when affectionC = 7.81597e-16 (Mean): ## ## Est. S.E. t val. p ## ------- ------ -------- ------ ## -4.43 0.21 -20.93 0.00 ## ## Slope of genderD when affectionC = 4.61066e+00 (+ 1 SD): ## ## Est. S.E. t val. p ## ------- ------ -------- ------ ## -6.16 0.30 -20.57 0.00 或是用john_neyman()函數來做圖。 johnson_neyman(model = res1, pred = genderD, modx = affectionC) ## JOHNSON-NEYMAN INTERVAL ## ## When affectionC is OUTSIDE the interval [-15.93, -9.24], the slope of ## genderD is p &lt; .05. ## ## Note: The range of observed values of affectionC is [-10.12, 13.88] 8.3.3.3 用process macro來分析 若是習慣使用Andrew Hayes發展的process macro，可先到process的網站下載檔案。解壓縮後直接執行process.R。可用source(‘檔案路徑’)來執行，或全選後按run執行，前者會快一些，因為不會列印出一堆文字。 source(&#39;D:\\\\Dropbox\\\\processR\\\\PROCESS v4.1 for R\\\\process.R&#39;) 同上的model，以process來做分析。model=1是調節模型，jn=1表示要執行Johnson–Neyman Technique分析。center=2表示僅將連續變項中心化，plot=1表示要輸出Data for visualizing the conditional effect of the focal predictor。 process(data=cData,y=&quot;closeness&quot;,x=&quot;genderD&quot;,w=&quot;affection&quot;, model=1, center=2, jn=1, plot=1) "],["mediation.html", "Chapter 9 中介效果分析 9.1 讀入資料並畫圖檢視 9.2 以R內建的lm函數來做分析 9.3 以psych套件來分析 9.4 以mediation套件來做分析", " Chapter 9 中介效果分析 本單元介紹如何以R語言做中介效果分析。 9.1 讀入資料並畫圖檢視 以JASP提供的mediation.csv為例，以R做分析。 此資料為一項假設的研究資料。在研究中以量表詢問了父母對孩子的養育採取自由放任態度的程度(laissez_faire)、孩子的獨立程度(independence)、以及孩子的探索行為量(exploration)。研究假設為：強烈的自由放任態度對孩子的獨立性有正向的效果。其可能的機制為，自由放任的態度會影響孩子的探索行為量，進而影響其獨立性。意即，探索是態度對獨立性影響的中介變項。 以read.table()獨入資料。 mData &lt;- read.table(&quot;mediation.csv&quot;, header=TRUE, sep=&quot;,&quot;) laissez_faire exploration independence disobedience 7 4 8 2 6 2 6 3 12 3 7 4 14 4 7 5 17 6 11 3 19 6 10 5 9.2 以R內建的lm函數來做分析 9.2.1 總效果檢驗 以laissez_faire預測independence，模型解釋力顯著。 fit &lt;- lm(independence~laissez_faire, data=mData) summary(fit) ## ## Call: ## lm(formula = independence ~ laissez_faire, data = mData) ## ## Residuals: ## Min 1Q Median 3Q Max ## -6.6202 -1.5732 -0.0493 1.4424 6.5051 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 5.21426 0.61960 8.415 3.27e-13 *** ## laissez_faire 0.23433 0.05151 4.549 1.54e-05 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.363 on 98 degrees of freedom ## Multiple R-squared: 0.1744, Adjusted R-squared: 0.1659 ## F-statistic: 20.7 on 1 and 98 DF, p-value: 1.544e-05 9.2.2 以預測項來預測中介變項 以laissez_faire預測exploration，效果亦顯著。 fita &lt;- lm(exploration ~ laissez_faire, data=mData) summary(fita) ## ## Call: ## lm(formula = exploration ~ laissez_faire, data = mData) ## ## Residuals: ## Min 1Q Median 3Q Max ## -2.12610 -0.76207 -0.08926 0.60196 2.56513 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 2.18840 0.27134 8.065 1.84e-12 *** ## laissez_faire 0.17281 0.02256 7.661 1.33e-11 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 1.035 on 98 degrees of freedom ## Multiple R-squared: 0.3746, Adjusted R-squared: 0.3682 ## F-statistic: 58.69 on 1 and 98 DF, p-value: 1.333e-11 9.2.3 中介變項與預測項共同預測依變項 fitb &lt;- lm(independence ~ exploration + laissez_faire, data=mData) summary(fitb) ## ## Call: ## lm(formula = independence ~ exploration + laissez_faire, data = mData) ## ## Residuals: ## Min 1Q Median 3Q Max ## -4.1713 -0.7227 -0.0016 0.8303 2.8300 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 0.84015 0.38843 2.163 0.033003 * ## exploration 1.99877 0.11211 17.829 &lt; 2e-16 *** ## laissez_faire -0.11107 0.03165 -3.509 0.000684 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 1.148 on 97 degrees of freedom ## Multiple R-squared: 0.807, Adjusted R-squared: 0.803 ## F-statistic: 202.7 on 2 and 97 DF, p-value: &lt; 2.2e-16 9.2.4 中介效果檢驗 以stargazer套件的stargazer()函數來看三變項之間的關係。 library(stargazer) stargazer(fit, fita, fitb, type = &quot;text&quot;, title = &quot;Baron and Kenny Method&quot;) ## ## Baron and Kenny Method ## ========================================================================================= ## Dependent variable: ## --------------------------------------------------------------------- ## independence exploration independence ## (1) (2) (3) ## ----------------------------------------------------------------------------------------- ## exploration 1.999*** ## (0.112) ## ## laissez_faire 0.234*** 0.173*** -0.111*** ## (0.052) (0.023) (0.032) ## ## Constant 5.214*** 2.188*** 0.840** ## (0.620) (0.271) (0.388) ## ## ----------------------------------------------------------------------------------------- ## Observations 100 100 100 ## R2 0.174 0.375 0.807 ## Adjusted R2 0.166 0.368 0.803 ## Residual Std. Error 2.363 (df = 98) 1.035 (df = 98) 1.148 (df = 97) ## F Statistic 20.696*** (df = 1; 98) 58.688*** (df = 1; 98) 202.746*** (df = 2; 97) ## ========================================================================================= ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 以multilevel套件的sobel()函數來做Sobel test檢驗中介效果，看indirect effect是否顯著。 library(multilevel) sobel(mData$laissez_faire, mData$exploration, mData$independence) ## $`Mod1: Y~X` ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 5.2142586 0.61960212 8.415495 3.267909e-13 ## pred 0.2343293 0.05150847 4.549335 1.543558e-05 ## ## $`Mod2: Y~X+M` ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 0.8401457 0.38842542 2.162952 3.300257e-02 ## pred -0.1110699 0.03165459 -3.508809 6.841546e-04 ## med 1.9987717 0.11210741 17.829078 2.255937e-32 ## ## $`Mod3: M~X` ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 2.1884004 0.2713435 8.065056 1.842647e-12 ## pred 0.1728057 0.0225572 7.660779 1.333137e-11 ## ## $Indirect.Effect ## [1] 0.3453992 ## ## $SE ## [1] 0.04907255 ## ## $z.value ## [1] 7.038542 ## ## $N ## [1] 100 以bda套件的mediation.test()函數來做Sobel mediation test，變項的順序依序為mv、iv、dv。 library(bda) mediation.test(mData$exploration, mData$laissez_faire, mData$independence) ## Sobel Aroian Goodman ## z.value 7.038542e+00 7.029215e+00 7.047906e+00 ## p.value 1.942620e-12 2.076993e-12 1.816300e-12 9.3 以psych套件來分析 用psych套件的mediate()函數來做中介效果的分析。 library(psych) m1 &lt;- mediate(independence ~ laissez_faire + (exploration), data=mData, n.iter = 10000) summary(m1) ## Call: mediate(y = independence ~ laissez_faire + (exploration), data = mData, ## n.iter = 10000) ## ## Direct effect estimates (traditional regression) (c&#39;) X + M on Y ## independence se t df Prob ## Intercept 0.84 0.39 2.16 97 3.30e-02 ## laissez_faire -0.11 0.03 -3.51 97 6.84e-04 ## exploration 2.00 0.11 17.83 97 2.26e-32 ## ## R = 0.9 R2 = 0.81 F = 202.75 on 2 and 97 DF p-value: 2.26e-35 ## ## Total effect estimates (c) (X on Y) ## independence se t df Prob ## Intercept 5.21 0.62 8.42 98 3.27e-13 ## laissez_faire 0.23 0.05 4.55 98 1.54e-05 ## ## &#39;a&#39; effect estimates (X on M) ## exploration se t df Prob ## Intercept 2.19 0.27 8.07 98 1.84e-12 ## laissez_faire 0.17 0.02 7.66 98 1.33e-11 ## ## &#39;b&#39; effect estimates (M on Y controlling for X) ## independence se t df Prob ## exploration 2 0.11 17.83 97 2.26e-32 ## ## &#39;ab&#39; effect estimates (through all mediators) ## independence boot sd lower upper ## laissez_faire 0.35 0.35 0.05 0.26 0.44 畫圖呈現。 mediate.diagram(m1) 9.4 以mediation套件來做分析 以mediation套件來做中介效果的分析。 library(mediation) fitM &lt;- lm(exploration ~ laissez_faire, data=mData) fitY &lt;- lm(independence ~ laissez_faire + exploration, data=mData) summary(fitM) ## ## Call: ## lm(formula = exploration ~ laissez_faire, data = mData) ## ## Residuals: ## Min 1Q Median 3Q Max ## -2.12610 -0.76207 -0.08926 0.60196 2.56513 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 2.18840 0.27134 8.065 1.84e-12 *** ## laissez_faire 0.17281 0.02256 7.661 1.33e-11 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 1.035 on 98 degrees of freedom ## Multiple R-squared: 0.3746, Adjusted R-squared: 0.3682 ## F-statistic: 58.69 on 1 and 98 DF, p-value: 1.333e-11 summary(fitY) ## ## Call: ## lm(formula = independence ~ laissez_faire + exploration, data = mData) ## ## Residuals: ## Min 1Q Median 3Q Max ## -4.1713 -0.7227 -0.0016 0.8303 2.8300 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 0.84015 0.38843 2.163 0.033003 * ## laissez_faire -0.11107 0.03165 -3.509 0.000684 *** ## exploration 1.99877 0.11211 17.829 &lt; 2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 1.148 on 97 degrees of freedom ## Multiple R-squared: 0.807, Adjusted R-squared: 0.803 ## F-statistic: 202.7 on 2 and 97 DF, p-value: &lt; 2.2e-16 中介分析的結果如下表。其中，ACME為Average Causal Mediation Effect (indirect effects)，ADE為Average Direct Effect，Prop. Mediated為ACME/Total Effect的比率。由結果可知，laissez_faire可預測independence (b = 0.233, p &lt; .001)，而exploration在此關係中具有中介效果(b = 0.344, p &lt; .001), laissez_faire有直接效果(b = -0.111, p &lt; .001)。 fitMed &lt;- mediate(fitM, fitY, treat=&quot;laissez_faire&quot;, mediator=&quot;exploration&quot;) summary(fitMed) ## ## Causal Mediation Analysis ## ## Quasi-Bayesian Confidence Intervals ## ## Estimate 95% CI Lower 95% CI Upper p-value ## ACME 0.346 0.256 0.44 &lt;2e-16 *** ## ADE -0.111 -0.172 -0.05 &lt;2e-16 *** ## Total Effect 0.235 0.130 0.33 &lt;2e-16 *** ## Prop. Mediated 1.480 1.163 2.10 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Sample Size Used: 100 ## ## ## Simulations: 1000 效果圖示。 plot(fitMed) 9.4.1 Bootstrapping法 若為小樣本、資料違反常態，可用Bootstrapping法。 fitMedBoot &lt;- mediate(fitM, fitY, boot=TRUE, sims=999, treat=&quot;laissez_faire&quot;, mediator=&quot;exploration&quot;) summary(fitMedBoot) ## ## Causal Mediation Analysis ## ## Nonparametric Bootstrap Confidence Intervals with the Percentile Method ## ## Estimate 95% CI Lower 95% CI Upper p-value ## ACME 0.345 0.262 0.44 &lt;2e-16 *** ## ADE -0.111 -0.172 -0.05 &lt;2e-16 *** ## Total Effect 0.234 0.150 0.33 &lt;2e-16 *** ## Prop. Mediated 1.474 1.202 1.95 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Sample Size Used: 100 ## ## ## Simulations: 999 plot(fitMedBoot) "],["multisheets.html", "Chapter 10 多個EXCEL檔的資料匯整與分析 10.1 學習成效分析 10.2 讀入單一工作表並抽取所需資料 10.3 讀取一個檔案的多個工作表 10.4 以for迴圈讀入檔案中的所有工作表 10.5 讀入多個檔案 10.6 集大成的程式碼", " Chapter 10 多個EXCEL檔的資料匯整與分析 以R整理多個excel檔的資料並加以統計 - 以學生學習成效資料為例。 10.1 學習成效分析 下載學習成效原始資料，並統計2017~2020年所有課程的學習成效。 先將所有檔案放到工作目錄下的一個資料夾(例如TableDemo資料夾)內，並在R中設定好工作目錄。(你也可以將此資料夾設為工作目錄，這邊因為Rmarkdown的關係，所以這樣設定。) setwd(&quot;D:\\\\Dropbox\\\\Working\\\\教師社群&quot;) 10.2 讀入單一工作表並抽取所需資料 先讀入單一工作表，並抽取學習成效的資料。 以readxl套件，讀取UG-2017.xlsx的sheet 1。因為表格中沒有column name，readxl會出現警告訊息，不想看到的話可以加上suppressMessages()。 library(readxl) suppressMessages(qData &lt;- read_xlsx(&quot;TableDemo\\\\UG-2017.xlsx&quot;, 1)) 以which()找出「三、學習成效評估」的位置，為「學習成效評估表」的起始位置；並以整個表格長度做為「學習成效評估表」的終點位置。 index_start &lt;- which(qData$`一、教學意見量化結果`==&quot;三、學習成效評估&quot;) index_end &lt;- length(qData$`一、教學意見量化結果`) 抓出「學習成效評估表」的所有數值。 library(dplyr) myData &lt;- slice(qData,index_start:index_end) # myData &lt;- qData[index_start:index_end,] #相當於這樣寫 myData 一、教學意見量化結果 …2 …3 …4 …5 …6 …7 …8 三、學習成效評估 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA 題目 答題人數 (5分)非常符合 (4分)符合 (3分)尚可 (2分)不符合 (1分)非常不符合 單題指標 1.能獲得本科目（領域）之知識 21 12 9 0 0 0 4.57 NA NA 57.00% 43.00% 0% 0% 0% NA 題目 答題人數 (5分)非常符合 (4分)符合 (3分)尚可 (2分)不符合 (1分)非常不符合 單題指標 2.能獲得本科目（領域）之重要概念 21 12 7 2 0 0 4.48 NA NA 57.00% 33.00% 10.00% 0% 0% NA 題目 答題人數 (5分)非常符合 (4分)符合 (3分)尚可 (2分)不符合 (1分)非常不符合 單題指標 5.能學到專業領域的重要技術 21 12 5 4 0 0 4.38 NA NA 57.00% 24.00% 19.00% 0% 0% NA 題目 答題人數 (5分)非常符合 (4分)符合 (3分)尚可 (2分)不符合 (1分)非常不符合 單題指標 7.能提升實務操作的能力 21 12 5 4 0 0 4.38 NA NA 57.00% 24.00% 19.00% 0% 0% NA 題目 答題人數 (5分)非常符合 (4分)符合 (3分)尚可 (2分)不符合 (1分)非常不符合 單題指標 15.能提升資料蒐集分析與運用能力 21 12 8 1 0 0 4.52 NA NA 57.00% 38.00% 5.00% 0% 0% NA 本課程學習成效平均分數 NA NA NA NA NA NA 4.47 刪除NA的列。 data1 &lt;- na.omit(myData) # way1 ## data1 &lt;- myData[complete.cases(myData), ] #way2 ## data1 &lt;- myData[complete.cases(myData[ , 1:8]),] #way3: 可刪除部份data data1 一、教學意見量化結果 …2 …3 …4 …5 …6 …7 …8 題目 答題人數 (5分)非常符合 (4分)符合 (3分)尚可 (2分)不符合 (1分)非常不符合 單題指標 1.能獲得本科目（領域）之知識 21 12 9 0 0 0 4.57 題目 答題人數 (5分)非常符合 (4分)符合 (3分)尚可 (2分)不符合 (1分)非常不符合 單題指標 2.能獲得本科目（領域）之重要概念 21 12 7 2 0 0 4.48 題目 答題人數 (5分)非常符合 (4分)符合 (3分)尚可 (2分)不符合 (1分)非常不符合 單題指標 5.能學到專業領域的重要技術 21 12 5 4 0 0 4.38 題目 答題人數 (5分)非常符合 (4分)符合 (3分)尚可 (2分)不符合 (1分)非常不符合 單題指標 7.能提升實務操作的能力 21 12 5 4 0 0 4.38 題目 答題人數 (5分)非常符合 (4分)符合 (3分)尚可 (2分)不符合 (1分)非常不符合 單題指標 15.能提升資料蒐集分析與運用能力 21 12 8 1 0 0 4.52 刪掉每個題目表格的title列。 data2 &lt;- subset(data1, `一、教學意見量化結果`!=&quot;題目&quot;, select=c(1,2,8)) data2 一、教學意見量化結果 …2 …8 1.能獲得本科目（領域）之知識 21 4.57 2.能獲得本科目（領域）之重要概念 21 4.48 5.能學到專業領域的重要技術 21 4.38 7.能提升實務操作的能力 21 4.38 15.能提升資料蒐集分析與運用能力 21 4.52 10.2.1 簡化程式 以%&gt;%來簡化程式，讓程式更具可讀性，也不需在中間過程多存出變項。意即，只要將qData放入後，即可產生tb1 (即上述data2)。 tb1 &lt;- slice(qData,index_start:index_end) %&gt;% na.omit() %&gt;% subset(`一、教學意見量化結果`!=&quot;題目&quot;, select=c(1,2,8)) 10.2.2 寫成函數 將上述步驟寫成函數anal_Teach_Q，只要給予filename和nSheet即可傳回tb1。 library(readxl) library(dplyr) anal_Teach_Q &lt;- function(filename, nSheet){ suppressMessages(qData &lt;- read_xlsx(filename, nSheet)) index_start &lt;- which(qData$`一、教學意見量化結果`==&quot;三、學習成效評估&quot;) index_end &lt;- length(qData$`一、教學意見量化結果`) tb1 &lt;- slice(qData,index_start:index_end) %&gt;% na.omit() %&gt;% subset(`一、教學意見量化結果`!=&quot;題目&quot;, select=c(1,2,8)) return(tb1) } 呼叫anal_Teach_Q，分析「UG-2017.xlsx」的sheet1。 thisfilename &lt;- &quot;TableDemo\\\\UG-2017.xlsx&quot; nSheet &lt;- 1 tb1 &lt;- anal_Teach_Q(thisfilename, nSheet) tb1 一、教學意見量化結果 …2 …8 1.能獲得本科目（領域）之知識 21 4.57 2.能獲得本科目（領域）之重要概念 21 4.48 5.能學到專業領域的重要技術 21 4.38 7.能提升實務操作的能力 21 4.38 15.能提升資料蒐集分析與運用能力 21 4.52 10.3 讀取一個檔案的多個工作表 當有很多個工作表需讀入時，你可以這樣寫： thisfilename &lt;- &quot;TableDemo\\\\UG-2017.xlsx&quot; tb1 &lt;- anal_Teach_Q(thisfilename, 1) tb2 &lt;- anal_Teach_Q(thisfilename, 2) tb3 &lt;- anal_Teach_Q(thisfilename, 3) 更有效率的做法是用for迴圈。 tblist &lt;- list() for (i in 1:3) { tb0 &lt;- anal_Teach_Q(thisfilename, i) tblist[[i]] &lt;- tb0 } # tblist 若要將所有表單放在一起，可以這樣寫。 tbs &lt;- data.frame() for (i in 1:3) { tb0 &lt;- anal_Teach_Q(thisfilename, i) tbs &lt;- rbind(tbs, tb0) } tbs 一、教學意見量化結果 …2 …8 1.能獲得本科目（領域）之知識 21 4.57 2.能獲得本科目（領域）之重要概念 21 4.48 5.能學到專業領域的重要技術 21 4.38 7.能提升實務操作的能力 21 4.38 15.能提升資料蒐集分析與運用能力 21 4.52 1.能獲得本科目（領域）之知識 41 4.56 2.能獲得本科目（領域）之重要概念 42 4.64 3.能獲得本科目（領域）之重要原理原則 42 4.5 5.能學到專業領域的重要技術 42 4.57 7.能提升實務操作的能力 42 4.62 8.能提升專業知識的應用能力 42 4.62 15.能提升資料蒐集分析與運用能力 42 4.57 16.能提升探究的能力 42 4.62 1.能獲得本科目（領域）之知識 16 4.56 2.能獲得本科目（領域）之重要概念 16 4.69 3.能獲得本科目（領域）之重要原理原則 16 4.63 4.能增進對該領域持續學習的興趣 14 4.71 7.能提升實務操作的能力 15 4.67 8.能提升專業知識的應用能力 16 4.75 12.能促進個人品德實踐或社會關懷情操 16 4.56 14.能提升問題解決能力 16 4.38 18.能激發主動思考及判斷 16 4.56 19.能激發創新創意思考 16 4.69 26.能增進口語或書面表達能力 16 4.63 27.能增進人際溝通與合作能力 16 4.63 31.能提升對未來就業的信心 16 4.56 統計同項目的平均值和個數。由於tbs的項目不是數字，故須先轉為數字。 tbs[,c(2:3)] &lt;- lapply(tbs[,c(2:3)], as.numeric) tbs1 &lt;- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), mean) tbs2 &lt;- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), length) tbs1 Group.1 x 1.能獲得本科目（領域）之知識 4.563333 12.能促進個人品德實踐或社會關懷情操 4.560000 14.能提升問題解決能力 4.380000 15.能提升資料蒐集分析與運用能力 4.545000 16.能提升探究的能力 4.620000 18.能激發主動思考及判斷 4.560000 19.能激發創新創意思考 4.690000 2.能獲得本科目（領域）之重要概念 4.603333 26.能增進口語或書面表達能力 4.630000 27.能增進人際溝通與合作能力 4.630000 3.能獲得本科目（領域）之重要原理原則 4.565000 31.能提升對未來就業的信心 4.560000 4.能增進對該領域持續學習的興趣 4.710000 5.能學到專業領域的重要技術 4.475000 7.能提升實務操作的能力 4.556667 8.能提升專業知識的應用能力 4.685000 將表格整理成dataframe。 tb &lt;- data.frame(&quot;item&quot; = tbs1$Group.1, &quot;n&quot; = tbs2$x, &quot;mean&quot; = tbs1$x) tb item n mean 1.能獲得本科目（領域）之知識 3 4.563333 12.能促進個人品德實踐或社會關懷情操 1 4.560000 14.能提升問題解決能力 1 4.380000 15.能提升資料蒐集分析與運用能力 2 4.545000 16.能提升探究的能力 1 4.620000 18.能激發主動思考及判斷 1 4.560000 19.能激發創新創意思考 1 4.690000 2.能獲得本科目（領域）之重要概念 3 4.603333 26.能增進口語或書面表達能力 1 4.630000 27.能增進人際溝通與合作能力 1 4.630000 3.能獲得本科目（領域）之重要原理原則 2 4.565000 31.能提升對未來就業的信心 1 4.560000 4.能增進對該領域持續學習的興趣 1 4.710000 5.能學到專業領域的重要技術 2 4.475000 7.能提升實務操作的能力 3 4.556667 8.能提升專業知識的應用能力 2 4.685000 10.4 以for迴圈讀入檔案中的所有工作表 以readxl套件中的excel_sheets來列出所有的工作表名稱，並用length()來自動計數有幾個工作表。 thisfilename &lt;- &quot;TableDemo\\\\UG-2017.xlsx&quot; sheetname &lt;- excel_sheets(path = thisfilename) tbs &lt;- data.frame() for (j in 1:length(sheetname)) { tb0 &lt;- anal_Teach_Q(thisfilename, j) tbs &lt;- rbind(tbs, tb0) } tbs[,c(2:3)] &lt;- lapply(tbs[,c(2:3)], as.numeric) tbs1 &lt;- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), mean) tbs2 &lt;- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), length) tbave &lt;- data.frame(&quot;item&quot; = tbs1$Group.1, &quot;n&quot; = tbs2$x, &quot;mean&quot; = tbs1$x) tbave item n mean 1.能獲得本科目（領域）之知識 12 4.578333 10.能提升人文素養 2 4.370000 11.能提升文學欣賞或審美能力 2 4.215000 12.能促進個人品德實踐或社會關懷情操 4 4.455000 13.能了解專業倫理 7 4.480000 14.能提升問題解決能力 8 4.433750 15.能提升資料蒐集分析與運用能力 7 4.464286 16.能提升探究的能力 4 4.567500 17.能提升邏輯推理的能力 3 4.486667 18.能激發主動思考及判斷 4 4.567500 19.能激發創新創意思考 4 4.437500 2.能獲得本科目（領域）之重要概念 15 4.628667 20.能提升創作能力 1 4.130000 21.能對觀點或現象進行鑑賞與評論 1 4.240000 22.能增進個人外語語文能力 2 4.155000 23.能強化學習外語的動力 1 3.780000 24.能開拓個人或國際觀視野 1 3.870000 25.能提升多元文化的理解 1 3.820000 26.能增進口語或書面表達能力 4 4.435000 27.能增進人際溝通與合作能力 5 4.506000 28.能增進規劃組織或經營能力 4 4.397500 29.能提升跨領域整合能力 2 4.360000 3.能獲得本科目（領域）之重要原理原則 11 4.631818 30.能提升自我管理能力 2 4.475000 31.能提升對未來就業的信心 2 4.270000 4.能增進對該領域持續學習的興趣 8 4.552500 5.能學到專業領域的重要技術 7 4.525714 6.能增進本科目（領域）的實驗知能 4 4.415000 7.能提升實務操作的能力 8 4.553750 8.能提升專業知識的應用能力 10 4.557000 9.能提升數位科技的應用能力 2 4.120000 將上述寫成function。給定一檔案名稱，即可輸出平均表格。 ave_Teach_Q &lt;- function(filename) { sheetname &lt;- excel_sheets(path = filename) tbs = data.frame() for (nSheet in 1:length(sheetname)) { tb0 &lt;- anal_Teach_Q(filename, nSheet) tbs &lt;- rbind(tbs, tb0) } tbs[,c(2:3)] &lt;- lapply(tbs[,c(2:3)], as.numeric) tbs1 &lt;- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), mean) #FUN=mean tbs2 &lt;- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), length) #FUN=length tbave &lt;- data.frame(&quot;item&quot; = tbs1$Group.1, &quot;n&quot; = tbs2$x, &quot;mean&quot; = tbs1$x) return(tbave) } 呼叫ave_Teach_Q函數。 thisfilename &lt;- &quot;TableDemo\\\\UG-2017.xlsx&quot; tbave &lt;- ave_Teach_Q(thisfilename) tbave item n mean 1.能獲得本科目（領域）之知識 12 4.578333 10.能提升人文素養 2 4.370000 11.能提升文學欣賞或審美能力 2 4.215000 12.能促進個人品德實踐或社會關懷情操 4 4.455000 13.能了解專業倫理 7 4.480000 14.能提升問題解決能力 8 4.433750 15.能提升資料蒐集分析與運用能力 7 4.464286 16.能提升探究的能力 4 4.567500 17.能提升邏輯推理的能力 3 4.486667 18.能激發主動思考及判斷 4 4.567500 19.能激發創新創意思考 4 4.437500 2.能獲得本科目（領域）之重要概念 15 4.628667 20.能提升創作能力 1 4.130000 21.能對觀點或現象進行鑑賞與評論 1 4.240000 22.能增進個人外語語文能力 2 4.155000 23.能強化學習外語的動力 1 3.780000 24.能開拓個人或國際觀視野 1 3.870000 25.能提升多元文化的理解 1 3.820000 26.能增進口語或書面表達能力 4 4.435000 27.能增進人際溝通與合作能力 5 4.506000 28.能增進規劃組織或經營能力 4 4.397500 29.能提升跨領域整合能力 2 4.360000 3.能獲得本科目（領域）之重要原理原則 11 4.631818 30.能提升自我管理能力 2 4.475000 31.能提升對未來就業的信心 2 4.270000 4.能增進對該領域持續學習的興趣 8 4.552500 5.能學到專業領域的重要技術 7 4.525714 6.能增進本科目（領域）的實驗知能 4 4.415000 7.能提升實務操作的能力 8 4.553750 8.能提升專業知識的應用能力 10 4.557000 9.能提升數位科技的應用能力 2 4.120000 10.5 讀入多個檔案 同理，可以用for迴圈一次讀入多個檔案。 此時需要知道每個檔案的名稱，可以用list.files()來列出所有檔案名稱。 path &lt;- &quot;D:\\\\Dropbox\\\\Working\\\\教師社群\\\\TableDemo&quot; files &lt;- list.files(path = path, pattern = &quot;*.xlsx&quot;) # files 讀入所有檔案並列表。 tblist = list() for (i in 1:length(files)) { thisfilename &lt;- paste(&quot;TableDemo\\\\&quot;, files[i], sep=&#39;&#39;) tb &lt;- ave_Teach_Q(thisfilename) tblist[[i]] &lt;- tb } # tblist 僅抓取平均數，並將每個表的mean改為該學期。以利後續處理。 path &lt;- &quot;D:\\\\Dropbox\\\\Working\\\\教師社群\\\\TableDemo&quot; files &lt;- list.files(path = path, pattern = &quot;*.xlsx&quot;) tblist = list() for (i in 1:length(files)) { thisfilename &lt;- paste(&quot;TableDemo\\\\&quot;, files[i], sep=&#39;&#39;) tb &lt;- ave_Teach_Q(thisfilename) tb2 &lt;- as.data.frame(tb[,c(1,3)]) names(tb2) &lt;- c(&#39;item&#39;, substr(thisfilename,4,7)) tblist[[i]] &lt;- tb2 } # tblist 將所有抓取的表合成一個大表。 tbAll &lt;- Reduce(function(x, y) merge(x, y, all=TRUE, by=&quot;item&quot;), tblist) ## Warning in merge.data.frame(x, y, all = TRUE, by = &quot;item&quot;): column names ## &#39;leDe.x&#39;, &#39;leDe.y&#39; are duplicated in the result tbAll[,2:ncol(tbAll)] &lt;- round(tbAll[,2:ncol(tbAll)], digits = 2) tbAll item leDe.x leDe.y leDe.x leDe.y 1.能獲得本科目（領域）之知識 4.58 4.72 4.63 4.73 10.能提升人文素養 4.37 NA 3.80 4.58 11.能提升文學欣賞或審美能力 4.22 NA 3.71 4.17 12.能促進個人品德實踐或社會關懷情操 4.46 NA 4.30 4.50 13.能了解專業倫理 4.48 4.60 4.04 4.30 14.能提升問題解決能力 4.43 4.54 4.50 4.70 15.能提升資料蒐集分析與運用能力 4.46 4.61 4.52 4.73 16.能提升探究的能力 4.57 4.54 4.53 4.61 17.能提升邏輯推理的能力 4.49 4.60 4.38 4.66 18.能激發主動思考及判斷 4.57 4.68 4.66 4.74 19.能激發創新創意思考 4.44 4.66 4.48 4.61 2.能獲得本科目（領域）之重要概念 4.63 4.73 4.62 4.74 20.能提升創作能力 4.13 4.61 3.82 4.54 21.能對觀點或現象進行鑑賞與評論 4.24 4.60 4.52 4.70 22.能增進個人外語語文能力 4.15 NA 4.26 4.52 23.能強化學習外語的動力 3.78 NA 3.53 4.38 24.能開拓個人或國際觀視野 3.87 NA 3.60 4.39 25.能提升多元文化的理解 3.82 4.58 4.24 4.69 26.能增進口語或書面表達能力 4.44 4.58 4.57 4.64 27.能增進人際溝通與合作能力 4.51 4.61 4.29 4.54 28.能增進規劃組織或經營能力 4.40 NA 4.34 4.50 29.能提升跨領域整合能力 4.36 NA 4.31 4.30 3.能獲得本科目（領域）之重要原理原則 4.63 4.66 4.54 4.75 30.能提升自我管理能力 4.47 4.56 4.42 4.66 31.能提升對未來就業的信心 4.27 NA 3.64 4.61 4.能增進對該領域持續學習的興趣 4.55 4.58 4.50 4.72 5.能學到專業領域的重要技術 4.53 4.80 4.56 4.72 6.能增進本科目（領域）的實驗知能 4.42 4.65 4.45 4.65 7.能提升實務操作的能力 4.55 4.68 4.43 4.71 8.能提升專業知識的應用能力 4.56 4.68 4.57 4.72 9.能提升數位科技的應用能力 4.12 NA 3.62 4.35 也可以用tidyverse package中的purr和dplyr package的full_join()搭配Reduce()來做。 library(&quot;tidyverse&quot;) tbAll2 &lt;- reduce(tblist, full_join, by = &quot;item&quot;) # tbAll2 更進階的寫法：以lapply取代for迴圈。 setwd(&quot;D:\\\\Dropbox\\\\Working\\\\教師社群\\\\TableDemo&quot;) all.data &lt;- lapply(files[1:length(files)], function(x) ave_Teach_Q(x) %&gt;% subset(select = c(1,3)) %&gt;% rename(, !!substr(x,4,7) := mean)) tbAll2 &lt;- Reduce(function(x, y) merge(x, y, all=TRUE, by=&quot;item&quot;), all.data) %&gt;% mutate_if(is.numeric, round, digits = 2) # tbAll2 將tbAll存成excel檔。 library(writexl) write_xlsx(tbAll, &quot;學習成效總表.xlsx&quot;) 10.6 集大成的程式碼 setwd(&quot;D:\\\\pCloud\\\\Working\\\\教師社群\\\\TableDemo&quot;) library(writexl) library(readxl) library(dplyr) path &lt;- &quot;D:\\\\pCloud\\\\Working\\\\教師社群\\\\TableDemo&quot; files &lt;- list.files(path = path, pattern = &quot;*.xlsx&quot;) anal_Teach_Q &lt;- function(filename, nSheet){ suppressMessages(qData &lt;- read_xlsx(filename, nSheet)) index_start &lt;- which(qData$`一、教學意見量化結果`==&quot;三、學習成效評估&quot;) index_end &lt;- length(qData$`一、教學意見量化結果`) tb1 &lt;- slice(qData,index_start:index_end) %&gt;% na.omit() %&gt;% subset(`一、教學意見量化結果`!=&quot;題目&quot;, select=c(1,2,8)) return(tb1) } ave_Teach_Q &lt;- function(filename) { sheetname &lt;- excel_sheets(path = filename) tbs &lt;- data.frame() for (nSheet in 1:length(sheetname)) { tb0 &lt;- anal_Teach_Q(filename, nSheet) tbs &lt;- rbind(tbs, tb0) } tbs[,c(2:3)] &lt;- lapply(tbs[,c(2:3)], as.numeric) tbs1 &lt;- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), mean) #FUN=mean tbs2 &lt;- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), length) #FUN=length tbave &lt;- data.frame(&quot;item&quot; = tbs1$Group.1, &quot;n&quot; = tbs2$x, &quot;mean&quot; = tbs1$x) return(tbave) } tblist &lt;- list() for (i in 1:length(files)) { thisfilename &lt;- files[i] tb &lt;- ave_Teach_Q(thisfilename) tb2 &lt;- tb[,c(1,3)] names(tb2)[2] &lt;- substr(thisfilename,4,7) tblist[[i]] &lt;- tb2 } tbAll &lt;- Reduce(function(x, y) merge(x, y, all=TRUE, by=&quot;item&quot;), tblist) 如果不用任何%&gt;%或funcion，程式會長這樣。 library(readxl) library(writexl) library(dplyr) setwd(&quot;D:\\\\pCloud\\\\Working\\\\教師社群\\\\TableDemo&quot;) path &lt;- &quot;D:\\\\pCloud\\\\Working\\\\教師社群\\\\TableDemo&quot; files &lt;- list.files(path = path, pattern = &quot;*.xlsx&quot;) datalist &lt;- list() for (i in 1:length(files)) { thisfilename &lt;- files[i] sheetname &lt;- excel_sheets(path = thisfilename) tbs &lt;- data.frame() for (j in 1:length(sheetname)) { suppressMessages(qData &lt;- read_xlsx(thisfilename, j)) index_start &lt;- which(qData$`一、教學意見量化結果`==&quot;三、學習成效評估&quot;) index_end &lt;- length(qData$`一、教學意見量化結果`) myData &lt;- slice(qData,index_start:index_end) myData1 &lt;- na.omit(myData) myData2 &lt;- myData1[which(myData1$`一、教學意見量化結果`!=&quot;題目&quot;),] myData2 &lt;- myData2[,c(1,2,8)] tbs &lt;- rbind(tbs, myData2) } tbs[,c(2:3)] &lt;- lapply(tbs[,c(2:3)], as.numeric) tbs1 &lt;- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), mean) tbs2 &lt;- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), length) tb &lt;- data.frame(&quot;item&quot; = tbs1$Group.1, &quot;n&quot; = tbs2$x, &quot;mean&quot; = tbs1$x) tb2 &lt;- tb[,c(1,3)] names(tb2)[2] &lt;- substr(thisfilename,4,7) datalist[[i]] &lt;- tb2 } tbAll &lt;- Reduce(function(x, y) merge(x, y, all=TRUE, by=&quot;item&quot;), datalist) "],["references.html", "Chapter 11 參考資料", " Chapter 11 參考資料 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
