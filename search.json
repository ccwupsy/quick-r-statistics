[{"path":"index.html","id":"前言","chapter":"前言","heading":"前言","text":"R語言是免費的軟體，是進行統計分析很好的工具。本教學網站是從做中學的快速入門版。","code":""},{"path":"datainput.html","id":"datainput","chapter":"1 資料的讀入與整理","heading":"1 資料的讀入與整理","text":"本單元介紹如何以R語言讀入資料、整理資料、並做初步分析。","code":""},{"path":"datainput.html","id":"讀入資料","chapter":"1 資料的讀入與整理","heading":"1.1 讀入資料","text":"","code":""},{"path":"datainput.html","id":"下載範例資料","chapter":"1 資料的讀入與整理","heading":"1.1.1 下載範例資料","text":"本單元使用的範例資料為一虛擬的課程成績檔。請下載至本地端。","code":""},{"path":"datainput.html","id":"設定工作目錄","chapter":"1 資料的讀入與整理","heading":"1.1.2 設定工作目錄","text":"將R的工作目錄設定至存放檔案的目錄下。語法為setwd(“檔案所在地的絕對路徑”)，記得資料夾要用\\來分隔，例如setwd(“D:\\DIR1\\DIR2\\DIR3”)。設定好之後，可以用getwd()來檢視是否成功。","code":"\nsetwd(\"D:\\\\dropbox\\\\Working\\\\教師社群\")\ngetwd()## [1] \"D:/Dropbox/Working/教師社群\""},{"path":"datainput.html","id":"讀入檔案","chapter":"1 資料的讀入與整理","heading":"1.1.3 讀入檔案","text":"以xlsx套件的read.xlsx()函數來讀入excel檔，此函數有賴java。也可以用readxl套件的read_xlsx()函數來讀入excel檔，此函數不需java。請注意以不同函數讀入資料時，資料的格式會稍有不同，後續在叫出資料時需注意。","code":"\nlibrary(xlsx)\ngData <- read.xlsx(\"成績.xlsx\", 1, encoding = \"UTF-8\", stringsAsFactors=FALSE)\nhead(gData)##        學號 性別 組別 出席 影片團評 影片老師評分 期中考 期末考\n## 1 102368014    M    9  8.5    24.05          8.5     32     28\n## 2 102368018    M   10  9.5    24.26          8.5     66     59\n## 3 102368024    F    9    8    24.05          8.5     69     68\n## 4 102368027    F    9    8    24.05          8.5     68   83.5\n## 5 102368030    F   11    0    18.92            7     39     30\n## 6 100368033    M    4   12       20            8     58     79\nlibrary(readxl)\ngData <- read_xlsx(\"成績.xlsx\")"},{"path":"datainput.html","id":"資料檢視","chapter":"1 資料的讀入與整理","heading":"1.2 資料檢視","text":"資料中，有兩位學生已退選，不納入成績計算，可先刪除不要的資料（即選擇要的資料）。","code":"\ngData <- gData[gData$期末考 != \".\", ]"},{"path":"datainput.html","id":"檢視資料類型","chapter":"1 資料的讀入與整理","heading":"1.2.1 檢視資料類型","text":"可在RStudio右方的Environment中雙擊變項名稱來檢視變項，變項為dataframe的型式。 或使用str(變項名稱)來檢視dataframe下的每個變項類型。","code":"\nstr(gData)## 'data.frame':    57 obs. of  8 variables:\n##  $ 學號        : chr  \"102368014\" \"102368018\" \"102368024\" \"102368027\" ...\n##  $ 性別        : chr  \"M\" \"M\" \"F\" \"F\" ...\n##  $ 組別        : num  9 10 9 9 11 4 4 4 6 6 ...\n##  $ 出席        : chr  \"8.5\" \"9.5\" \"8\" \"8\" ...\n##  $ 影片團評    : chr  \"24.05\" \"24.26\" \"24.05\" \"24.05\" ...\n##  $ 影片老師評分: chr  \"8.5\" \"8.5\" \"8.5\" \"8.5\" ...\n##  $ 期中考      : chr  \"32\" \"66\" \"69\" \"68\" ...\n##  $ 期末考      : chr  \"28\" \"59\" \"68\" \"83.5\" ..."},{"path":"datainput.html","id":"資料類型的轉換","chapter":"1 資料的讀入與整理","heading":"1.2.2 資料類型的轉換","text":"將資料中，出席至期末考的類型從文字轉為數字。以期中考為例，可用as.numeric()來做轉換。若要一次轉換多個變項，可用sapply。","code":"\ngData$期中考 <- as.numeric(gData$期中考)\nstr(gData)## 'data.frame':    57 obs. of  8 variables:\n##  $ 學號        : chr  \"102368014\" \"102368018\" \"102368024\" \"102368027\" ...\n##  $ 性別        : chr  \"M\" \"M\" \"F\" \"F\" ...\n##  $ 組別        : num  9 10 9 9 11 4 4 4 6 6 ...\n##  $ 出席        : chr  \"8.5\" \"9.5\" \"8\" \"8\" ...\n##  $ 影片團評    : chr  \"24.05\" \"24.26\" \"24.05\" \"24.05\" ...\n##  $ 影片老師評分: chr  \"8.5\" \"8.5\" \"8.5\" \"8.5\" ...\n##  $ 期中考      : num  32 66 69 68 39 58 67 55 40 54 ...\n##  $ 期末考      : chr  \"28\" \"59\" \"68\" \"83.5\" ...\ngData[c(4:8)] <- sapply(gData[c(4:8)], as.numeric)\nstr(gData)## 'data.frame':    57 obs. of  8 variables:\n##  $ 學號        : chr  \"102368014\" \"102368018\" \"102368024\" \"102368027\" ...\n##  $ 性別        : chr  \"M\" \"M\" \"F\" \"F\" ...\n##  $ 組別        : num  9 10 9 9 11 4 4 4 6 6 ...\n##  $ 出席        : num  8.5 9.5 8 8 0 12 12 5 12 12 ...\n##  $ 影片團評    : num  24.1 24.3 24.1 24.1 18.9 ...\n##  $ 影片老師評分: num  8.5 8.5 8.5 8.5 7 8 8 8 8 8 ...\n##  $ 期中考      : num  32 66 69 68 39 58 67 55 40 54 ...\n##  $ 期末考      : num  28 59 68 83.5 30 79 78 56.5 49.5 60.5 ..."},{"path":"datainput.html","id":"檢視各組人數","chapter":"1 資料的讀入與整理","heading":"1.2.3 檢視各組人數","text":"可用table()來檢視男女人數和各組人數。檢視各組中的男女人數。","code":"\ntable(gData$性別)\ngTable1 <- as.data.frame(table(gData$性別))\ngTable2 <- as.data.frame(table(gData$組別))\ngTable1## \n##  F  M \n## 30 27 \n##   Var1 Freq\n## 1    F   30\n## 2    M   27\ntable(gData$性別, gData$組別)\nas.data.frame(rbind(table(gData$性別, gData$組別)))##    \n##     1 2 3 4 5 6 7 8 9 10 11 12\n##   F 1 4 5 4 2 2 3 1 2  2  3  1\n##   M 3 2 2 2 3 3 1 4 1  3  1  2\n##   1 2 3 4 5 6 7 8 9 10 11 12\n## F 1 4 5 4 2 2 3 1 2  2  3  1\n## M 3 2 2 2 3 3 1 4 1  3  1  2"},{"path":"datainput.html","id":"分數的轉換和計算","chapter":"1 資料的讀入與整理","heading":"1.3 分數的轉換和計算","text":"因影片的評分分別為滿分30分（團評）和滿分10分（老師評分），須轉換為百分制並加以平均。","code":""},{"path":"datainput.html","id":"換為百分制","chapter":"1 資料的讀入與整理","heading":"1.3.1 換為百分制","text":"將影片團評和老師評分轉換為百分制。","code":"\ngData$影片團評新 <- gData$影片團評 / 30 * 100\ngData$影片老師評分新 <- gData$影片老師評分 / 10 * 100\nhead(gData)##        學號 性別 組別 出席 影片團評 影片老師評分 期中考 期末考 影片團評新\n## 1 102368014    M    9  8.5    24.05          8.5     32   28.0   80.16667\n## 2 102368018    M   10  9.5    24.26          8.5     66   59.0   80.86667\n## 3 102368024    F    9  8.0    24.05          8.5     69   68.0   80.16667\n## 4 102368027    F    9  8.0    24.05          8.5     68   83.5   80.16667\n## 5 102368030    F   11  0.0    18.92          7.0     39   30.0   63.06667\n## 6 100368033    M    4 12.0    20.00          8.0     58   79.0   66.66667\n##   影片老師評分新\n## 1             85\n## 2             85\n## 3             85\n## 4             85\n## 5             70\n## 6             80"},{"path":"datainput.html","id":"將兩變項平均","chapter":"1 資料的讀入與整理","heading":"1.3.2 將兩變項平均","text":"直接相加除以2或用rowMeans()來做都可以。","code":"\ngData$影片 <- (gData$影片團評新 + gData$影片老師評分新)/2\ngData$影片 <- rowMeans(gData[,c(\"影片團評新\", \"影片老師評分新\")], na.rm=TRUE)\nhead(gData)##        學號 性別 組別 出席 影片團評 影片老師評分 期中考 期末考 影片團評新\n## 1 102368014    M    9  8.5    24.05          8.5     32   28.0   80.16667\n## 2 102368018    M   10  9.5    24.26          8.5     66   59.0   80.86667\n## 3 102368024    F    9  8.0    24.05          8.5     69   68.0   80.16667\n## 4 102368027    F    9  8.0    24.05          8.5     68   83.5   80.16667\n## 5 102368030    F   11  0.0    18.92          7.0     39   30.0   63.06667\n## 6 100368033    M    4 12.0    20.00          8.0     58   79.0   66.66667\n##   影片老師評分新     影片\n## 1             85 82.58333\n## 2             85 82.93333\n## 3             85 82.58333\n## 4             85 82.58333\n## 5             70 66.53333\n## 6             80 73.33333"},{"path":"datainput.html","id":"抽取部份資料加以計算","chapter":"1 資料的讀入與整理","heading":"1.3.3 抽取部份資料加以計算","text":"抽取出最後要分析的變項，使資料更簡潔。抽取資料的兩種方法為：(1) 資料框名稱[列,行]；(2)subset(變項名稱, 行的條件, select=c(列的名稱))。假設總成績為期中考+期末考+影片的平均，再加上出席分數，則可以下列方式計算。","code":"\ngData1 <- gData[,-c(5,6,9,10)]\ngData1 <- subset(gData, select = c(\"學號\", \"性別\", \"組別\", \"出席\", \"影片\", \"期中考\", \"期末考\"))\nhead(gData1)##        學號 性別 組別 出席     影片 期中考 期末考\n## 1 102368014    M    9  8.5 82.58333     32   28.0\n## 2 102368018    M   10  9.5 82.93333     66   59.0\n## 3 102368024    F    9  8.0 82.58333     69   68.0\n## 4 102368027    F    9  8.0 82.58333     68   83.5\n## 5 102368030    F   11  0.0 66.53333     39   30.0\n## 6 100368033    M    4 12.0 73.33333     58   79.0\ngData1$總成績 <- (gData1$期中考 + gData1$期末考 + gData1$影片)/3 + gData1$出席\nhead(gData1)##        學號 性別 組別 出席     影片 期中考 期末考   總成績\n## 1 102368014    M    9  8.5 82.58333     32   28.0 56.02778\n## 2 102368018    M   10  9.5 82.93333     66   59.0 78.81111\n## 3 102368024    F    9  8.0 82.58333     69   68.0 81.19444\n## 4 102368027    F    9  8.0 82.58333     68   83.5 86.02778\n## 5 102368030    F   11  0.0 66.53333     39   30.0 45.17778\n## 6 100368033    M    4 12.0 73.33333     58   79.0 82.11111"},{"path":"datainput.html","id":"資料數值的檢視與取代","chapter":"1 資料的讀入與整理","heading":"1.3.4 資料數值的檢視與取代","text":"檢視總成績資料，將大於100和小於60者挑選出來，並以新成績取代。","code":""},{"path":"datainput.html","id":"檢視資料的最大最小值","chapter":"1 資料的讀入與整理","heading":"1.3.4.1 檢視資料的最大最小值","text":"可用max()和min()來檢視總成績的最大最小值。","code":"\nmax(gData1$總成績)\nmin(gData1$總成績)## [1] 102.4889\n## [1] 45.17778"},{"path":"datainput.html","id":"找出符合條件的資料","chapter":"1 資料的讀入與整理","heading":"1.3.4.2 找出符合條件的資料","text":"以which()找出大於100和小於60的資料位置，並叫出來看。","code":"\ngData1[which(gData1$總成績 < 60),]##         學號 性別 組別 出席     影片 期中考 期末考   總成績\n## 1  102368014    M    9  8.5 82.58333     32     28 56.02778\n## 5  102368030    F   11  0.0 66.53333     39     30 45.17778\n## 48 103368042    F    4  8.0 73.33333     45      0 47.44444\n## 51 103368047    M   12  5.0 77.11667     52     35 59.70556\n## 58 103365306    F   11 12.0 66.53333     29     47 59.51111\ngData1[which(gData1$總成績 > 100),]##         學號 性別 組別 出席     影片 期中考 期末考   總成績\n## 43 103368037    M    5   12 82.46667     89    100 102.4889"},{"path":"datainput.html","id":"取代資料","chapter":"1 資料的讀入與整理","heading":"1.3.4.3 取代資料","text":"將總成績大於100者以100取代，總成績不滿60但接近60者以60取代。","code":"\ngData1[which(gData1$總成績 > 100),'總成績'] <- 100\ngData1[which(gData1$總成績 < 60 & gData1$總成績 > 59), '總成績'] <- 60"},{"path":"datainput.html","id":"確認執行結果","chapter":"1 資料的讀入與整理","heading":"1.3.4.4 確認執行結果","text":"用which檢視還有哪些學生總成績小於60或大於100。檢視原來59分的兩位學生的成績。","code":"\ngData1[which(gData1$總成績 < 60),]##         學號 性別 組別 出席     影片 期中考 期末考   總成績\n## 1  102368014    M    9  8.5 82.58333     32     28 56.02778\n## 5  102368030    F   11  0.0 66.53333     39     30 45.17778\n## 48 103368042    F    4  8.0 73.33333     45      0 47.44444\ngData1[which(gData1$總成績 > 100),]## [1] 學號   性別   組別   出席   影片   期中考 期末考 總成績\n## <0 rows> (or 0-length row.names)\ngData1[which(gData1$學號 == \"103368047\" | gData1$學號 == \"103365306\"),]##         學號 性別 組別 出席     影片 期中考 期末考 總成績\n## 51 103368047    M   12    5 77.11667     52     35     60\n## 58 103365306    F   11   12 66.53333     29     47     60"},{"path":"datainput.html","id":"儲存資料","chapter":"1 資料的讀入與整理","heading":"1.4 儲存資料","text":"可將dataframe儲存成RData、txt、dat、csv、excel等不同類型的檔案。","code":""},{"path":"datainput.html","id":"儲存為rdata檔","chapter":"1 資料的讀入與整理","heading":"1.4.1 儲存為RData檔","text":"以save()函數來將gData1存成gData1.RData檔。","code":"\nsave(gData1, file = \"gData1.RData\")"},{"path":"datainput.html","id":"儲存為csv檔","chapter":"1 資料的讀入與整理","heading":"1.4.2 儲存為csv檔","text":"以R內建的write.csv()函數儲存為csv檔。","code":"\nwrite.csv(gData1, \"gData1.csv\")"},{"path":"datainput.html","id":"儲存為excel檔","chapter":"1 資料的讀入與整理","heading":"1.4.3 儲存為excel檔","text":"可用xlsx套件的write.xlsx()函數將資料存為excel檔，或用writexl套件的write_xlsx()函數來儲存。前者有賴java的運作，後者則不需java。","code":"\nlibrary(xlsx)\nwrite.xlsx(gData1, file=\"gData1.xlsx\")\nlibrary(writexl)\nwrite_xlsx(gData1, \"gData1.xlsx\")"},{"path":"descriptivestats.html","id":"descriptivestats","chapter":"2 描述統計與作圖","heading":"2 描述統計與作圖","text":"本單元介紹如何以R語言讀入資料並做初步分析，包含描述統計、作圖。","code":""},{"path":"descriptivestats.html","id":"讀入檔案-1","chapter":"2 描述統計與作圖","heading":"2.1 讀入檔案","text":"以xlsx套件的read.xlsx()函數或readxl套件的read_xlsx()函數來讀入上個單元中所存出的gData1.xlsx檔。","code":"\nlibrary(readxl)\ngData1 <- read_xlsx(\"gData1.xlsx\")\nhead(gData1)## # A tibble: 6 × 8\n##   學號      性別   組別  出席  影片 期中考 期末考 總成績\n##   <chr>     <chr> <dbl> <dbl> <dbl>  <dbl>  <dbl>  <dbl>\n## 1 102368014 M         9   8.5  82.6     32   28     56.0\n## 2 102368018 M        10   9.5  82.9     66   59     78.8\n## 3 102368024 F         9   8    82.6     69   68     81.2\n## 4 102368027 F         9   8    82.6     68   83.5   86.0\n## 5 102368030 F        11   0    66.5     39   30     45.2\n## 6 100368033 M         4  12    73.3     58   79     82.1"},{"path":"descriptivestats.html","id":"描述統計","chapter":"2 描述統計與作圖","heading":"2.2 描述統計","text":"計算單一變項、多個變項的描述統計量。","code":""},{"path":"descriptivestats.html","id":"計算單一變項的平均數變異數和標準差","chapter":"2 描述統計與作圖","heading":"2.2.1 計算單一變項的平均數、變異數和標準差","text":"可用mean()、var()和sd()來檢視總成績的平均數、變異數和標準差。可用pastecs套件中的stat.desc()函數來檢視總成績的描述統計量。","code":"\nmean(gData1$總成績)## [1] 74.33021\nvar(gData1$總成績)## [1] 126.1945\nsd(gData1$總成績)## [1] 11.23363\nlibrary(pastecs)\nstat.desc(gData1$總成績, basic=TRUE, desc=TRUE, norm=TRUE, p=0.95)##       nbr.val      nbr.null        nbr.na           min           max \n##  5.700000e+01  0.000000e+00  0.000000e+00  4.517778e+01  1.000000e+02 \n##         range           sum        median          mean       SE.mean \n##  5.482222e+01  4.236822e+03  7.615556e+01  7.433021e+01  1.487931e+00 \n##  CI.mean.0.95           var       std.dev      coef.var      skewness \n##  2.980684e+00  1.261945e+02  1.123363e+01  1.511314e-01 -1.319156e-01 \n##      skew.2SE      kurtosis      kurt.2SE    normtest.W    normtest.p \n## -2.085114e-01  5.845899e-03  4.690725e-03  9.834611e-01  6.243284e-01"},{"path":"descriptivestats.html","id":"計算多個變項的描述統計量","chapter":"2 描述統計與作圖","heading":"2.2.2 計算多個變項的描述統計量","text":"若要同時計算多項成績的描述統計，需使用第三方套件，例如pastecs套件的stat.desc()函數。也可以用psych套件的describe()函數。參數type設定為2是由於偏態和峰度的計算方式有三種，type=2的值與SPSS相同。也可以用vtable套件的st()函數來做，會有較美觀的表格。\nTable 2.1: Summary Statistics\n","code":"\nstat.desc(gData1, basic=TRUE, desc=TRUE, norm=TRUE, p=0.95)##            學號 性別          組別          出席          影片       期中考\n## nbr.val      NA   NA  57.000000000  5.700000e+01  5.700000e+01   57.0000000\n## nbr.null     NA   NA   0.000000000  1.000000e+00  0.000000e+00    0.0000000\n## nbr.na       NA   NA   0.000000000  0.000000e+00  0.000000e+00    0.0000000\n## min          NA   NA   1.000000000  0.000000e+00  6.653333e+01   29.0000000\n## max          NA   NA  12.000000000  1.200000e+01  8.433333e+01   89.0000000\n## range        NA   NA  11.000000000  1.200000e+01  1.780000e+01   60.0000000\n## sum          NA   NA 341.000000000  5.900000e+02  4.424583e+03 3132.0000000\n## median       NA   NA   6.000000000  1.100000e+01  7.691667e+01   55.0000000\n## mean         NA   NA   5.982456140  1.035088e+01  7.762427e+01   54.9473684\n## SE.mean      NA   NA   0.443196430  3.060493e-01  7.378552e-01    1.7633169\n## CI.mean      NA   NA   0.887829134  6.130904e-01  1.478102e+00    3.5323481\n## var          NA   NA  11.196115288  5.338972e+00  3.103253e+01  177.2293233\n## std.dev      NA   NA   3.346059666  2.310622e+00  5.570685e+00   13.3127504\n## coef.var     NA   NA   0.559312026  2.232295e-01  7.176473e-02    0.2422819\n## skewness     NA   NA   0.234149681 -2.123849e+00 -4.829443e-01    0.2879258\n## skew.2SE     NA   NA   0.370107150 -3.357048e+00 -7.633627e-01    0.4551080\n## kurtosis     NA   NA  -1.217954593  5.573908e+00 -9.842022e-01   -0.2269468\n## kurt.2SE     NA   NA  -0.977281597  4.472480e+00 -7.897197e-01   -0.1821012\n## normtest.W   NA   NA   0.939578114  7.297347e-01  8.923611e-01    0.9706089\n## normtest.p   NA   NA   0.006802493  6.467050e-09  1.042615e-04    0.1791033\n##                   期末考        總成績\n## nbr.val      57.00000000  5.700000e+01\n## nbr.null      1.00000000  0.000000e+00\n## nbr.na        0.00000000  0.000000e+00\n## min           0.00000000  4.517778e+01\n## max         104.00000000  1.000000e+02\n## range       104.00000000  5.482222e+01\n## sum        3389.00000000  4.236822e+03\n## median       57.00000000  7.615556e+01\n## mean         59.45614035  7.433021e+01\n## SE.mean       2.41277279  1.487931e+00\n## CI.mean       4.83336470  2.980684e+00\n## var         331.82393484  1.261945e+02\n## std.dev      18.21603510  1.123363e+01\n## coef.var      0.30637769  1.511314e-01\n## skewness     -0.08459996 -1.319156e-01\n## skew.2SE     -0.13372236 -2.085114e-01\n## kurtosis      1.06201488  5.845899e-03\n## kurt.2SE      0.85215623  4.690725e-03\n## normtest.W    0.97173381  9.834611e-01\n## normtest.p    0.20188192  6.243284e-01\nlibrary(psych)\nsummaryTable <- describe(gData1[,4:8], type=2)\nsummaryTable##        vars  n  mean    sd median trimmed   mad   min    max  range  skew\n## 出席      1 57 10.35  2.31  11.00   10.79  1.48  0.00  12.00  12.00 -2.24\n## 影片      2 57 77.62  5.57  76.92   78.02  8.23 66.53  84.33  17.80 -0.51\n## 期中考    3 57 54.95 13.31  55.00   54.47 14.83 29.00  89.00  60.00  0.30\n## 期末考    4 57 59.46 18.22  57.00   59.27 16.31  0.00 104.00 104.00 -0.09\n## 總成績    5 57 74.33 11.23  76.16   74.31 12.14 45.18 100.00  54.82 -0.14\n##        kurtosis   se\n## 出席       6.55 0.31\n## 影片      -0.88 0.74\n## 期中考    -0.03 1.76\n## 期末考     1.43 2.41\n## 總成績     0.24 1.49\nlibrary(vtable)\n# library(kableExtra) #在RStudio不需要\nst(gData1[,c(4:8)])"},{"path":"descriptivestats.html","id":"分組計算單一變項的描述性統計量","chapter":"2 描述統計與作圖","heading":"2.2.3 分組計算單一變項的描述性統計量","text":"若要分組計算單一變項（如總成績）的描述性統計量，可用aggregate()函數。也可以用第三方套件pastecs的stat.desc()函數來做。","code":"\naggregate(gData1$總成績, by=list(gender=gData1$性別),mean)##   gender        x\n## 1      F 73.43611\n## 2      M 75.32366\naggregate(gData1$總成績, by=list(gender=gData1$性別),sd)##   gender        x\n## 1      F 11.80451\n## 2      M 10.69725\nby(gData1$總成績, gData1$性別, stat.desc, basic = FALSE, norm = TRUE)## gData1$性別: F\n##       median         mean      SE.mean CI.mean.0.95          var      std.dev \n##  74.37222222  73.43611111   2.15519916   4.40787720 139.34650223  11.80451194 \n##     coef.var     skewness     skew.2SE     kurtosis     kurt.2SE   normtest.W \n##   0.16074533  -0.35283642  -0.41326154  -0.10010120  -0.06010311   0.96695587 \n##   normtest.p \n##   0.45958396 \n## ------------------------------------------------------------ \n## gData1$性別: M\n##       median         mean      SE.mean CI.mean.0.95          var      std.dev \n##   77.4555556   75.3236626    2.0586874    4.2316925  114.4312289   10.6972533 \n##     coef.var     skewness     skew.2SE     kurtosis     kurt.2SE   normtest.W \n##    0.1420172    0.2638189    0.2945380   -0.4395158   -0.2519967    0.9706505 \n##   normtest.p \n##    0.6190810"},{"path":"descriptivestats.html","id":"分組計算多個變項的描述性統計量","chapter":"2 描述統計與作圖","heading":"2.2.4 分組計算多個變項的描述性統計量","text":"若要分組計算多個變項的描述性統計量，可用aggregate()函數，或使用psych套件中的describeBy()。要漂亮一點的表格可以用vTable套件。\nTable 2.2: Summary Statistics\n\nTable 2.3: Summary Statistics\n","code":"\naggregate(gData1[,4:8],by=list(gender=gData1$性別),mean)##   gender     出席     影片   期中考   期末考   總成績\n## 1      F 10.28333 76.92611 53.13333 59.35000 73.43611\n## 2      M 10.42593 78.40000 56.96296 59.57407 75.32366\naggregate(gData[,4:8],by=list(gender=gData$性別),summary) #較不建議\ndescribeBy(gData1[,4:5], list(gender=gData1$性別),type=2)## \n##  Descriptive statistics by group \n## gender: F\n##      vars  n  mean   sd median trimmed  mad   min   max range  skew kurtosis\n## 出席    1 30 10.28 2.59  11.00   10.81 1.48  0.00 12.00  12.0 -2.58     8.21\n## 影片    2 30 76.93 6.11  76.74   77.30 8.66 66.53 84.33  17.8 -0.29    -1.24\n##        se\n## 出席 0.47\n## 影片 1.12\n## ------------------------------------------------------------ \n## gender: M\n##      vars  n  mean   sd median trimmed  mad   min   max range  skew kurtosis\n## 出席    1 27 10.43 2.01  11.00   10.72 1.48  5.00 12.00   7.0 -1.39     1.13\n## 影片    2 27 78.40 4.90  77.12   78.78 7.09 66.53 84.33  17.8 -0.77    -0.17\n##        se\n## 出席 0.39\n## 影片 0.94\nlibrary(vtable)\nst(gData1[,c(4:8)])\nst(gData1, group='性別')"},{"path":"descriptivestats.html","id":"資料作圖和相關","chapter":"2 描述統計與作圖","heading":"2.3 資料作圖和相關","text":"初步畫直方圖、箱型圖和散布圖，並計算變項之間的相關。","code":""},{"path":"descriptivestats.html","id":"直方圖","chapter":"2 描述統計與作圖","heading":"2.3.1 直方圖","text":"以hist()來繪製直方圖。","code":"\nhist(gData1$總成績)"},{"path":"descriptivestats.html","id":"箱型圖","chapter":"2 描述統計與作圖","heading":"2.3.2 箱型圖","text":"以boxplot()來繪製箱型圖。分組畫箱型圖。","code":"\nboxplot(gData1$總成績, ylab=\"分\")\nboxplot(gData1$總成績~gData1$性別, xlab=\"性別\", ylab=\"分\")"},{"path":"descriptivestats.html","id":"散佈圖","chapter":"2 描述統計與作圖","heading":"2.3.3 散佈圖","text":"以plot()繪製兩變項或多個變項的散佈圖。","code":"\nplot(gData1$出席, gData1$總成績, xlab=\"出席\", ylab=\"總成績\")\ngData2 <- subset(gData1, select = c(出席, 期中考, 期末考, 總成績))\nplot(gData2)"},{"path":"descriptivestats.html","id":"計算相關與繪圖","chapter":"2 描述統計與作圖","heading":"2.3.4 計算相關與繪圖","text":"","code":""},{"path":"descriptivestats.html","id":"計算相關","chapter":"2 描述統計與作圖","heading":"2.3.4.1 計算相關","text":"以cor()計算兩變項的相關，或以cor.test()得到相關和檢定值。cor()可計算多個變項的相關，若要得到檢定結果，可用Hmisc()的rcorr()函數。","code":"\ncor(gData1$出席, gData1$總成績)## [1] 0.5360227\ncor.test(gData1$出席, gData1$總成績)## \n##  Pearson's product-moment correlation\n## \n## data:  gData1$出席 and gData1$總成績\n## t = 4.7089, df = 55, p-value = 1.73e-05\n## alternative hypothesis: true correlation is not equal to 0\n## 95 percent confidence interval:\n##  0.3201738 0.6989657\n## sample estimates:\n##       cor \n## 0.5360227\ncor(gData2)##             出席    期中考    期末考    總成績\n## 出席   1.0000000 0.2220785 0.3760520 0.5360227\n## 期中考 0.2220785 1.0000000 0.6211838 0.8319727\n## 期末考 0.3760520 0.6211838 1.0000000 0.8983073\n## 總成績 0.5360227 0.8319727 0.8983073 1.0000000\nlibrary(Hmisc)\nrcorr(data.matrix(gData2))##        出席 期中考 期末考 總成績\n## 出席   1.00   0.22   0.38   0.54\n## 期中考 0.22   1.00   0.62   0.83\n## 期末考 0.38   0.62   1.00   0.90\n## 總成績 0.54   0.83   0.90   1.00\n## \n## n= 57 \n## \n## \n## P\n##        出席   期中考 期末考 總成績\n## 出席          0.0969 0.0039 0.0000\n## 期中考 0.0969        0.0000 0.0000\n## 期末考 0.0039 0.0000        0.0000\n## 總成績 0.0000 0.0000 0.0000"},{"path":"descriptivestats.html","id":"多個變項的相關矩陣圖","chapter":"2 描述統計與作圖","heading":"2.3.4.2 多個變項的相關矩陣圖","text":"若要將多個變項的相關視覺化，可使用corrplot套件的corrplot()函數。","code":"\nlibrary(corrplot)\ncorrplot(cor(gData2), method='number',type = \"upper\")\ncorrplot(cor(gData2), method='color', type=\"upper\")"},{"path":"hypotesting.html","id":"hypotesting","chapter":"3 假設檢定","heading":"3 假設檢定","text":"以R語言讀入資料並做假設檢定，包含常態檢定、獨立與相依t檢定。","code":""},{"path":"hypotesting.html","id":"讀入檔案-2","chapter":"3 假設檢定","heading":"3.1 讀入檔案","text":"以xlsx套件的read.xlsx()函數或readxl套件的read_xlsx()函數來讀入上個單元中所存出的gData1.xlsx檔。","code":"\nlibrary(readxl)\ngData1 <- read_xlsx(\"gData1.xlsx\")\nhead(gData1)## # A tibble: 6 × 8\n##   學號      性別   組別  出席  影片 期中考 期末考 總成績\n##   <chr>     <chr> <dbl> <dbl> <dbl>  <dbl>  <dbl>  <dbl>\n## 1 102368014 M         9   8.5  82.6     32   28     56.0\n## 2 102368018 M        10   9.5  82.9     66   59     78.8\n## 3 102368024 F         9   8    82.6     69   68     81.2\n## 4 102368027 F         9   8    82.6     68   83.5   86.0\n## 5 102368030 F        11   0    66.5     39   30     45.2\n## 6 100368033 M         4  12    73.3     58   79     82.1"},{"path":"hypotesting.html","id":"常態檢定","chapter":"3 假設檢定","heading":"3.2 常態檢定","text":"以qqnorm()和qqline()來看常態Q-Q圖。以shapiro.test()做常態檢定。","code":"\nqqnorm(gData1$總成績)\nqqline(gData1$總成績)\nshapiro.test(gData1$總成績)## \n##  Shapiro-Wilk normality test\n## \n## data:  gData1$總成績\n## W = 0.98346, p-value = 0.6243"},{"path":"hypotesting.html","id":"獨立樣本t檢定","chapter":"3 假設檢定","heading":"3.3 獨立樣本t檢定","text":"先將性別轉為factor。以leveneTest()做變異數同質性檢定。以獨立樣本t檢定比較男女在總成績上是否有差異。","code":"\ngData1$性別 <- factor(gData1$性別)\nlibrary(car)\nleveneTest(gData1$總成績 ~ gData1$性別, center=\"mean\")## Levene's Test for Homogeneity of Variance (center = \"mean\")\n##       Df F value Pr(>F)\n## group  1  0.2112 0.6476\n##       55\nt.test(gData1$總成績 ~ gData1$性別, var.equal=TRUE)## \n##  Two Sample t-test\n## \n## data:  gData1$總成績 by gData1$性別\n## t = -0.62999, df = 55, p-value = 0.5313\n## alternative hypothesis: true difference in means between group F and group M is not equal to 0\n## 95 percent confidence interval:\n##  -7.892010  4.116907\n## sample estimates:\n## mean in group F mean in group M \n##        73.43611        75.32366"},{"path":"hypotesting.html","id":"相依樣本t檢定","chapter":"3 假設檢定","heading":"3.4 相依樣本t檢定","text":"以t.test()做相依樣本t檢定，比較期中考和期末考是否有差異。t.test()預設為雙尾檢定，若要做單尾檢定，可加入alternative的參數，可設定為”greater” 或 “less”。","code":"\nt.test(gData1$期中考, gData1$期末考, pair=TRUE)## \n##  Paired t-test\n## \n## data:  gData1$期中考 and gData1$期末考\n## t = -2.3616, df = 56, p-value = 0.0217\n## alternative hypothesis: true mean difference is not equal to 0\n## 95 percent confidence interval:\n##  -8.3334024 -0.6841415\n## sample estimates:\n## mean difference \n##       -4.508772\nt.test(gData1$期中考, gData1$期末考, alternative='less',  pair=TRUE)## \n##  Paired t-test\n## \n## data:  gData1$期中考 and gData1$期末考\n## t = -2.3616, df = 56, p-value = 0.01085\n## alternative hypothesis: true mean difference is less than 0\n## 95 percent confidence interval:\n##       -Inf -1.315556\n## sample estimates:\n## mean difference \n##       -4.508772"},{"path":"within1way.html","id":"within1way","chapter":"4 相依樣本單因子變異數分析","heading":"4 相依樣本單因子變異數分析","text":"以R語言讀入資料並做相依樣本單因子變異數分析。","code":""},{"path":"within1way.html","id":"資料準備","chapter":"4 相依樣本單因子變異數分析","heading":"4.1 資料準備","text":"","code":""},{"path":"within1way.html","id":"讀入檔案-3","chapter":"4 相依樣本單因子變異數分析","heading":"4.1.1 讀入檔案","text":"以xlsx套件的read.xlsx()函數或readxl套件的read_xlsx()函數來讀入上個單元中所存出的gData1.xlsx檔。","code":"\nlibrary(readxl)\ngData1 <- read_xlsx(\"gData1.xlsx\")\nhead(gData1)## # A tibble: 6 × 8\n##   學號      性別   組別  出席  影片 期中考 期末考 總成績\n##   <chr>     <chr> <dbl> <dbl> <dbl>  <dbl>  <dbl>  <dbl>\n## 1 102368014 M         9   8.5  82.6     32   28     56.0\n## 2 102368018 M        10   9.5  82.9     66   59     78.8\n## 3 102368024 F         9   8    82.6     69   68     81.2\n## 4 102368027 F         9   8    82.6     68   83.5   86.0\n## 5 102368030 F        11   0    66.5     39   30     45.2\n## 6 100368033 M         4  12    73.3     58   79     82.1"},{"path":"within1way.html","id":"準備可供變異數分析的資料","chapter":"4 相依樣本單因子變異數分析","heading":"4.1.2 準備可供變異數分析的資料","text":"新增一假設的期初考成績，以做為變異數分析之用。選擇期初考、期中考和期末考進來分析，並加入編號（亦可使用學號，這邊方便起見加入編號來做）。用reshape2套件的melt()函數，將期初、期中、期末考合併為一行。更改column的名稱。以上資料格式即為變異數分析所需的格式。在執行相依樣本單因子變異數分析時，要注意的是，資料必須如此例這般，不同組的資料以「接續」的方式排列。若拿到的資料是一般相依樣本的資料輸入方式（即不同組在不同的columns），需先進行資料的處理，將wide data轉為long data，再做相依樣本單因子變異數分析。","code":"\nlibrary(tibble)\ngData1 <- add_column(gData1, 期初考=gData1$出席*8, .after = 5)\nhead(gData1)## # A tibble: 6 × 9\n##   學號      性別   組別  出席  影片 期初考 期中考 期末考 總成績\n##   <chr>     <chr> <dbl> <dbl> <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n## 1 102368014 M         9   8.5  82.6     68     32   28     56.0\n## 2 102368018 M        10   9.5  82.9     76     66   59     78.8\n## 3 102368024 F         9   8    82.6     64     69   68     81.2\n## 4 102368027 F         9   8    82.6     64     68   83.5   86.0\n## 5 102368030 F        11   0    66.5      0     39   30     45.2\n## 6 100368033 M         4  12    73.3     96     58   79     82.1\ngData3 <- subset(gData1, select = c(期初考, 期中考, 期末考))\ngData3 <- add_column(gData3, id = c(1:nrow(gData3)), .after = 0)\nhead(gData3)## # A tibble: 6 × 4\n##      id 期初考 期中考 期末考\n##   <int>  <dbl>  <dbl>  <dbl>\n## 1     1     68     32   28  \n## 2     2     76     66   59  \n## 3     3     64     69   68  \n## 4     4     64     68   83.5\n## 5     5      0     39   30  \n## 6     6     96     58   79\nlibrary(reshape2)\ngData3m <- melt(gData3, id = c(\"id\"), measured = c(\"期初考\", \"期中考\", \"期末考\"))\nhead(gData3m)##   id variable value\n## 1  1   期初考    68\n## 2  2   期初考    76\n## 3  3   期初考    64\n## 4  4   期初考    64\n## 5  5   期初考     0\n## 6  6   期初考    96\nnames(gData3m) <- c('編號', '考試', '成績')\nhead(gData3m)##   編號   考試 成績\n## 1    1 期初考   68\n## 2    2 期初考   76\n## 3    3 期初考   64\n## 4    4 期初考   64\n## 5    5 期初考    0\n## 6    6 期初考   96"},{"path":"within1way.html","id":"描述統計-1","chapter":"4 相依樣本單因子變異數分析","heading":"4.2 描述統計","text":"檢視三次考試的平均數和標準差。\nTable 4.1: Summary Statistics\n以boxplot來看作圖。以ggpubr套件的ggline函數來作圖，畫平均數和標準差。","code":"\nlibrary(vtable)\nst(gData3m, group='考試')\nboxplot(成績~考試, data=gData3m)\nlibrary(ggpubr)\nggline(gData3m,x=\"考試\",y=\"成績\",add=c(\"mean_sd\"))"},{"path":"within1way.html","id":"變異數分析","chapter":"4 相依樣本單因子變異數分析","heading":"4.3 變異數分析","text":"先將編號的格式改為factor。","code":"\ngData3m$編號 <- factor(gData3m$編號)\nhead(gData3m)##   編號   考試 成績\n## 1    1 期初考   68\n## 2    2 期初考   76\n## 3    3 期初考   64\n## 4    4 期初考   64\n## 5    5 期初考    0\n## 6    6 期初考   96"},{"path":"within1way.html","id":"球型檢定與變異數分析","chapter":"4 相依樣本單因子變異數分析","heading":"4.3.1 球型檢定與變異數分析","text":"用rstatix package中的anova_test()來做變異數分析，將結果儲存為res。並以res來看檢驗的結果。因本資料違反球型檢定，需要看sphericity correction的表。Sphericity Corrections以Greenhouse-Geisser (GG)和Huynh-Feldt (HF) epsilon values來做校正。校正後的值 p[GG] 和 p[HF] 皆小於.001，表示不同考試成績有顯著差異。最後，用get_anova_table()來看校正後的結果。校正的結果顯示，F(1.72, 96.57) = 73.704, p < .001。三次考試的成績顯著不同。","code":"\nlibrary(rstatix)\nres <- anova_test(data = gData3m, dv = 成績, wid = 編號, within = 考試)\nres## ANOVA Table (type III tests)\n## \n## $ANOVA\n##   Effect DFn DFd      F        p p<.05   ges\n## 1   考試   2 112 73.704 3.74e-21     * 0.349\n## \n## $`Mauchly's Test for Sphericity`\n##   Effect    W     p p<.05\n## 1   考試 0.84 0.008     *\n## \n## $`Sphericity Corrections`\n##   Effect   GGe      DF[GG]   p[GG] p[GG]<.05   HFe      DF[HF]   p[HF]\n## 1   考試 0.862 1.72, 96.57 1.4e-18         * 0.887 1.77, 99.36 4.8e-19\n##   p[HF]<.05\n## 1         *\nget_anova_table(res)## ANOVA Table (type III tests)\n## \n##   Effect  DFn   DFd      F       p p<.05   ges\n## 1   考試 1.72 96.57 73.704 1.4e-18     * 0.349"},{"path":"within1way.html","id":"多重比較","chapter":"4 相依樣本單因子變異數分析","heading":"4.3.2 多重比較","text":"可用pairwise_t_test()來做兩兩比較，看差異來自於哪裡。結果顯示期中和期末考沒有差異，其餘兩兩比較都有差異。","code":"\npairwise_t_test(gData3m, 成績 ~ 考試, paired = TRUE, p.adjust.method = \"bonferroni\")## # A tibble: 3 × 10\n##   .y.   group1 group2    n1    n2 statistic    df        p    p.adj p.adj.signif\n## * <chr> <chr>  <chr>  <int> <int>     <dbl> <dbl>    <dbl>    <dbl> <chr>       \n## 1 成績  期初考 期中考    57    57     10.4     56 1.11e-14 3.33e-14 ****        \n## 2 成績  期初考 期末考    57    57      8.60    56 8.06e-12 2.42e-11 ****        \n## 3 成績  期中考 期末考    57    57     -2.36    56 2.2 e- 2 6.5 e- 2 ns"},{"path":"within1way.html","id":"若未違反球型檢定","chapter":"4 相依樣本單因子變異數分析","heading":"4.3.3 若未違反球型檢定","text":"若是球型檢定沒有違反，也可以用aov()來做變異數分析。在aov()中，以y~factor(x)+Error(factor(Subj)/factor(x))來執行變異數分析。以model.tables()來看各組的邊緣平均數(marginal mean)和總平均數(ground mean)。總平均數為65.74，期初、期中和期末考的平均數分別為82.81、54.95與59.46。以summary()來看ANOVA table。可得到F(2,112)=73.7，p<.001，表示三次考試的成績有顯著差異。","code":"\nANOVAData <- aov(成績~factor(考試)+Error(factor(編號)/factor(考試)), data=gData3m)\nmodel.tables(ANOVAData,type=\"means\")## Tables of means\n## Grand mean\n##          \n## 65.73684 \n## \n##  factor(考試) \n## factor(考試)\n## 期初考 期中考 期末考 \n##  82.81  54.95  59.46\nsummary(ANOVAData,type=\"means\")## \n## Error: factor(編號)\n##           Df Sum Sq Mean Sq F value Pr(>F)\n## Residuals 56  28272   504.9               \n## \n## Error: factor(編號):factor(考試)\n##               Df Sum Sq Mean Sq F value Pr(>F)    \n## factor(考試)   2  25493   12747    73.7 <2e-16 ***\n## Residuals    112  19370     173                   \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1"},{"path":"between1way.html","id":"between1way","chapter":"5 獨立樣本單因子變異數分析","heading":"5 獨立樣本單因子變異數分析","text":"以R語言讀入資料並做獨立樣本單因子變異數分析。","code":""},{"path":"between1way.html","id":"資料準備-1","chapter":"5 獨立樣本單因子變異數分析","heading":"5.1 資料準備","text":"","code":""},{"path":"between1way.html","id":"讀入檔案-4","chapter":"5 獨立樣本單因子變異數分析","heading":"5.1.1 讀入檔案","text":"接續前一單元，以gData3m變數來做分析，或以xlsx套件的read.xlsx()函數或readxl套件的read_xlsx()函數來讀入gData3m.xlsx檔。","code":"\nlibrary(readxl)\ngData3m <- read_xlsx(\"gData3m.xlsx\")\nhead(gData3m)## # A tibble: 6 × 3\n##   編號  考試    成績\n##   <chr> <chr>  <dbl>\n## 1 1     期初考    68\n## 2 2     期初考    76\n## 3 3     期初考    64\n## 4 4     期初考    64\n## 5 5     期初考     0\n## 6 6     期初考    96"},{"path":"between1way.html","id":"準備可供變異數分析的資料-1","chapter":"5 獨立樣本單因子變異數分析","heading":"5.1.2 準備可供變異數分析的資料","text":"將考試修改為班別的資料。將期初、期中、期末考改為A班、B班、C班，並將編號改為1~171，共171名受試者（不改也不影響分析，但還是改一下，符合一般情境）。","code":"\ncData <- gData3m\nnames(cData)[2] <- '班別'\nlibrary(plyr)## \n## Attaching package: 'plyr'## The following objects are masked from 'package:rstatix':\n## \n##     desc, mutate## The following object is masked from 'package:ggpubr':\n## \n##     mutate## The following objects are masked from 'package:Hmisc':\n## \n##     is.discrete, summarize\ncData$班別 <- revalue(cData$班別, c(\"期初考\"=\"A\", \"期中考\"=\"B\", \"期末考\"=\"C\"))\ncData$編號 <- c(1:171)\nhead(cData)## # A tibble: 6 × 3\n##    編號 班別   成績\n##   <int> <chr> <dbl>\n## 1     1 A        68\n## 2     2 A        76\n## 3     3 A        64\n## 4     4 A        64\n## 5     5 A         0\n## 6     6 A        96"},{"path":"between1way.html","id":"描述統計-2","chapter":"5 獨立樣本單因子變異數分析","heading":"5.2 描述統計","text":"參考前一單元。","code":""},{"path":"between1way.html","id":"獨立樣本變異數分析","chapter":"5 獨立樣本單因子變異數分析","heading":"5.3 獨立樣本變異數分析","text":"確認班別是factor。若不是的話轉為factor。","code":"\ncData$班別 <- factor(cData$班別)\nstr(cData)## tibble [171 × 3] (S3: tbl_df/tbl/data.frame)\n##  $ 編號: int [1:171] 1 2 3 4 5 6 7 8 9 10 ...\n##  $ 班別: Factor w/ 3 levels \"A\",\"B\",\"C\": 1 1 1 1 1 1 1 1 1 1 ...\n##  $ 成績: num [1:171] 68 76 64 64 0 96 96 40 96 96 ..."},{"path":"between1way.html","id":"變異數同質性檢定","chapter":"5 獨立樣本單因子變異數分析","heading":"5.3.1 變異數同質性檢定","text":"先以leveneTest()函數進行變異數同質性檢定。由結果可知資料並未違反變異數同質假設（F(2,168)=1.46, p=0.23）。","code":"\nlibrary(car)\nleveneTest(成績~班別, data=cData, center=mean)## Levene's Test for Homogeneity of Variance (center = mean)\n##        Df F value Pr(>F)\n## group   2  1.4619 0.2347\n##       168"},{"path":"between1way.html","id":"變異數分析-1","chapter":"5 獨立樣本單因子變異數分析","heading":"5.3.2 變異數分析","text":"因變異數同質，可用anova()來做變異數分析。結果顯示三個班級的考試成績有差異，F(2,168)=44.95, p<.001。也可以用aov()來做。結果同上。","code":"\nanova(lm(成績 ~ 班別, data = cData))## Analysis of Variance Table\n## \n## Response: 成績\n##            Df Sum Sq Mean Sq F value    Pr(>F)    \n## 班別        2  25493 12746.6  44.949 2.314e-16 ***\n## Residuals 168  47642   283.6                      \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nanova1 <- aov(成績~factor(班別),data=cData)\nmodel.tables(anova1, type=\"means\")## Tables of means\n## Grand mean\n##          \n## 65.73684 \n## \n##  factor(班別) \n## factor(班別)\n##     A     B     C \n## 82.81 54.95 59.46\nsummary(anova1)##               Df Sum Sq Mean Sq F value   Pr(>F)    \n## factor(班別)   2  25493   12747   44.95 2.31e-16 ***\n## Residuals    168  47642     284                     \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1"},{"path":"between1way.html","id":"事後比較","chapter":"5 獨立樣本單因子變異數分析","heading":"5.3.3 事後比較","text":"可用TukeyHSD()來做事後比較。結果顯示A班和B班、A班和C班的成績有差異，B班和C班則無。或做pairwise t test。結果同上。","code":"\nTukeyHSD(anova1)##   Tukey multiple comparisons of means\n##     95% family-wise confidence level\n## \n## Fit: aov(formula = 成績 ~ factor(班別), data = cData)\n## \n## $`factor(班別)`\n##           diff        lwr       upr     p adj\n## B-A -27.859649 -35.318779 -20.40052 0.0000000\n## C-A -23.350877 -30.810007 -15.89175 0.0000000\n## C-B   4.508772  -2.950358  11.96790 0.3281624\nlibrary(rstatix)\npairwise_t_test(cData, 成績~班別, paired = FALSE, p.adjust.method = \"bonferroni\")## # A tibble: 3 × 9\n##   .y.   group1 group2    n1    n2        p p.signif    p.adj p.adj.signif\n## * <chr> <chr>  <chr>  <int> <int>    <dbl> <chr>       <dbl> <chr>       \n## 1 成績  A      B         57    57 1.32e-15 ****     3.95e-15 ****        \n## 2 成績  A      C         57    57 6.12e-12 ****     1.84e-11 ****        \n## 3 成績  B      C         57    57 1.55e- 1 ns       4.64e- 1 ns"},{"path":"between1way.html","id":"變異數不同質時","chapter":"5 獨立樣本單因子變異數分析","heading":"5.3.4 變異數不同質時","text":"若變異數不同質，可用oneway.test()函數，將var.equal設為FALSE來做ANOVA。可用games_howell_test來做事後比較。games_howell_test()假設變異數不同質。","code":"\noneway.test(成績~班別, data=cData, var.equal=FALSE)## \n##  One-way analysis of means (not assuming equal variances)\n## \n## data:  成績 and 班別\n## F = 43.952, num df = 2.00, denom df = 109.09, p-value = 1e-14\nlibrary(rstatix)\ngames_howell_test(cData, 成績 ~ 班別, conf.level = 0.95, detailed = FALSE)## # A tibble: 3 × 8\n##   .y.   group1 group2 estimate conf.low conf.high    p.adj p.adj.signif\n## * <chr> <chr>  <chr>     <dbl>    <dbl>     <dbl>    <dbl> <chr>       \n## 1 成績  A      B        -27.9    -35.0      -20.7 4.72e-14 ****        \n## 2 成績  A      C        -23.4    -31.5      -15.2 1.66e- 9 ****        \n## 3 成績  B      C          4.51    -2.60      11.6 2.91e- 1 ns"},{"path":"mixed2way.html","id":"mixed2way","chapter":"6 混合樣本二因子變異數分析","heading":"6 混合樣本二因子變異數分析","text":"以R語言讀入資料並做混合樣本二因子變異數分析。","code":""},{"path":"mixed2way.html","id":"資料準備-2","chapter":"6 混合樣本二因子變異數分析","heading":"6.1 資料準備","text":"","code":""},{"path":"mixed2way.html","id":"讀入檔案-5","chapter":"6 混合樣本二因子變異數分析","heading":"6.1.1 讀入檔案","text":"以xlsx套件的read.xlsx()函數或readxl套件的read_xlsx()函數來讀入上個單元中所存出的gData1.xlsx檔。","code":"\nlibrary(readxl)\ngData1 <- read_xlsx(\"gData1.xlsx\")\ngData1 <- as.data.frame(gData1)\nhead(gData1)##        學號 性別 組別 出席     影片 期中考 期末考   總成績\n## 1 102368014    M    9  8.5 82.58333     32   28.0 56.02778\n## 2 102368018    M   10  9.5 82.93333     66   59.0 78.81111\n## 3 102368024    F    9  8.0 82.58333     69   68.0 81.19444\n## 4 102368027    F    9  8.0 82.58333     68   83.5 86.02778\n## 5 102368030    F   11  0.0 66.53333     39   30.0 45.17778\n## 6 100368033    M    4 12.0 73.33333     58   79.0 82.11111"},{"path":"mixed2way.html","id":"準備可供變異數分析的資料-2","chapter":"6 混合樣本二因子變異數分析","heading":"6.1.2 準備可供變異數分析的資料","text":"新增一假設的期初考成績，以做為變異數分析之用。加入編號（亦可使用學號，這邊方便起見加入編號來做），並選擇性別、期初考、期中考和期末考進來分析。移除gData2WA的三位女生的資料，使資料為等格。並將資料中男生的期初和期中考分數略加修改，改為有交互作用的資料。將三次考試的資料合併為一行，並重新命名資料的欄位名稱。以上資料格式即為變異數分析所需的格式。在執行混合因子變異數分析時，要注意的是，資料必須如此例這般，不同受試者內組別的資料以「接續」的方式排列。若拿到的資料是一般的資料輸入方式（即不同受試者內的組別在不同的columns），需先進行資料的處理，將wide data轉為long data，再做混合因子變異數分析。","code":"\nlibrary(tibble)\ngData1 <- add_column(gData1, 期初考=gData1$出席*8, .after = 5)\nhead(gData1)##        學號 性別 組別 出席     影片 期初考 期中考 期末考   總成績\n## 1 102368014    M    9  8.5 82.58333     68     32   28.0 56.02778\n## 2 102368018    M   10  9.5 82.93333     76     66   59.0 78.81111\n## 3 102368024    F    9  8.0 82.58333     64     69   68.0 81.19444\n## 4 102368027    F    9  8.0 82.58333     64     68   83.5 86.02778\n## 5 102368030    F   11  0.0 66.53333      0     39   30.0 45.17778\n## 6 100368033    M    4 12.0 73.33333     96     58   79.0 82.11111\ngData2 <- add_column(gData1, 編號 = c(1:nrow(gData1)), .after = 0)\ngData2WA <- subset(gData2, select = c(\"編號\", \"性別\", \"期初考\", \"期中考\", \"期末考\"))\nhead(gData2WA)##   編號 性別 期初考 期中考 期末考\n## 1    1    M     68     32   28.0\n## 2    2    M     76     66   59.0\n## 3    3    F     64     69   68.0\n## 4    4    F     64     68   83.5\n## 5    5    F      0     39   30.0\n## 6    6    M     96     58   79.0\ngData2WAmi <- gData2WA[-c(5, 47, 56), ]\ngData2WAmi[which(gData2WAmi$性別=='M'), c('期初考')] <- gData2WAmi[which(gData2WAmi$性別=='M'), c('期初考')]-22\ngData2WAmi[which(gData2WAmi$性別=='M'), c('期中考')] <- gData2WAmi[which(gData2WAmi$性別=='M'), c('期中考')]-18\nhead(gData2WAmi)##   編號 性別 期初考 期中考 期末考\n## 1    1    M     46     14   28.0\n## 2    2    M     54     48   59.0\n## 3    3    F     64     69   68.0\n## 4    4    F     64     68   83.5\n## 6    6    M     74     40   79.0\n## 7    7    F     96     67   78.0\nlibrary(reshape)## \n## Attaching package: 'reshape'## The following objects are masked from 'package:plyr':\n## \n##     rename, round_any## The following objects are masked from 'package:reshape2':\n## \n##     colsplit, melt, recast\ngData2WAmim <- melt(gData2WAmi, id = c(\"編號\", \"性別\"), measured = c(\"期初考\", \"期中考\", \"期末考\"))\nnames(gData2WAmim)[3:4] <- c('考試類型', '成績')\nhead(gData2WAmim)##   編號 性別 考試類型 成績\n## 1    1    M   期初考   46\n## 2    2    M   期初考   54\n## 3    3    F   期初考   64\n## 4    4    F   期初考   64\n## 5    6    M   期初考   74\n## 6    7    F   期初考   96"},{"path":"mixed2way.html","id":"描述統計-3","chapter":"6 混合樣本二因子變異數分析","heading":"6.2 描述統計","text":"檢視不同性別在三次考試的平均數和標準差。也可以用psych套件的describeBy()函數。以ggpubr套件的ggline函數來作圖，畫平均數和標準差。","code":"\nlibrary(rstatix)\nget_summary_stats(group_by(gData2WAmim, 性別, 考試類型), 成績, type = \"mean_sd\")## # A tibble: 6 × 6\n##   性別  考試類型 variable     n  mean    sd\n##   <chr> <fct>    <chr>    <dbl> <dbl> <dbl>\n## 1 F     期初考   成績        27  85.5  13.6\n## 2 F     期中考   成績        27  54.9  12.2\n## 3 F     期末考   成績        27  63.1  15.0\n## 4 M     期初考   成績        27  61.4  16.1\n## 5 M     期中考   成績        27  39.0  13.8\n## 6 M     期末考   成績        27  59.6  17.3\nlibrary(psych)\nwith(gData2WAmim, describeBy(成績,list(性別, 考試類型)))## \n##  Descriptive statistics by group \n## : F\n## : 期初考\n##    vars  n  mean    sd median trimmed   mad min max range  skew kurtosis   se\n## X1    1 27 85.48 13.64     88   87.48 11.86  40  96    56 -1.54     2.27 2.62\n## ------------------------------------------------------------ \n## : M\n## : 期初考\n##    vars  n  mean    sd median trimmed   mad min max range  skew kurtosis   se\n## X1    1 27 61.41 16.07     66   63.74 11.86  18  74    56 -1.24     0.45 3.09\n## ------------------------------------------------------------ \n## : F\n## : 期中考\n##    vars  n  mean    sd median trimmed   mad min max range skew kurtosis   se\n## X1    1 27 54.85 12.15     55   54.61 14.83  35  85    50 0.23    -0.48 2.34\n## ------------------------------------------------------------ \n## : M\n## : 期中考\n##    vars  n  mean   sd median trimmed mad min max range skew kurtosis   se\n## X1    1 27 38.96 13.8     40   38.26 8.9  14  71    57  0.3    -0.27 2.66\n## ------------------------------------------------------------ \n## : F\n## : 期末考\n##    vars  n  mean    sd median trimmed   mad min max range skew kurtosis  se\n## X1    1 27 63.09 15.04   58.5   61.91 14.08  43 104    61 0.81    -0.01 2.9\n## ------------------------------------------------------------ \n## : M\n## : 期末考\n##    vars  n  mean   sd median trimmed   mad min max range skew kurtosis   se\n## X1    1 27 59.57 17.3     59   58.76 14.83  28 100    72 0.47    -0.32 3.33\nlibrary(ggpubr)\nggline(gData2WAmim,x=\"考試類型\",y=\"成績\",color=\"性別\", add=c(\"mean_sd\"), size=1)"},{"path":"mixed2way.html","id":"變異數分析-2","chapter":"6 混合樣本二因子變異數分析","heading":"6.3 變異數分析","text":"先將編號和性別的格式改為factor。用levene_test()做變異數同質性檢定。預設值是center=median，如有需要可改為center=mean。分析結果可知，無論是何種考試類型，成績在不同性別上都不違反變異數同質性假設。用rstatix package中的anova_test()來做球型檢定和變異數分析，將結果儲存為res.aov。並以res.aov來看檢驗的結果。因本資料違反球型假設，需要看sphericity correction的表。Sphericity Corrections以Greenhouse-Geisser (GG)和Huynh-Feldt (HF) epsilon values來做校正。校正後的值 p[GG] 和 p[HF] 皆小於.001，表示不同考試類型的成績有顯著差異，且存在性別與考試類型的交互作用。最後，用get_anova_table()來看校正後的結果。校正的結果顯示，性別主效果顯著，F(1, 52) = 22.6, p < .001；考試類型主效果顯著，F(1.69, 87.94) = 68.7, p < .001；兩變項的交互作用顯著，F(1.69, 87.94) = 10.4, p < .001。","code":"\ngData2WAmim$編號 <- factor(gData2WAmim$編號)\ngData2WAmim$性別 <- factor(gData2WAmim$性別)\nstr(gData2WAmim)## 'data.frame':    162 obs. of  4 variables:\n##  $ 編號    : Factor w/ 54 levels \"1\",\"2\",\"3\",\"4\",..: 1 2 3 4 5 6 7 8 9 10 ...\n##  $ 性別    : Factor w/ 2 levels \"F\",\"M\": 2 2 1 1 2 1 1 1 2 2 ...\n##  $ 考試類型: Factor w/ 3 levels \"期初考\",\"期中考\",..: 1 1 1 1 1 1 1 1 1 1 ...\n##  $ 成績    : num  46 54 64 64 74 96 40 96 74 66 ...\nlevene_test(group_by(gData2WAmim, 考試類型), 成績 ~ 性別)## # A tibble: 3 × 5\n##   考試類型   df1   df2 statistic     p\n##   <fct>    <int> <int>     <dbl> <dbl>\n## 1 期初考       1    52     0.239 0.627\n## 2 期中考       1    52     0.156 0.695\n## 3 期末考       1    52     0.273 0.604\nlibrary(rstatix)\nres.aov <- anova_test(data = gData2WAmim, dv = 成績, wid = 編號, between = 性別, within = 考試類型)\nres.aov## ANOVA Table (type II tests)\n## \n## $ANOVA\n##          Effect DFn DFd      F        p p<.05   ges\n## 1          性別   1  52 22.604 1.62e-05     * 0.200\n## 2      考試類型   2 104 68.691 9.66e-20     * 0.359\n## 3 性別:考試類型   2 104 10.420 7.51e-05     * 0.078\n## \n## $`Mauchly's Test for Sphericity`\n##          Effect     W     p p<.05\n## 1      考試類型 0.817 0.006     *\n## 2 性別:考試類型 0.817 0.006     *\n## \n## $`Sphericity Corrections`\n##          Effect   GGe      DF[GG]    p[GG] p[GG]<.05   HFe      DF[HF]    p[HF]\n## 1      考試類型 0.846 1.69, 87.94 4.53e-17         * 0.871 1.74, 90.57 1.65e-17\n## 2 性別:考試類型 0.846 1.69, 87.94 2.11e-04         * 0.871 1.74, 90.57 1.78e-04\n##   p[HF]<.05\n## 1         *\n## 2         *\nget_anova_table(res.aov)## ANOVA Table (type II tests)\n## \n##          Effect  DFn   DFd      F        p p<.05   ges\n## 1          性別 1.00 52.00 22.604 1.62e-05     * 0.200\n## 2      考試類型 1.69 87.94 68.691 4.53e-17     * 0.359\n## 3 性別:考試類型 1.69 87.94 10.420 2.11e-04     * 0.078"},{"path":"mixed2way.html","id":"事後比較-1","chapter":"6 混合樣本二因子變異數分析","heading":"6.3.1 事後比較","text":"交互作用顯著時的單純主要效果檢驗\n因交互作用顯著，故需分析單純主要效果。先依考試類型來分組，看性別的主要效果。可知男女在期初考和期考成績有差異，在期末考則無。adjust_pvalue()會考慮alpha值膨脹的問題，在控制三個檢定的alpha值不超過.05來計算p value。依性別來分組，看考試類型的主要效果。可知考試類型在男女上皆有差異。進一步以兩兩比較去看兩個主效果的差異在哪裡。結果顯示，女生無論是期初vs.期中、期初vs.期末、期vs.期末都有差異；男生則只有期初vs.期中、期中vs.期末有差異。","code":"\nanova1 <- anova_test(group_by(gData2WAmim, 考試類型), dv=成績, wid=編號, between=性別)\nadjust_pvalue(get_anova_table(anova1), method=\"bonferroni\")## # A tibble: 3 × 9\n##   考試類型 Effect   DFn   DFd      F           p `p<.05`   ges       p.adj\n##   <fct>    <chr>  <dbl> <dbl>  <dbl>       <dbl> <chr>   <dbl>       <dbl>\n## 1 期初考   性別       1    52 35.2   0.000000243 \"*\"     0.404 0.000000729\n## 2 期中考   性別       1    52 20.2   0.0000398   \"*\"     0.279 0.000119   \n## 3 期末考   性別       1    52  0.636 0.429       \"\"      0.012 1\nanova2 <- anova_test(group_by(gData2WAmim, 性別), dv=成績, wid=編號, within=考試類型)\nadjust_pvalue(get_anova_table(anova2), method = \"bonferroni\")## # A tibble: 2 × 9\n##   性別  Effect     DFn   DFd     F        p `p<.05`   ges    p.adj\n##   <fct> <chr>    <dbl> <dbl> <dbl>    <dbl> <chr>   <dbl>    <dbl>\n## 1 F     考試類型     2    52  43.6 7.63e-12 *       0.482 1.53e-11\n## 2 M     考試類型     2    52  34.4 3.03e-10 *       0.301 6.06e-10\npairwise_t_test(group_by(gData2WAmim,性別), 成績 ~ 考試類型, paired = TRUE, p.adjust.method = \"bonferroni\")## # A tibble: 6 × 11\n##   性別  .y.   group1 group2    n1    n2 statistic    df             p      p.adj\n## * <fct> <chr> <chr>  <chr>  <int> <int>     <dbl> <dbl>         <dbl>      <dbl>\n## 1 F     成績  期初考 期中考    27    27     8.73     26 0.00000000334    1   e-8\n## 2 F     成績  期初考 期末考    27    27     5.72     26 0.00000506       1.52e-5\n## 3 F     成績  期中考 期末考    27    27    -3.13     26 0.004            1.3 e-2\n## 4 M     成績  期初考 期中考    27    27     6.67     26 0.000000447      1.34e-6\n## 5 M     成績  期初考 期末考    27    27     0.557    26 0.582            1   e+0\n## 6 M     成績  期中考 期末考    27    27    -9.27     26 0.000000001      3   e-9\n## # … with 1 more variable: p.adj.signif <chr>"},{"path":"mixed2way.html","id":"交互作用未顯著時的事後比較","chapter":"6 混合樣本二因子變異數分析","heading":"6.3.2 交互作用未顯著時的事後比較","text":"若交互作用未顯著，看主效果的事後比較。因性別只有兩個levels，不需進行事後比較。因此看考試類型的兩兩比較，結果顯示，三種考試的成績兩兩之間都有差異。","code":"\npairwise_t_test(gData2WAmim, 成績~考試類型, paired = TRUE, p.adjust.method = \"bonferroni\")## # A tibble: 3 × 10\n##   .y.   group1 group2    n1    n2 statistic    df        p    p.adj p.adj.signif\n## * <chr> <chr>  <chr>  <int> <int>     <dbl> <dbl>    <dbl>    <dbl> <chr>       \n## 1 成績  期初考 期中考    54    54     10.7     53 6.73e-15 2.02e-14 ****        \n## 2 成績  期初考 期末考    54    54      4.18    53 1.1 e- 4 3.3 e- 4 ***         \n## 3 成績  期中考 期末考    54    54     -7.56    53 5.6 e-10 1.68e- 9 ****"},{"path":"multireg.html","id":"multireg","chapter":"7 多元迴歸","heading":"7 多元迴歸","text":"以R語言內建的mtcars做多元迴歸。","code":""},{"path":"multireg.html","id":"資料的準備與檢視","chapter":"7 多元迴歸","heading":"7.1 資料的準備與檢視","text":"","code":""},{"path":"multireg.html","id":"讀入檔案-6","chapter":"7 多元迴歸","heading":"7.1.1 讀入檔案","text":"讀入mtcars檔案。mtcars是R內建的dataset，為1974年美國的Motor Trend雜誌對32種車款在11項設計與表現所做的整理，包含油耗量（mpg）、氣缸數（cyl）、排氣量（disp）、馬力（hp）、車體重量（wt）、加速時間（qsec）等。","code":"\ndata(mtcars)\nhead(mtcars, 10)##                    mpg cyl  disp  hp drat    wt  qsec vs am gear carb\n## Mazda RX4         21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4\n## Mazda RX4 Wag     21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4\n## Datsun 710        22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1\n## Hornet 4 Drive    21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1\n## Hornet Sportabout 18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2\n## Valiant           18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1\n## Duster 360        14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4\n## Merc 240D         24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2\n## Merc 230          22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2\n## Merc 280          19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4"},{"path":"multireg.html","id":"檢視相關","chapter":"7 多元迴歸","heading":"7.1.2 檢視相關","text":"先用plot()看各變項的關鍵性。計算各變項的相關。","code":"\nplot(mtcars[1:7])\nlibrary(Hmisc)\nrcorr(data.matrix(mtcars[1:7]))##        mpg   cyl  disp    hp  drat    wt  qsec\n## mpg   1.00 -0.85 -0.85 -0.78  0.68 -0.87  0.42\n## cyl  -0.85  1.00  0.90  0.83 -0.70  0.78 -0.59\n## disp -0.85  0.90  1.00  0.79 -0.71  0.89 -0.43\n## hp   -0.78  0.83  0.79  1.00 -0.45  0.66 -0.71\n## drat  0.68 -0.70 -0.71 -0.45  1.00 -0.71  0.09\n## wt   -0.87  0.78  0.89  0.66 -0.71  1.00 -0.17\n## qsec  0.42 -0.59 -0.43 -0.71  0.09 -0.17  1.00\n## \n## n= 32 \n## \n## \n## P\n##      mpg    cyl    disp   hp     drat   wt     qsec  \n## mpg         0.0000 0.0000 0.0000 0.0000 0.0000 0.0171\n## cyl  0.0000        0.0000 0.0000 0.0000 0.0000 0.0004\n## disp 0.0000 0.0000        0.0000 0.0000 0.0000 0.0131\n## hp   0.0000 0.0000 0.0000        0.0100 0.0000 0.0000\n## drat 0.0000 0.0000 0.0000 0.0100        0.0000 0.6196\n## wt   0.0000 0.0000 0.0000 0.0000 0.0000        0.3389\n## qsec 0.0171 0.0004 0.0131 0.0000 0.6196 0.3389"},{"path":"multireg.html","id":"迴歸分析","chapter":"7 多元迴歸","heading":"7.2 迴歸分析","text":"","code":""},{"path":"multireg.html","id":"簡單迴歸","chapter":"7 多元迴歸","heading":"7.2.1 簡單迴歸","text":"以lm()檢驗是否可以用車體重量（wt）預測油耗量（mpg）。結果顯示R-square = 0.75，F(1,30) = 91.38，p<.001，F檢定顯著，模型有良好解釋力。迴歸式為 mpg = -5.3445*wt + 37.2851。以package visreg的visreg()函數來畫迴歸線。","code":"\nmodel.mpg.wt <- lm(mpg ~ wt, data = mtcars)\nsummary(model.mpg.wt)## \n## Call:\n## lm(formula = mpg ~ wt, data = mtcars)\n## \n## Residuals:\n##     Min      1Q  Median      3Q     Max \n## -4.5432 -2.3647 -0.1252  1.4096  6.8727 \n## \n## Coefficients:\n##             Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)  37.2851     1.8776  19.858  < 2e-16 ***\n## wt           -5.3445     0.5591  -9.559 1.29e-10 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 3.046 on 30 degrees of freedom\n## Multiple R-squared:  0.7528, Adjusted R-squared:  0.7446 \n## F-statistic: 91.38 on 1 and 30 DF,  p-value: 1.294e-10\nlibrary(visreg)\nvisreg(model.mpg.wt)"},{"path":"multireg.html","id":"多元迴歸","chapter":"7 多元迴歸","heading":"7.2.2 多元迴歸","text":"以車體重量（wt）、馬力（hp）和排氣量（disp）來預測油耗量（mpg）。相關分析顯示三個預測項與油耗量皆為負相關。以lm()來做迴歸分析，迴歸分析結果顯示，R-square = 0.8268，F(3,28) = 44.57, p < .01。disp沒有顯著。若想進一步看淨相關和半淨相關，可用pcor()做淨相關(partial correlation)、用spcor()做半淨相關(semi-partial correlation)。淨相關結果顯示，三變項皆顯著相關，ps < .05。半淨相關結果顯示，僅wt顯著相關。看各變項對mpg的關係。以predict()來做預測。","code":"\nmodel.mpg.whd <- update(model.mpg.wt, .~. + hp + disp, data=mtcars)\nmodel.mpg.whd <- lm(mpg ~ wt + hp + disp, data = mtcars)\nsummary(model.mpg.whd)## \n## Call:\n## lm(formula = mpg ~ wt + hp + disp, data = mtcars)\n## \n## Residuals:\n##    Min     1Q Median     3Q    Max \n## -3.891 -1.640 -0.172  1.061  5.861 \n## \n## Coefficients:\n##              Estimate Std. Error t value Pr(>|t|)    \n## (Intercept) 37.105505   2.110815  17.579  < 2e-16 ***\n## wt          -3.800891   1.066191  -3.565  0.00133 ** \n## hp          -0.031157   0.011436  -2.724  0.01097 *  \n## disp        -0.000937   0.010350  -0.091  0.92851    \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 2.639 on 28 degrees of freedom\n## Multiple R-squared:  0.8268, Adjusted R-squared:  0.8083 \n## F-statistic: 44.57 on 3 and 28 DF,  p-value: 8.65e-11\nlibrary(ppcor)\nround(pcor(mtcars[c(1,6,4,3)])$estimate, 03) #partial##         mpg     wt     hp   disp\n## mpg   1.000 -0.559 -0.458 -0.017\n## wt   -0.559  1.000 -0.370  0.651\n## hp   -0.458 -0.370  1.000  0.521\n## disp -0.017  0.651  0.521  1.000\nround(pcor(mtcars[c(1,6,4,3)])$p.value, 03)##        mpg    wt    hp  disp\n## mpg  0.000 0.001 0.011 0.929\n## wt   0.001 0.000 0.044 0.000\n## hp   0.011 0.044 0.000 0.003\n## disp 0.929 0.000 0.003 0.000\nround(spcor(mtcars[c(1,6,4,3)])$estimate, 03) #semi-partial##         mpg     wt     hp   disp\n## mpg   1.000 -0.280 -0.214 -0.007\n## wt   -0.254  1.000 -0.150  0.323\n## hp   -0.277 -0.214  1.000  0.328\n## disp -0.006  0.317  0.226  1.000\nround(spcor(mtcars[c(1,6,4,3)])$p.value, 03)##        mpg    wt    hp  disp\n## mpg  0.000 0.133 0.256 0.970\n## wt   0.176 0.000 0.429 0.081\n## hp   0.139 0.256 0.000 0.076\n## disp 0.974 0.088 0.230 0.000\nvisreg(model.mpg.whd)\npredict(model.mpg.whd,\n        new = data.frame(wt = 5, hp = 250, disp = 300, am = \"Manual\"),\n        interval = \"confidence\",\n        level = .95\n)##        fit      lwr      upr\n## 1 10.03081 6.335154 13.72647"},{"path":"multireg.html","id":"迴歸模型的比較","chapter":"7 多元迴歸","heading":"7.2.3 迴歸模型的比較","text":"以ANOVA()來比較兩個迴歸模型。結果顯示三預測項的模型顯著優於一預測項模型。F(2, 83.33) = 5.98, p<.001。用AIC()來看兩個模型的AIC(Akaike information criterion)。結果顯示相較於一個預測項時，以三個預測項來預測mpg時，AIC有下降。","code":"\nanova(model.mpg.wt, model.mpg.whd)## Analysis of Variance Table\n## \n## Model 1: mpg ~ wt\n## Model 2: mpg ~ wt + hp + disp\n##   Res.Df    RSS Df Sum of Sq     F   Pr(>F)   \n## 1     30 278.32                               \n## 2     28 194.99  2    83.331 5.983 0.006863 **\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nAIC(model.mpg.wt)## [1] 166.0294\nAIC(model.mpg.whd)## [1] 158.643"},{"path":"multireg.html","id":"迴歸假設的檢驗","chapter":"7 多元迴歸","heading":"7.3 迴歸假設的檢驗","text":"檢驗資料是否符合迴歸分析的假設。","code":""},{"path":"multireg.html","id":"極端數值的影響","chapter":"7 多元迴歸","heading":"7.3.1 極端數值的影響","text":"standardize resuduals和studentize residuals。極端數值移除後對迴歸式的影響。以Cook’s distance看極端數值對整個模型的影響。看residual和leverage。","code":"\nlibrary(olsrr)\nols_plot_resid_stand(model.mpg.whd)\nols_plot_resid_stud(model.mpg.whd)\nols_plot_dfbetas(model.mpg.whd)\nols_plot_dffits(model.mpg.whd)\nols_plot_cooksd_bar(model.mpg.whd)\nols_plot_cooksd_chart(model.mpg.whd)\nlibrary(olsrr)\nols_plot_resid_lev(model.mpg.whd)"},{"path":"multireg.html","id":"homoscedasticity診斷","chapter":"7 多元迴歸","heading":"7.3.2 Homoscedasticity診斷","text":"看residual和fit。","code":"\nols_plot_resid_stud_fit(model.mpg.whd)"},{"path":"multireg.html","id":"共線性multicollinearity的檢驗","chapter":"7 多元迴歸","heading":"7.3.3 共線性multicollinearity的檢驗","text":"看vif和tolerance。最大的VIF大於10要注意、平均的VIF大於1可能有偏誤；tolerance小於0.1要注意、tolerance小於0.2可能有問題。","code":"\nlibrary(car)\nvif(model.mpg.whd)##       wt       hp     disp \n## 4.844618 2.736633 7.324517\n1/vif(model.mpg.whd)##        wt        hp      disp \n## 0.2064146 0.3654126 0.1365278"},{"path":"multireg.html","id":"誤差常態的檢定","chapter":"7 多元迴歸","heading":"7.3.4 誤差常態的檢定","text":"residuals常態分配的檢定。","code":"\nshapiro.test(residuals(model.mpg.whd))## \n##  Shapiro-Wilk normality test\n## \n## data:  residuals(model.mpg.whd)\n## W = 0.92734, p-value = 0.03305"},{"path":"multireg.html","id":"自相關檢驗","chapter":"7 多元迴歸","heading":"7.3.5 自相關檢驗","text":"用Durbin-Watson test看是否有autocorrelation。","code":"\nlibrary(car)\ndwt(model.mpg.whd)##  lag Autocorrelation D-W Statistic p-value\n##    1       0.2926117      1.367284    0.03\n##  Alternative hypothesis: rho != 0\ndurbinWatsonTest(model.mpg.whd)##  lag Autocorrelation D-W Statistic p-value\n##    1       0.2926117      1.367284    0.04\n##  Alternative hypothesis: rho != 0"},{"path":"multireg.html","id":"綜合檢驗","chapter":"7 多元迴歸","heading":"7.3.6 綜合檢驗","text":"可用內建的plot()功能一次看上述檢驗。若加which=1:6可看更多。也可以將圖表放在一起看。或以performance這個package來看迴歸的假設。計算各統計量並儲存。","code":"\nplot(model.mpg.whd)\npar(mfrow=c(2,2))\nplot(model.mpg.whd)\npar(mfrow=c(1,1))\nlibrary(performance)\nlibrary(see)\nlibrary(patchwork)\ncheck_model(model.mpg.whd)\nmtcars$residuals <- resid(model.mpg.whd)  \nmtcars$standardized.residuals <- rstandard(model.mpg.whd)\nmtcars$studentized.residuals <- rstudent(model.mpg.whd)\nmtcars$cooks.distance <- cooks.distance(model.mpg.whd)\nmtcars$leverage <- hatvalues(model.mpg.whd)\nmtcars <- cbind(mtcars, dfbetas(model.mpg.whd))\nnames(mtcars)[12:15] <- c('db_intercept', 'db_wt', 'db_hp', 'db_disp')\nmtcars$dffit <- dffits(model.mpg.whd)\nmtcars$fitted <- fitted(model.mpg.whd)"},{"path":"multireg.html","id":"逐步迴歸","chapter":"7 多元迴歸","heading":"7.4 逐步迴歸","text":"","code":""},{"path":"multireg.html","id":"前向法","chapter":"7 多元迴歸","heading":"7.4.1 前向法","text":"用lm()做逐步回歸。以下為前向法。","code":"\nmtcars2 <- mtcars[c(1,6,4,3)]\nnullM <- lm(mpg ~ 1, data = mtcars2)\nfullM <- lm(mpg ~ ., data = mtcars2)\nforM <- step(nullM, scope=list(lower=nullM, upper=fullM), direction=\"forward\")## Start:  AIC=115.94\n## mpg ~ 1\n## \n##        Df Sum of Sq     RSS     AIC\n## + wt    1    847.73  278.32  73.217\n## + disp  1    808.89  317.16  77.397\n## + hp    1    678.37  447.67  88.427\n## <none>              1126.05 115.943\n## \n## Step:  AIC=73.22\n## mpg ~ wt\n## \n##        Df Sum of Sq    RSS    AIC\n## + hp    1    83.274 195.05 63.840\n## + disp  1    31.639 246.68 71.356\n## <none>              278.32 73.217\n## \n## Step:  AIC=63.84\n## mpg ~ wt + hp\n## \n##        Df Sum of Sq    RSS    AIC\n## <none>              195.05 63.840\n## + disp  1   0.05708 194.99 65.831\nsummary(forM)## \n## Call:\n## lm(formula = mpg ~ wt + hp, data = mtcars2)\n## \n## Residuals:\n##    Min     1Q Median     3Q    Max \n## -3.941 -1.600 -0.182  1.050  5.854 \n## \n## Coefficients:\n##             Estimate Std. Error t value Pr(>|t|)    \n## (Intercept) 37.22727    1.59879  23.285  < 2e-16 ***\n## wt          -3.87783    0.63273  -6.129 1.12e-06 ***\n## hp          -0.03177    0.00903  -3.519  0.00145 ** \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 2.593 on 29 degrees of freedom\n## Multiple R-squared:  0.8268, Adjusted R-squared:  0.8148 \n## F-statistic: 69.21 on 2 and 29 DF,  p-value: 9.109e-12"},{"path":"multireg.html","id":"後向法","chapter":"7 多元迴歸","heading":"7.4.2 後向法","text":"backward method。","code":"\nfullM <- lm(mpg ~ ., data = mtcars2)\n# backM <- step(fullM, scope=list(upper=fullM), direction='backward') # 完整寫法\nbackM <- step(fullM, direction='backward') ## Start:  AIC=65.83\n## mpg ~ wt + hp + disp\n## \n##        Df Sum of Sq    RSS    AIC\n## - disp  1     0.057 195.05 63.840\n## <none>              194.99 65.831\n## - hp    1    51.692 246.68 71.356\n## - wt    1    88.503 283.49 75.806\n## \n## Step:  AIC=63.84\n## mpg ~ wt + hp\n## \n##        Df Sum of Sq    RSS    AIC\n## <none>              195.05 63.840\n## - hp    1    83.274 278.32 73.217\n## - wt    1   252.627 447.67 88.427\nsummary(backM)## \n## Call:\n## lm(formula = mpg ~ wt + hp, data = mtcars2)\n## \n## Residuals:\n##    Min     1Q Median     3Q    Max \n## -3.941 -1.600 -0.182  1.050  5.854 \n## \n## Coefficients:\n##             Estimate Std. Error t value Pr(>|t|)    \n## (Intercept) 37.22727    1.59879  23.285  < 2e-16 ***\n## wt          -3.87783    0.63273  -6.129 1.12e-06 ***\n## hp          -0.03177    0.00903  -3.519  0.00145 ** \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 2.593 on 29 degrees of freedom\n## Multiple R-squared:  0.8268, Adjusted R-squared:  0.8148 \n## F-statistic: 69.21 on 2 and 29 DF,  p-value: 9.109e-12"},{"path":"multireg.html","id":"逐步法","chapter":"7 多元迴歸","heading":"7.4.3 逐步法","text":"Stepwise method。","code":""},{"path":"multireg.html","id":"從full-model開始","chapter":"7 多元迴歸","heading":"7.4.3.1 從full model開始","text":"","code":"\nfullM <- lm(mpg ~ ., data = mtcars2)\n# stepM1 <- step(fullM, scope = list(upper=fullM), direction=\"both\") # 完整寫法\nstepM1 <- step(fullM, direction=\"both\") ## Start:  AIC=65.83\n## mpg ~ wt + hp + disp\n## \n##        Df Sum of Sq    RSS    AIC\n## - disp  1     0.057 195.05 63.840\n## <none>              194.99 65.831\n## - hp    1    51.692 246.68 71.356\n## - wt    1    88.503 283.49 75.806\n## \n## Step:  AIC=63.84\n## mpg ~ wt + hp\n## \n##        Df Sum of Sq    RSS    AIC\n## <none>              195.05 63.840\n## + disp  1     0.057 194.99 65.831\n## - hp    1    83.274 278.32 73.217\n## - wt    1   252.627 447.67 88.427"},{"path":"multireg.html","id":"從null-model開始","chapter":"7 多元迴歸","heading":"7.4.3.2 從null model開始","text":"結果可能會與從full model開始不同。","code":"\nnullM <- lm(mpg ~ 1, data = mtcars2)\nstepM2 <- step(nullM, scope = list(upper=fullM), direction=\"both\")## Start:  AIC=115.94\n## mpg ~ 1\n## \n##        Df Sum of Sq     RSS     AIC\n## + wt    1    847.73  278.32  73.217\n## + disp  1    808.89  317.16  77.397\n## + hp    1    678.37  447.67  88.427\n## <none>              1126.05 115.943\n## \n## Step:  AIC=73.22\n## mpg ~ wt\n## \n##        Df Sum of Sq     RSS     AIC\n## + hp    1     83.27  195.05  63.840\n## + disp  1     31.64  246.68  71.356\n## <none>               278.32  73.217\n## - wt    1    847.73 1126.05 115.943\n## \n## Step:  AIC=63.84\n## mpg ~ wt + hp\n## \n##        Df Sum of Sq    RSS    AIC\n## <none>              195.05 63.840\n## + disp  1     0.057 194.99 65.831\n## - hp    1    83.274 278.32 73.217\n## - wt    1   252.627 447.67 88.427\nsummary(stepM1)## \n## Call:\n## lm(formula = mpg ~ wt + hp, data = mtcars2)\n## \n## Residuals:\n##    Min     1Q Median     3Q    Max \n## -3.941 -1.600 -0.182  1.050  5.854 \n## \n## Coefficients:\n##             Estimate Std. Error t value Pr(>|t|)    \n## (Intercept) 37.22727    1.59879  23.285  < 2e-16 ***\n## wt          -3.87783    0.63273  -6.129 1.12e-06 ***\n## hp          -0.03177    0.00903  -3.519  0.00145 ** \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 2.593 on 29 degrees of freedom\n## Multiple R-squared:  0.8268, Adjusted R-squared:  0.8148 \n## F-statistic: 69.21 on 2 and 29 DF,  p-value: 9.109e-12\nsummary(stepM2)## \n## Call:\n## lm(formula = mpg ~ wt + hp, data = mtcars2)\n## \n## Residuals:\n##    Min     1Q Median     3Q    Max \n## -3.941 -1.600 -0.182  1.050  5.854 \n## \n## Coefficients:\n##             Estimate Std. Error t value Pr(>|t|)    \n## (Intercept) 37.22727    1.59879  23.285  < 2e-16 ***\n## wt          -3.87783    0.63273  -6.129 1.12e-06 ***\n## hp          -0.03177    0.00903  -3.519  0.00145 ** \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 2.593 on 29 degrees of freedom\n## Multiple R-squared:  0.8268, Adjusted R-squared:  0.8148 \n## F-statistic: 69.21 on 2 and 29 DF,  p-value: 9.109e-12"},{"path":"multireg.html","id":"另一種作法","chapter":"7 多元迴歸","heading":"7.4.3.3 另一種作法","text":"可用stepAIC()來做逐步回歸。沒指定scope時會用backward；指定scope時會用both。可用direction來指定forward、backward或both。","code":"\nlibrary(MASS)\nsummary(stepAIC(model.mpg.whd)) #沒指定scope時會用backward## Start:  AIC=65.83\n## mpg ~ wt + hp + disp\n## \n##        Df Sum of Sq    RSS    AIC\n## - disp  1     0.057 195.05 63.840\n## <none>              194.99 65.831\n## - hp    1    51.692 246.68 71.356\n## - wt    1    88.503 283.49 75.806\n## \n## Step:  AIC=63.84\n## mpg ~ wt + hp\n## \n##        Df Sum of Sq    RSS    AIC\n## <none>              195.05 63.840\n## - hp    1    83.274 278.32 73.217\n## - wt    1   252.627 447.67 88.427## \n## Call:\n## lm(formula = mpg ~ wt + hp, data = mtcars)\n## \n## Residuals:\n##    Min     1Q Median     3Q    Max \n## -3.941 -1.600 -0.182  1.050  5.854 \n## \n## Coefficients:\n##             Estimate Std. Error t value Pr(>|t|)    \n## (Intercept) 37.22727    1.59879  23.285  < 2e-16 ***\n## wt          -3.87783    0.63273  -6.129 1.12e-06 ***\n## hp          -0.03177    0.00903  -3.519  0.00145 ** \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 2.593 on 29 degrees of freedom\n## Multiple R-squared:  0.8268, Adjusted R-squared:  0.8148 \n## F-statistic: 69.21 on 2 and 29 DF,  p-value: 9.109e-12\nsummary(stepAIC(model.mpg.whd, scope = list(upper = ~wt+hp+disp, lower = ~1)))  #指定scope時會用both## Start:  AIC=65.83\n## mpg ~ wt + hp + disp\n## \n##        Df Sum of Sq    RSS    AIC\n## - disp  1     0.057 195.05 63.840\n## <none>              194.99 65.831\n## - hp    1    51.692 246.68 71.356\n## - wt    1    88.503 283.49 75.806\n## \n## Step:  AIC=63.84\n## mpg ~ wt + hp\n## \n##        Df Sum of Sq    RSS    AIC\n## <none>              195.05 63.840\n## + disp  1     0.057 194.99 65.831\n## - hp    1    83.274 278.32 73.217\n## - wt    1   252.627 447.67 88.427## \n## Call:\n## lm(formula = mpg ~ wt + hp, data = mtcars)\n## \n## Residuals:\n##    Min     1Q Median     3Q    Max \n## -3.941 -1.600 -0.182  1.050  5.854 \n## \n## Coefficients:\n##             Estimate Std. Error t value Pr(>|t|)    \n## (Intercept) 37.22727    1.59879  23.285  < 2e-16 ***\n## wt          -3.87783    0.63273  -6.129 1.12e-06 ***\n## hp          -0.03177    0.00903  -3.519  0.00145 ** \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 2.593 on 29 degrees of freedom\n## Multiple R-squared:  0.8268, Adjusted R-squared:  0.8148 \n## F-statistic: 69.21 on 2 and 29 DF,  p-value: 9.109e-12"},{"path":"multireg.html","id":"類別變項的迴歸","chapter":"7 多元迴歸","heading":"7.5 類別變項的迴歸","text":"若只有兩個levels，可直接做迴歸。若有多個levels，可以dummy coding的方式來做。","code":"\nmtcars$cyl<-factor(mtcars$cyl)\ncontrasts(mtcars$cyl)<-contr.treatment(3, base = 1) #generate contrasts\nmtcars$cyl##  [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4\n## attr(,\"contrasts\")\n##   2 3\n## 4 0 0\n## 6 1 0\n## 8 0 1\n## Levels: 4 6 8\nmodel.mpg.cyl <- lm(mpg ~ cyl, data = mtcars)\nsummary(model.mpg.cyl)## \n## Call:\n## lm(formula = mpg ~ cyl, data = mtcars)\n## \n## Residuals:\n##     Min      1Q  Median      3Q     Max \n## -5.2636 -1.8357  0.0286  1.3893  7.2364 \n## \n## Coefficients:\n##             Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)  26.6636     0.9718  27.437  < 2e-16 ***\n## cyl2         -6.9208     1.5583  -4.441 0.000119 ***\n## cyl3        -11.5636     1.2986  -8.905 8.57e-10 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 3.223 on 29 degrees of freedom\n## Multiple R-squared:  0.7325, Adjusted R-squared:  0.714 \n## F-statistic:  39.7 on 2 and 29 DF,  p-value: 4.979e-09"},{"path":"moderation.html","id":"moderation","chapter":"8 調節效果分析","heading":"8 調節效果分析","text":"本單元介紹如何以R語言做調節效果分析。","code":""},{"path":"moderation.html","id":"讀入資料並畫圖檢視","chapter":"8 調節效果分析","heading":"8.1 讀入資料並畫圖檢視","text":"以JASP提供的moderation.csv為例，以R做分析。此資料測量觀察到的寵物鸚鵡與其主人的親近度（closeness）、主人表現出的情感行為量（affection）與鸚鵡的性別。設定工作目錄。讀入資料。畫情感行為量與親近度的散佈圖，並依據不同的鸚鵡性別上色。","code":"\ncData <- read.table(\"moderation.csv\", header=TRUE, sep=\",\")\nlibrary(ggplot2)\nqplot(affection, closeness, colour = gender, data = cData)"},{"path":"moderation.html","id":"調節變項為類別變項","chapter":"8 調節效果分析","heading":"8.2 調節變項為類別變項","text":"以下檢驗是否鸚鵡的性別可以調節主人表現出的情感對他們和鸚鵡之間的親密度。欲測試的想法為：主人表現出的情感對他們和鸚鵡之間的親密度有正向的效果；但對於雄性或雌性鸚鵡，這種效果可能會有所不同。意即，情感對親近的影響是由鸚鵡的性別調節的。","code":""},{"path":"moderation.html","id":"模型檢驗","chapter":"8 調節效果分析","heading":"8.2.1 模型檢驗","text":"將情感中心化後，以pequod套件中的lmres()函數做迴歸分析。此函數可直接以type=nested來看兩階段的迴歸模型，一為沒有交互作用項的，一為有交互作用項的，並檢驗加入交互作用項的模型是否顯著。由上面結果可知兩模型皆顯著，但加入交互作用的模型比未加入的模型可以多解釋9%的變異量，此增加的解釋量達到顯著，\\(\\Delta\\)R^2 = .09, F(1,96) = 64.1, p < .001。迴歸式為closeness = 6.37 + 0.42 affection - 4.43 genderM - 0.38 affection\\(\\times\\)genderM。","code":"\nlibrary(pequod)\nm1 <- lmres(closeness~affection*gender, centered=c(\"affection\"), data=cData)\nsummary(m1, type=\"nested\")## **Models**\n## \n## Model 1: closeness ~ affection + genderMale\n## <environment: 0x0000021973996168>\n## \n## Model 2: closeness ~ affection + genderMale + affection.XX.genderMale\n## <environment: 0x0000021973996168>\n## \n## \n## **Statistics**\n## \n##             R     R^2   Adj. R^2   Diff.R^2    F     df1  df2    p.value    \n## Model 1    0.88   0.77      0.76       0.77 160.04   2.00   97 < 2.2e-16 ***\n## Model 2:   0.93   0.86      0.86       0.09 197.52   3.00   96 < 2.2e-16 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## \n## **F change**\n## \n##   Res.Df RSS  Df Sum of Sq    F  Pr(>F)    \n## 1     97 177                               \n## 2     96 106   1        71 64.1 2.7e-12 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## \n## **Coefficients**\n## \n##                          Estimate    StdErr   t.value    beta   p.value    \n## -- Model 1 --                                                              \n##                                                                            \n## (Intercept)               6.29135   0.19168  32.82144         < 2.2e-16 ***\n## affection                 0.26269   0.02963   8.86462  0.4367 < 2.2e-16 ***\n## genderMale               -4.46269   0.27189 -16.41354 -0.8085 < 2.2e-16 ***\n##                                                                            \n##                                                                            \n## -- Model 2 --                                                              \n##                                                                            \n## (Intercept)               6.36873   0.14950  42.60126         < 2.2e-16 ***\n## affection                 0.41746   0.03009  13.87403  0.6939 < 2.2e-16 ***\n## genderMale               -4.42985   0.21165 -20.93042 -0.8026 < 2.2e-16 ***\n## affection.XX.genderMale  -0.37521   0.04685  -8.00877 -0.3996 < 2.2e-16 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1"},{"path":"moderation.html","id":"simple-slope分析","chapter":"8 調節效果分析","heading":"8.2.2 Simple slope分析","text":"交互作用顯著，表示有調節效果。接著可做Simple slope分析，看鸚鵡的性別為雄性/雌性與情感在正/負一個標準差時的親密程度預測值。對上述Simple Slope作圖。","code":"\nSim_m1 <- simpleSlope(m1, pred=\"affection\", mod1=\"genderMale\", coded=\"genderMale\")\nsummary(Sim_m1)## \n## ** Estimated points of closeness  **\n## \n##                       Low affection (-1 SD) High affection (+1 SD)\n## Low genderMale ( 0 )                 4.4440                 8.2935\n## High genderMale ( 1 )                1.7441                 2.1337\n## \n## \n## \n## ** Simple Slopes analysis ( df= 96 ) **\n## \n##                       simple slope standard error t-value p.value    \n## Low genderMale ( 0 )        0.4175         0.0301   13.87  <2e-16 ***\n## High genderMale ( 1 )       0.0422         0.0359    1.18    0.24    \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## \n## \n## ** Bauer & Curran 95% CI **\n## \n##            lower CI upper CI\n## genderMale   0.9366   1.3778\nPlotSlope(Sim_m1)"},{"path":"moderation.html","id":"調節變項為連續變項","chapter":"8 調節效果分析","heading":"8.3 調節變項為連續變項","text":"","code":""},{"path":"moderation.html","id":"模型檢驗-1","chapter":"8 調節效果分析","heading":"8.3.1 模型檢驗","text":"資料與上面相同，但將情感作為調節變項、鸚鵡的性別做為預測項。迴歸式相同，故迴歸分析結果同上。","code":"\nlibrary(pequod)\nm2 <- lmres(closeness~gender*affection, centered=c(\"affection\"), data=cData)\nsummary(m2, type=\"nested\")## **Models**\n## \n## Model 1: closeness ~ genderMale + affection\n## <environment: 0x000002197415b570>\n## \n## Model 2: closeness ~ genderMale + affection + genderMale.XX.affection\n## <environment: 0x000002197415b570>\n## \n## \n## **Statistics**\n## \n##             R     R^2   Adj. R^2   Diff.R^2    F     df1  df2    p.value    \n## Model 1    0.88   0.77      0.76       0.77 160.04   2.00   97 < 2.2e-16 ***\n## Model 2:   0.93   0.86      0.86       0.09 197.52   3.00   96 < 2.2e-16 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## \n## **F change**\n## \n##   Res.Df RSS  Df Sum of Sq    F  Pr(>F)    \n## 1     97 177                               \n## 2     96 106   1        71 64.1 2.7e-12 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## \n## **Coefficients**\n## \n##                          Estimate    StdErr   t.value    beta   p.value    \n## -- Model 1 --                                                              \n##                                                                            \n## (Intercept)               6.29135   0.19168  32.82144         < 2.2e-16 ***\n## genderMale               -4.46269   0.27189 -16.41354 -0.8085 < 2.2e-16 ***\n## affection                 0.26269   0.02963   8.86462  0.4367 < 2.2e-16 ***\n##                                                                            \n##                                                                            \n## -- Model 2 --                                                              \n##                                                                            \n## (Intercept)               6.36873   0.14950  42.60126         < 2.2e-16 ***\n## genderMale               -4.42985   0.21165 -20.93042 -0.8026 < 2.2e-16 ***\n## affection                 0.41746   0.03009  13.87403  0.6939 < 2.2e-16 ***\n## genderMale.XX.affection  -0.37521   0.04685  -8.00877 -0.3996 < 2.2e-16 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1"},{"path":"moderation.html","id":"simple-slope分析-1","chapter":"8 調節效果分析","heading":"8.3.2 Simple slope分析","text":"因交互作用顯著，有調節效果，故同樣做simple slope分析。Simple slope分析結果圖。","code":"\nSim_m2 <- simpleSlope(m1, pred=\"genderMale\", mod1=\"affection\", coded=\"genderMale\")\nsummary(Sim_m2)## \n## ** Estimated points of closeness  **\n## \n##                        Low genderMale ( 0 ) High genderMale ( 1 )\n## Low affection (-1 SD)                4.4440                1.7441\n## High affection (+1 SD)               8.2935                2.1337\n## \n## \n## \n## ** Simple Slopes analysis ( df= 96 ) **\n## \n##                        simple slope standard error t-value p.value    \n## Low affection (-1 SD)        -2.700          0.305   -8.84  <2e-16 ***\n## High affection (+1 SD)       -6.160          0.300  -20.57  <2e-16 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## \n## \n## ** Bauer & Curran 95% CI **\n## \n##           lower CI upper CI\n## affection  -15.864  -9.2647\nPlotSlope(Sim_m2)"},{"path":"moderation.html","id":"以johnson-neyman-technique","chapter":"8 調節效果分析","heading":"8.3.3 以Johnson-Neyman technique","text":"若要以Johnson-Neyman (JN) technique進一步探究調節效果，需要用R內建的lm()函數來做迴歸。為了和上面結果相呼應，先產生一個dummy variable: genderD，將男生設為1、女生為0。這邊直接將原dataframe中的gender_dummy以1去減即可。若資料中沒有gender_dummy變項，也可以用plyr套件中的revalue()函數將Male轉為1、Female轉為0，再用as.numeric()函數將之轉為數值。將情感(affection)中心化，產生一新的變項affectionC。以affectionC和genderD來預測closeness。上述迴歸式加入affectionC*genderD來預測closeness。以anova()比較兩模型。結果同上，有交互作用項的模型有顯著提高解釋力。用processR來做分析。processR目前無法用在最新版的R 4.2.0版，會讓整個R當掉。但R 4.2.0之前的版本沒有問題。尤其processR在R 4.2.0會有問題，下面的程式碼請自行執行，不再demo。用modelSummary()來整理迴歸的結果表。用modelSummary2()來看不同affection(-1SD、0、+1SD)和gender(0、1)組合的closeness。用modSummary3()來看conditional effect。結果顯示，當affectionC為0時，slope為-4.43；affectionC為+1 SD時，slope為-2.70；affectionC為-1 SD時，slope為-6.16。","code":"\ncData$genderD <- 1 - cData$gender_dummy\nlibrary(plyr)\ncData$D <- as.numeric(revalue(cData$gender, c(\"Male\"=1, 'Female'=0)))\ncData$affectionC <- c(scale(cData$affection, center=TRUE, scale=FALSE))\nres0 <- lm(closeness ~ affectionC + genderD, data=cData)\nsummary(res0)## \n## Call:\n## lm(formula = closeness ~ affectionC + genderD, data = cData)\n## \n## Residuals:\n##     Min      1Q  Median      3Q     Max \n## -3.3733 -0.8598  0.2029  0.8282  3.0625 \n## \n## Coefficients:\n##             Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)  6.29135    0.19168  32.821  < 2e-16 ***\n## affectionC   0.26269    0.02963   8.865 3.78e-14 ***\n## genderD     -4.46269    0.27189 -16.414  < 2e-16 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 1.351 on 97 degrees of freedom\n## Multiple R-squared:  0.7674, Adjusted R-squared:  0.7626 \n## F-statistic:   160 on 2 and 97 DF,  p-value: < 2.2e-16\nres1 <- lm(closeness ~ affectionC + genderD + affectionC*genderD, data=cData)\nsummary(res1)## \n## Call:\n## lm(formula = closeness ~ affectionC + genderD + affectionC * \n##     genderD, data = cData)\n## \n## Residuals:\n##      Min       1Q   Median       3Q      Max \n## -2.18730 -0.74369 -0.06341  0.68137  2.89720 \n## \n## Coefficients:\n##                    Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)         6.36873    0.14950  42.601  < 2e-16 ***\n## affectionC          0.41746    0.03009  13.874  < 2e-16 ***\n## genderD            -4.42985    0.21165 -20.930  < 2e-16 ***\n## affectionC:genderD -0.37521    0.04685  -8.009 2.72e-12 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 1.052 on 96 degrees of freedom\n## Multiple R-squared:  0.8606, Adjusted R-squared:  0.8562 \n## F-statistic: 197.5 on 3 and 96 DF,  p-value: < 2.2e-16\nanova(res0, res1)## Analysis of Variance Table\n## \n## Model 1: closeness ~ affectionC + genderD\n## Model 2: closeness ~ affectionC + genderD + affectionC * genderD\n##   Res.Df    RSS Df Sum of Sq     F    Pr(>F)    \n## 1     97 177.14                                 \n## 2     96 106.19  1    70.948 64.14 2.722e-12 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nlibrary(processR)\nmodelsSummary(res1)\nmodSummary2(res1, rangemode=1)\nmodSummary3(res1, X='genderD', W='affectionC', rangemode=1)"},{"path":"moderation.html","id":"以rockchalk套件分析","chapter":"8 調節效果分析","heading":"8.3.3.1 以rockchalk套件分析","text":"以rockchalk套件的plotSlopes()來畫上述conditional effect的圖。Johnson-Neyman (JN) technique: 檢驗各affectC下的conditional effect，其slope是否顯著。","code":"\nlibrary(rockchalk)\nps <- plotSlopes(res1, plotx=\"genderD\", modx=\"affectionC\", modxVals=\"std.dev\")\nts <- testSlopes(ps)## Values of affectionC OUTSIDE this interval:\n##         lo         hi \n## -15.931548  -9.238178 \n## cause the slope of (b1 + b2*affectionC)genderD to be statistically significant\nplot(ts)"},{"path":"moderation.html","id":"以interacions套件分析","chapter":"8 調節效果分析","heading":"8.3.3.2 以interacions套件分析","text":"interactions套件也提供很好的視覺化圖表功能，可用來看conditional effect與Johnson-Neyman分析。畫conditional effect的圖，含資料點。畫conditional effect的圖，含信賴區間。做Johnson-Neyman分析。或是用john_neyman()函數來做圖。","code":"\nlibrary(interactions)\ninteract_plot(res1, pred = genderD, modx = affectionC, plot.points = TRUE)\ninteract_plot(res1, pred = genderD, modx = affectionC, interval = TRUE)\nsim_slopes(res1, pred = genderD, modx = affectionC, jnplot = TRUE)## JOHNSON-NEYMAN INTERVAL \n## \n## When affectionC is OUTSIDE the interval [-15.93, -9.24], the slope of\n## genderD is p < .05.\n## \n## Note: The range of observed values of affectionC is [-10.12, 13.88]## SIMPLE SLOPES ANALYSIS \n## \n## Slope of genderD when affectionC = -4.61066e+00 (- 1 SD): \n## \n##    Est.   S.E.   t val.      p\n## ------- ------ -------- ------\n##   -2.70   0.31    -8.84   0.00\n## \n## Slope of genderD when affectionC =  7.81597e-16 (Mean): \n## \n##    Est.   S.E.   t val.      p\n## ------- ------ -------- ------\n##   -4.43   0.21   -20.93   0.00\n## \n## Slope of genderD when affectionC =  4.61066e+00 (+ 1 SD): \n## \n##    Est.   S.E.   t val.      p\n## ------- ------ -------- ------\n##   -6.16   0.30   -20.57   0.00\njohnson_neyman(model = res1, pred = genderD, modx = affectionC)## JOHNSON-NEYMAN INTERVAL \n## \n## When affectionC is OUTSIDE the interval [-15.93, -9.24], the slope of\n## genderD is p < .05.\n## \n## Note: The range of observed values of affectionC is [-10.12, 13.88]"},{"path":"moderation.html","id":"用process-macro來分析","chapter":"8 調節效果分析","heading":"8.3.3.3 用process macro來分析","text":"若是習慣使用Andrew Hayes發展的process macro，可先到process的網站下載檔案。解壓縮後直接執行process.R。可用source(‘檔案路徑’)來執行，或全選後按run執行，前者會快一些，因為不會列印出一堆文字。同上的model，以process來做分析。model=1是調節模型，jn=1表示要執行Johnson–Neyman Technique分析。center=2表示僅將連續變項中心化，plot=1表示要輸出Data visualizing conditional effect focal predictor。","code":"\nsource('D:\\\\Dropbox\\\\processR\\\\PROCESS v4.1 for R\\\\process.R')\nprocess(data=cData,y=\"closeness\",x=\"genderD\",w=\"affection\", model=1, center=2, jn=1, plot=1)"},{"path":"mediation.html","id":"mediation","chapter":"9 中介效果分析","heading":"9 中介效果分析","text":"本單元介紹如何以R語言做中介效果分析。","code":""},{"path":"mediation.html","id":"讀入資料並畫圖檢視-1","chapter":"9 中介效果分析","heading":"9.1 讀入資料並畫圖檢視","text":"以JASP提供的mediation.csv為例，以R做分析。此資料為一項假設的研究資料。在研究中以量表詢問了父母對孩子的養育採取自由放任態度的程度(laissez_faire)、孩子的獨立程度(independence)、以及孩子的探索行為量(exploration)。研究假設為：強烈的自由放任態度對孩子的獨立性有正向的效果。其可能的機制為，自由放任的態度會影響孩子的探索行為量，進而影響其獨立性。意即，探索是態度對獨立性影響的中介變項。以read.table()獨入資料。","code":"\nmData <- read.table(\"mediation.csv\", header=TRUE, sep=\",\")"},{"path":"mediation.html","id":"以r內建的lm函數來做分析","chapter":"9 中介效果分析","heading":"9.2 以R內建的lm函數來做分析","text":"","code":""},{"path":"mediation.html","id":"總效果檢驗","chapter":"9 中介效果分析","heading":"9.2.1 總效果檢驗","text":"以laissez_faire預測independence，模型解釋力顯著。","code":"\nfit <- lm(independence~laissez_faire, data=mData)\nsummary(fit)## \n## Call:\n## lm(formula = independence ~ laissez_faire, data = mData)\n## \n## Residuals:\n##     Min      1Q  Median      3Q     Max \n## -6.6202 -1.5732 -0.0493  1.4424  6.5051 \n## \n## Coefficients:\n##               Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)    5.21426    0.61960   8.415 3.27e-13 ***\n## laissez_faire  0.23433    0.05151   4.549 1.54e-05 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 2.363 on 98 degrees of freedom\n## Multiple R-squared:  0.1744, Adjusted R-squared:  0.1659 \n## F-statistic:  20.7 on 1 and 98 DF,  p-value: 1.544e-05"},{"path":"mediation.html","id":"以預測項來預測中介變項","chapter":"9 中介效果分析","heading":"9.2.2 以預測項來預測中介變項","text":"以laissez_faire預測exploration，效果亦顯著。","code":"\nfita <- lm(exploration ~ laissez_faire, data=mData)\nsummary(fita)## \n## Call:\n## lm(formula = exploration ~ laissez_faire, data = mData)\n## \n## Residuals:\n##      Min       1Q   Median       3Q      Max \n## -2.12610 -0.76207 -0.08926  0.60196  2.56513 \n## \n## Coefficients:\n##               Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)    2.18840    0.27134   8.065 1.84e-12 ***\n## laissez_faire  0.17281    0.02256   7.661 1.33e-11 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 1.035 on 98 degrees of freedom\n## Multiple R-squared:  0.3746, Adjusted R-squared:  0.3682 \n## F-statistic: 58.69 on 1 and 98 DF,  p-value: 1.333e-11"},{"path":"mediation.html","id":"中介變項與預測項共同預測依變項","chapter":"9 中介效果分析","heading":"9.2.3 中介變項與預測項共同預測依變項","text":"","code":"\nfitb <- lm(independence ~ exploration + laissez_faire, data=mData)\nsummary(fitb)## \n## Call:\n## lm(formula = independence ~ exploration + laissez_faire, data = mData)\n## \n## Residuals:\n##     Min      1Q  Median      3Q     Max \n## -4.1713 -0.7227 -0.0016  0.8303  2.8300 \n## \n## Coefficients:\n##               Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)    0.84015    0.38843   2.163 0.033003 *  \n## exploration    1.99877    0.11211  17.829  < 2e-16 ***\n## laissez_faire -0.11107    0.03165  -3.509 0.000684 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 1.148 on 97 degrees of freedom\n## Multiple R-squared:  0.807,  Adjusted R-squared:  0.803 \n## F-statistic: 202.7 on 2 and 97 DF,  p-value: < 2.2e-16"},{"path":"mediation.html","id":"中介效果檢驗","chapter":"9 中介效果分析","heading":"9.2.4 中介效果檢驗","text":"以stargazer套件的stargazer()函數來看三變項之間的關係。以multilevel套件的sobel()函數來做Sobel test檢驗中介效果，看indirect effect是否顯著。以bda套件的mediation.test()函數來做Sobel mediation test，變項的順序依序為mv、iv、dv。","code":"\nlibrary(stargazer)\nstargazer(fit, fita, fitb, type = \"text\", title = \"Baron and Kenny Method\")## \n## Baron and Kenny Method\n## =========================================================================================\n##                                              Dependent variable:                         \n##                     ---------------------------------------------------------------------\n##                          independence           exploration            independence      \n##                              (1)                    (2)                     (3)          \n## -----------------------------------------------------------------------------------------\n## exploration                                                              1.999***        \n##                                                                           (0.112)        \n##                                                                                          \n## laissez_faire              0.234***               0.173***               -0.111***       \n##                            (0.052)                (0.023)                 (0.032)        \n##                                                                                          \n## Constant                   5.214***               2.188***                0.840**        \n##                            (0.620)                (0.271)                 (0.388)        \n##                                                                                          \n## -----------------------------------------------------------------------------------------\n## Observations                 100                    100                     100          \n## R2                          0.174                  0.375                   0.807         \n## Adjusted R2                 0.166                  0.368                   0.803         \n## Residual Std. Error    2.363 (df = 98)        1.035 (df = 98)         1.148 (df = 97)    \n## F Statistic         20.696*** (df = 1; 98) 58.688*** (df = 1; 98) 202.746*** (df = 2; 97)\n## =========================================================================================\n## Note:                                                         *p<0.1; **p<0.05; ***p<0.01\nlibrary(multilevel)\nsobel(mData$laissez_faire, mData$exploration, mData$independence)## $`Mod1: Y~X`\n##              Estimate Std. Error  t value     Pr(>|t|)\n## (Intercept) 5.2142586 0.61960212 8.415495 3.267909e-13\n## pred        0.2343293 0.05150847 4.549335 1.543558e-05\n## \n## $`Mod2: Y~X+M`\n##               Estimate Std. Error   t value     Pr(>|t|)\n## (Intercept)  0.8401457 0.38842542  2.162952 3.300257e-02\n## pred        -0.1110699 0.03165459 -3.508809 6.841546e-04\n## med          1.9987717 0.11210741 17.829078 2.255937e-32\n## \n## $`Mod3: M~X`\n##              Estimate Std. Error  t value     Pr(>|t|)\n## (Intercept) 2.1884004  0.2713435 8.065056 1.842647e-12\n## pred        0.1728057  0.0225572 7.660779 1.333137e-11\n## \n## $Indirect.Effect\n## [1] 0.3453992\n## \n## $SE\n## [1] 0.04907255\n## \n## $z.value\n## [1] 7.038542\n## \n## $N\n## [1] 100\nlibrary(bda)\nmediation.test(mData$exploration, mData$laissez_faire, mData$independence)##                Sobel       Aroian      Goodman\n## z.value 7.038542e+00 7.029215e+00 7.047906e+00\n## p.value 1.942620e-12 2.076993e-12 1.816300e-12"},{"path":"mediation.html","id":"以psych套件來分析","chapter":"9 中介效果分析","heading":"9.3 以psych套件來分析","text":"用psych套件的mediate()函數來做中介效果的分析。畫圖呈現。","code":"\nlibrary(psych)\nm1 <- mediate(independence ~ laissez_faire + (exploration), data=mData, n.iter = 10000) \nsummary(m1)## Call: mediate(y = independence ~ laissez_faire + (exploration), data = mData, \n##     n.iter = 10000)\n## \n## Direct effect estimates (traditional regression)    (c') X + M on Y \n##               independence   se     t df     Prob\n## Intercept             0.84 0.39  2.16 97 3.30e-02\n## laissez_faire        -0.11 0.03 -3.51 97 6.84e-04\n## exploration           2.00 0.11 17.83 97 2.26e-32\n## \n## R = 0.9 R2 = 0.81   F = 202.75 on 2 and 97 DF   p-value:  2.26e-35 \n## \n##  Total effect estimates (c) (X on Y) \n##               independence   se    t df     Prob\n## Intercept             5.21 0.62 8.42 98 3.27e-13\n## laissez_faire         0.23 0.05 4.55 98 1.54e-05\n## \n##  'a'  effect estimates (X on M) \n##               exploration   se    t df     Prob\n## Intercept            2.19 0.27 8.07 98 1.84e-12\n## laissez_faire        0.17 0.02 7.66 98 1.33e-11\n## \n##  'b'  effect estimates (M on Y controlling for X) \n##             independence   se     t df     Prob\n## exploration            2 0.11 17.83 97 2.26e-32\n## \n##  'ab'  effect estimates (through all  mediators)\n##               independence boot   sd lower upper\n## laissez_faire         0.35 0.35 0.05  0.26  0.44\nmediate.diagram(m1)"},{"path":"mediation.html","id":"以mediation套件來做分析","chapter":"9 中介效果分析","heading":"9.4 以mediation套件來做分析","text":"以mediation套件來做中介效果的分析。中介分析的結果如下表。其中，ACME為Average Causal Mediation Effect (indirect effects)，ADE為Average Direct Effect，Prop. Mediated為ACME/Total Effect的比率。由結果可知，laissez_faire可預測independence (b = 0.233, p < .001)，而exploration在此關係中具有中介效果(b = 0.344, p < .001), laissez_faire有直接效果(b = -0.111, p < .001)。效果圖示。","code":"\nlibrary(mediation)\nfitM <- lm(exploration ~ laissez_faire, data=mData)\nfitY <- lm(independence ~ laissez_faire + exploration, data=mData)\nsummary(fitM)## \n## Call:\n## lm(formula = exploration ~ laissez_faire, data = mData)\n## \n## Residuals:\n##      Min       1Q   Median       3Q      Max \n## -2.12610 -0.76207 -0.08926  0.60196  2.56513 \n## \n## Coefficients:\n##               Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)    2.18840    0.27134   8.065 1.84e-12 ***\n## laissez_faire  0.17281    0.02256   7.661 1.33e-11 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 1.035 on 98 degrees of freedom\n## Multiple R-squared:  0.3746, Adjusted R-squared:  0.3682 \n## F-statistic: 58.69 on 1 and 98 DF,  p-value: 1.333e-11\nsummary(fitY)## \n## Call:\n## lm(formula = independence ~ laissez_faire + exploration, data = mData)\n## \n## Residuals:\n##     Min      1Q  Median      3Q     Max \n## -4.1713 -0.7227 -0.0016  0.8303  2.8300 \n## \n## Coefficients:\n##               Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)    0.84015    0.38843   2.163 0.033003 *  \n## laissez_faire -0.11107    0.03165  -3.509 0.000684 ***\n## exploration    1.99877    0.11211  17.829  < 2e-16 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 1.148 on 97 degrees of freedom\n## Multiple R-squared:  0.807,  Adjusted R-squared:  0.803 \n## F-statistic: 202.7 on 2 and 97 DF,  p-value: < 2.2e-16\nfitMed <- mediate(fitM, fitY, treat=\"laissez_faire\", mediator=\"exploration\")\nsummary(fitMed)## \n## Causal Mediation Analysis \n## \n## Quasi-Bayesian Confidence Intervals\n## \n##                Estimate 95% CI Lower 95% CI Upper p-value    \n## ACME              0.346        0.256         0.44  <2e-16 ***\n## ADE              -0.111       -0.172        -0.05  <2e-16 ***\n## Total Effect      0.235        0.130         0.33  <2e-16 ***\n## Prop. Mediated    1.480        1.163         2.10  <2e-16 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Sample Size Used: 100 \n## \n## \n## Simulations: 1000\nplot(fitMed)"},{"path":"mediation.html","id":"bootstrapping法","chapter":"9 中介效果分析","heading":"9.4.1 Bootstrapping法","text":"若為小樣本、資料違反常態，可用Bootstrapping法。","code":"\nfitMedBoot <- mediate(fitM, fitY, boot=TRUE, sims=999, treat=\"laissez_faire\", mediator=\"exploration\")\nsummary(fitMedBoot)## \n## Causal Mediation Analysis \n## \n## Nonparametric Bootstrap Confidence Intervals with the Percentile Method\n## \n##                Estimate 95% CI Lower 95% CI Upper p-value    \n## ACME              0.345        0.262         0.44  <2e-16 ***\n## ADE              -0.111       -0.172        -0.05  <2e-16 ***\n## Total Effect      0.234        0.150         0.33  <2e-16 ***\n## Prop. Mediated    1.474        1.202         1.95  <2e-16 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Sample Size Used: 100 \n## \n## \n## Simulations: 999\nplot(fitMedBoot)"},{"path":"multisheets.html","id":"multisheets","chapter":"10 多個EXCEL檔的資料匯整與分析","heading":"10 多個EXCEL檔的資料匯整與分析","text":"以R整理多個excel檔的資料並加以統計 - 以學生學習成效資料為例。","code":""},{"path":"multisheets.html","id":"學習成效分析","chapter":"10 多個EXCEL檔的資料匯整與分析","heading":"10.1 學習成效分析","text":"下載學習成效原始資料，並統計2017~2020年所有課程的學習成效。先將所有檔案放到工作目錄下的一個資料夾(例如TableDemo資料夾)內，並在R中設定好工作目錄。(你也可以將此資料夾設為工作目錄，這邊因為Rmarkdown的關係，所以這樣設定。)","code":"\nsetwd(\"D:\\\\Dropbox\\\\Working\\\\教師社群\")"},{"path":"multisheets.html","id":"讀入單一工作表並抽取所需資料","chapter":"10 多個EXCEL檔的資料匯整與分析","heading":"10.2 讀入單一工作表並抽取所需資料","text":"先讀入單一工作表，並抽取學習成效的資料。以readxl套件，讀取UG-2017.xlsx的sheet 1。因為表格中沒有column name，readxl會出現警告訊息，不想看到的話可以加上suppressMessages()。以which()找出「三、學習成效評估」的位置，為「學習成效評估表」的起始位置；並以整個表格長度做為「學習成效評估表」的終點位置。抓出「學習成效評估表」的所有數值。刪除NA的列。刪掉每個題目表格的title列。","code":"\nlibrary(readxl)\nsuppressMessages(qData <- read_xlsx(\"TableDemo\\\\UG-2017.xlsx\", 1))\nindex_start <- which(qData$`一、教學意見量化結果`==\"三、學習成效評估\")\nindex_end <- length(qData$`一、教學意見量化結果`)\nlibrary(dplyr)\nmyData <- slice(qData,index_start:index_end)  \n# myData <- qData[index_start:index_end,]  #相當於這樣寫 \nmyData\ndata1 <- na.omit(myData) # way1\n## data1 <- myData[complete.cases(myData), ] #way2\n## data1 <- myData[complete.cases(myData[ , 1:8]),] #way3: 可刪除部份data\n\ndata1\ndata2 <- subset(data1, `一、教學意見量化結果`!=\"題目\", select=c(1,2,8))\ndata2"},{"path":"multisheets.html","id":"簡化程式","chapter":"10 多個EXCEL檔的資料匯整與分析","heading":"10.2.1 簡化程式","text":"以%>%來簡化程式，讓程式更具可讀性，也不需在中間過程多存出變項。意即，只要將qData放入後，即可產生tb1 (即上述data2)。","code":"\ntb1 <- slice(qData,index_start:index_end) %>%\n  na.omit() %>%\n  subset(`一、教學意見量化結果`!=\"題目\", select=c(1,2,8))"},{"path":"multisheets.html","id":"寫成函數","chapter":"10 多個EXCEL檔的資料匯整與分析","heading":"10.2.2 寫成函數","text":"將上述步驟寫成函數anal_Teach_Q，只要給予filename和nSheet即可傳回tb1。呼叫anal_Teach_Q，分析「UG-2017.xlsx」的sheet1。","code":"\nlibrary(readxl)\nlibrary(dplyr)\n\nanal_Teach_Q <- function(filename, nSheet){\n  suppressMessages(qData <- read_xlsx(filename, nSheet))\n  index_start <- which(qData$`一、教學意見量化結果`==\"三、學習成效評估\")\n  index_end <- length(qData$`一、教學意見量化結果`)\n  tb1 <- slice(qData,index_start:index_end) %>%\n    na.omit() %>%\n    subset(`一、教學意見量化結果`!=\"題目\", select=c(1,2,8))\n  return(tb1)\n}\nthisfilename <- \"TableDemo\\\\UG-2017.xlsx\"\nnSheet <- 1\ntb1 <- anal_Teach_Q(thisfilename, nSheet)\ntb1"},{"path":"multisheets.html","id":"讀取一個檔案的多個工作表","chapter":"10 多個EXCEL檔的資料匯整與分析","heading":"10.3 讀取一個檔案的多個工作表","text":"當有很多個工作表需讀入時，你可以這樣寫：更有效率的做法是用for迴圈。若要將所有表單放在一起，可以這樣寫。統計同項目的平均值和個數。由於tbs的項目不是數字，故須先轉為數字。將表格整理成dataframe。","code":"\nthisfilename <- \"TableDemo\\\\UG-2017.xlsx\"\ntb1 <- anal_Teach_Q(thisfilename, 1)\ntb2 <- anal_Teach_Q(thisfilename, 2)\ntb3 <- anal_Teach_Q(thisfilename, 3)\ntblist <- list()\nfor (i in 1:3) {\n  tb0 <- anal_Teach_Q(thisfilename, i)  \n  tblist[[i]] <- tb0\n}\n# tblist\ntbs <- data.frame()\nfor (i in 1:3) {\n  tb0 <- anal_Teach_Q(thisfilename, i)  \n  tbs <- rbind(tbs, tb0)\n}\ntbs\ntbs[,c(2:3)] <- lapply(tbs[,c(2:3)], as.numeric)\ntbs1 <- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), mean)\ntbs2 <- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), length)\ntbs1\ntb <- data.frame(\"item\" = tbs1$Group.1, \"n\" = tbs2$x, \"mean\" = tbs1$x)\ntb"},{"path":"multisheets.html","id":"以for迴圈讀入檔案中的所有工作表","chapter":"10 多個EXCEL檔的資料匯整與分析","heading":"10.4 以for迴圈讀入檔案中的所有工作表","text":"以readxl套件中的excel_sheets來列出所有的工作表名稱，並用length()來自動計數有幾個工作表。將上述寫成function。給定一檔案名稱，即可輸出平均表格。呼叫ave_Teach_Q函數。","code":"\nthisfilename <- \"TableDemo\\\\UG-2017.xlsx\"\nsheetname <- excel_sheets(path = thisfilename)\n\ntbs <- data.frame()\nfor (j in 1:length(sheetname)) {\n  tb0 <- anal_Teach_Q(thisfilename, j)\n  tbs <- rbind(tbs, tb0)\n}\n\ntbs[,c(2:3)] <- lapply(tbs[,c(2:3)], as.numeric)\ntbs1 <- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), mean)\ntbs2 <- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), length) \ntbave <- data.frame(\"item\" = tbs1$Group.1, \"n\" = tbs2$x, \"mean\" = tbs1$x)\ntbave\nave_Teach_Q <- function(filename) {\n  sheetname <- excel_sheets(path = filename)\n  tbs = data.frame()\n  for (nSheet in 1:length(sheetname)) {\n    tb0 <- anal_Teach_Q(filename, nSheet)\n    tbs <- rbind(tbs, tb0)\n  }\n  tbs[,c(2:3)] <- lapply(tbs[,c(2:3)], as.numeric)\n  tbs1 <- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), mean) #FUN=mean\n  tbs2 <- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), length) #FUN=length\n  tbave <- data.frame(\"item\" = tbs1$Group.1, \"n\" = tbs2$x, \"mean\" = tbs1$x)\n  return(tbave)\n}\nthisfilename <- \"TableDemo\\\\UG-2017.xlsx\"\ntbave <- ave_Teach_Q(thisfilename)\ntbave"},{"path":"multisheets.html","id":"讀入多個檔案","chapter":"10 多個EXCEL檔的資料匯整與分析","heading":"10.5 讀入多個檔案","text":"同理，可以用for迴圈一次讀入多個檔案。此時需要知道每個檔案的名稱，可以用list.files()來列出所有檔案名稱。讀入所有檔案並列表。僅抓取平均數，並將每個表的mean改為該學期。以利後續處理。將所有抓取的表合成一個大表。也可以用tidyverse package中的purr和dplyr package的full_join()搭配Reduce()來做。更進階的寫法：以lapply取代for迴圈。將tbAll存成excel檔。","code":"\npath <- \"D:\\\\Dropbox\\\\Working\\\\教師社群\\\\TableDemo\"\nfiles <- list.files(path = path, pattern = \"*.xlsx\")\n# files\ntblist = list()\nfor (i in 1:length(files)) {\n  thisfilename <- paste(\"TableDemo\\\\\", files[i], sep='')\n  tb <- ave_Teach_Q(thisfilename)\n  tblist[[i]] <- tb\n}\n\n# tblist\npath <- \"D:\\\\Dropbox\\\\Working\\\\教師社群\\\\TableDemo\"\nfiles <- list.files(path = path, pattern = \"*.xlsx\")\n\ntblist = list()\nfor (i in 1:length(files)) {\n  thisfilename <- paste(\"TableDemo\\\\\", files[i], sep='')\n  tb <- ave_Teach_Q(thisfilename)\n  tb2 <- as.data.frame(tb[,c(1,3)])\n  names(tb2) <- c('item', substr(thisfilename,4,7))\n  tblist[[i]] <- tb2\n}\n\n# tblist\ntbAll <- Reduce(function(x, y) merge(x, y, all=TRUE, by=\"item\"), tblist)## Warning in merge.data.frame(x, y, all = TRUE, by = \"item\"): column names\n## 'leDe.x', 'leDe.y' are duplicated in the result\ntbAll[,2:ncol(tbAll)] <- round(tbAll[,2:ncol(tbAll)], digits = 2)\ntbAll\nlibrary(\"tidyverse\")\ntbAll2 <- reduce(tblist, full_join, by = \"item\")\n# tbAll2\nsetwd(\"D:\\\\Dropbox\\\\Working\\\\教師社群\\\\TableDemo\")\nall.data <- \n  lapply(files[1:length(files)], function(x)\n    ave_Teach_Q(x) %>%\n    subset(select = c(1,3)) %>%\n    rename(, !!substr(x,4,7) := mean))\n\ntbAll2 <- Reduce(function(x, y) merge(x, y, all=TRUE, by=\"item\"), all.data) %>%\n  mutate_if(is.numeric, round, digits = 2)\n                 \n# tbAll2\nlibrary(writexl)\nwrite_xlsx(tbAll, \"學習成效總表.xlsx\")"},{"path":"multisheets.html","id":"集大成的程式碼","chapter":"10 多個EXCEL檔的資料匯整與分析","heading":"10.6 集大成的程式碼","text":"如果不用任何%>%或funcion，程式會長這樣。","code":"\nsetwd(\"D:\\\\pCloud\\\\Working\\\\教師社群\\\\TableDemo\")\n\nlibrary(writexl)\nlibrary(readxl)\nlibrary(dplyr)\n\npath <- \"D:\\\\pCloud\\\\Working\\\\教師社群\\\\TableDemo\"\nfiles <- list.files(path = path, pattern = \"*.xlsx\")\n\nanal_Teach_Q <- function(filename, nSheet){\n  suppressMessages(qData <- read_xlsx(filename, nSheet))\n  index_start <- which(qData$`一、教學意見量化結果`==\"三、學習成效評估\")\n  index_end <- length(qData$`一、教學意見量化結果`)\n  tb1 <- slice(qData,index_start:index_end) %>%\n    na.omit() %>%\n    subset(`一、教學意見量化結果`!=\"題目\", select=c(1,2,8))\n  return(tb1)\n}\n\nave_Teach_Q <- function(filename) {\n  sheetname <- excel_sheets(path = filename)\n  tbs <- data.frame()\n  for (nSheet in 1:length(sheetname)) {\n    tb0 <- anal_Teach_Q(filename, nSheet)\n    tbs <- rbind(tbs, tb0)\n  }\n  tbs[,c(2:3)] <- lapply(tbs[,c(2:3)], as.numeric)\n  tbs1 <- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), mean) #FUN=mean\n  tbs2 <- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), length) #FUN=length\n  tbave <- data.frame(\"item\" = tbs1$Group.1, \"n\" = tbs2$x, \"mean\" = tbs1$x)\n  return(tbave)\n}\n\ntblist <- list()\nfor (i in 1:length(files)) {\n  thisfilename <- files[i]\n  tb <- ave_Teach_Q(thisfilename)\n  tb2 <- tb[,c(1,3)]\n  names(tb2)[2] <- substr(thisfilename,4,7)\n  tblist[[i]] <- tb2\n}\n\ntbAll <- Reduce(function(x, y) merge(x, y, all=TRUE, by=\"item\"), tblist)\nlibrary(readxl)\nlibrary(writexl)\nlibrary(dplyr)\n\nsetwd(\"D:\\\\pCloud\\\\Working\\\\教師社群\\\\TableDemo\")\npath <- \"D:\\\\pCloud\\\\Working\\\\教師社群\\\\TableDemo\"\n\nfiles <- list.files(path = path, pattern = \"*.xlsx\")\ndatalist <- list()\nfor (i in 1:length(files)) {\n  thisfilename <- files[i]\n  sheetname <- excel_sheets(path = thisfilename)\n  tbs <- data.frame()\n  for (j in 1:length(sheetname)) {\n    suppressMessages(qData <- read_xlsx(thisfilename, j))\n    index_start <- which(qData$`一、教學意見量化結果`==\"三、學習成效評估\")\n    index_end <- length(qData$`一、教學意見量化結果`)\n    myData <- slice(qData,index_start:index_end)\n    myData1 <- na.omit(myData) \n    myData2 <- myData1[which(myData1$`一、教學意見量化結果`!=\"題目\"),]\n    myData2 <- myData2[,c(1,2,8)]\n    tbs <- rbind(tbs, myData2)\n  }\n  tbs[,c(2:3)] <- lapply(tbs[,c(2:3)], as.numeric)\n  tbs1 <- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), mean)\n  tbs2 <- aggregate(tbs$...8, by=list(tbs$`一、教學意見量化結果`), length)\n  tb <- data.frame(\"item\" = tbs1$Group.1, \"n\" = tbs2$x, \"mean\" = tbs1$x)\n  tb2 <- tb[,c(1,3)]\n  names(tb2)[2] <- substr(thisfilename,4,7)\n  datalist[[i]] <- tb2\n}\n\ntbAll <- Reduce(function(x, y) merge(x, y, all=TRUE, by=\"item\"), datalist)"},{"path":"references.html","id":"references","chapter":"11 參考資料","heading":"11 參考資料","text":"","code":""}]
